var CON_VERSION = {
	release:'2018.08.01_005617',
	dir:	'nt6.96',
	script:	'2018.07.17',
	ntid:	'2018.07.17',
	im: 	'2018.07.17',
	chat:	'2018.07.17',
	publish:'2016.09.21_000000'
};
var CON_RULE = {};
var CON_SERVER = {
	flashserver:'http://sh-p2.ntalker.com/downt/t2d/',
	configserver:'http://statics.ntalker.com/mcenter/'
};

/* @file nt1.js
 * @date 2018.07.17 15:05:20 
 */
(function(window,underfined){var root,readyList=[],loadList={},core_strUndefined=typeof undefined,location=window.location,document=window.document,navigator=window.navigator,core_deletedIds=[],class2type={},core_push=core_deletedIds.push,core_slice=core_deletedIds.slice,core_hasOwn=class2type.hasOwnProperty,core_version="2015.09.23",rQuickExpr=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,rSingleTag=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,cssValueExp=/[\-\+0-9\.]/gi,rCamelCase=/-([a-z])/gi,clearHtmlExp=/(<.*?>)/gi,nTalk=function(selector,context){return new nTalk.fn.init(selector,context,root)},readyComplete=false,emptyFunc=function(){};nTalk.fn=nTalk.prototype={talkVersion:core_version,constructor:nTalk,init:function(selector,context,root){var match,elem;if(!selector){return this}if(typeof selector==="string"){if(selector.charAt(0)==="<"&&selector.charAt(selector.length-1)===">"&&selector.length>=3){match=[null,selector,null]}else{match=rQuickExpr.exec(selector)}if(match&&(match[1]||!context)){if(match[1]){context=context instanceof nTalk?context[0]:context;nTalk.merge(this,nTalk.parseHTML(match[1],context&&context.nodeType?context.ownerDocument||context:document,true));return this}else{elem=document.getElementById(match[2]);if(elem&&elem.parentNode){this.length=1;this[0]=elem}this.context=document;this.selector=selector;return this}}else if(!context||context.talkVersion){return(context||root).find(selector)}else{return this.constructor(context).find(selector)}}else if(selector.nodeType||nTalk.isWindow(selector)){this.context=this[0]=selector;this.length=1;return this}else if(nTalk.isObject(selector)&&selector.talkVersion){if(selector.length){this.context=this[0]=selector[0];this.length=1}return this}else if(nTalk.isPlainObject(selector)){var tag=selector.tag||"div";delete selector.tag;this.context=this[0]=nTalk.Element(tag,selector);this.length=1;return this}else if(nTalk.isFunction(selector)){return nTalk.ready(selector)}if(selector.selector!==undefined){this.selector=selector.selector;this.context=selector.context}return nTalk.merge(this,[selector])},selector:"",length:0,toArray:function(){return core_slice.call(this)},get:function(num){return num===null?this.toArray():num<0?this[this.length+num]:this[num]},pushStack:function(elems){var ret=nTalk.merge(this.constructor(),elems);ret.prevObject=this;ret.context=this.context;return ret},slice:function(){return this.pushStack(core_slice.apply(this,arguments))},eq:function(i){var len=this.length,j=+i+(i<0?len:0);return this.pushStack(j>=0&&j<len?[this[j]]:[])},first:function(){return this.eq(0)},last:function(){return this.eq(this.length-1)},each:function(callback,args){return nTalk.each(this,callback,args)},find:function(selector){var child=this.constructor.selector.query(selector,this);return this.pushStack(child)},push:core_push,sort:[].sort,splice:[].splice};nTalk.fn.init.prototype=nTalk.fn;nTalk.extend=nTalk.fn.extend=function(){var options,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=false;if(typeof target==="boolean"){deep=target;target=arguments[1]||{};i=2}if(typeof target!=="object"&&!nTalk.isFunction(target)){target={}}if(length===i){target=this;--i}for(;i<length;i++){options=arguments[i];if(options){for(var key in options){if(!options.hasOwnProperty(key))continue;src=target[key];copy=options[key];if(target===copy){continue}if(deep&&copy&&(nTalk.isPlainObject(copy)||(copyIsArray=nTalk.isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&nTalk.isArray(src)?src:[]}else{clone=src&&nTalk.isPlainObject(src)?src:{}}target[key]=nTalk.extend(deep,clone,copy)}else if(copy!==undefined){target[key]=copy}}}}return target};nTalk.extend({CON_CACHE_COOKIE:"nTalk_CACHE_DATA",CON_MANAGE_COOKIE:"nTalk_PAGE_MANAGE",CON_PCID_KEY:"NTKF_T2D_CLIENTID",CON_CONNECT_FLASH:"FLASH",CON_CONNECT_COMET:"COMET",STYLE_BODY:"margin:0;padding:0;border:none;float:none;width:auto;height:auto;min-width:none;min-height:none;max-width:none;max-height:none;clear:none;position:static;left:auto;top:auto;right:auto;bottom:auto;text-align:left;box-sizing:content-box;color:#000;background-color:transparent;font:normal normal normal 12px/160% Arial,Microsoft YaHei;",STYLE_NBODY:"margin:0;padding:0;border:none;float:none;width:auto;height:auto;min-width:none;min-height:none;max-width:none;max-height:none;clear:none;position:static;left:auto;top:auto;right:auto;bottom:auto;text-align:left;box-sizing:content-box;color:#000;background-color:transparent;font:normal normal normal 0px/0px Arial,Microsoft YaHei;",isReady:false,Log:emptyFunc,charset:document.charset||document.characterSet,language:navigator.language||navigator.systemLanguage,protocol:location.protocol,url:location.href,title:document.title,referrer:document.referrer,source:"",domain:"",baseProtocol:"",baseURI:"",sourceURI:"",baseName:"",baseExt:"",extParmas:{},pageURI:"",pageName:"",params:null,hashParams:null,user:{},lang:null,server:null,global:{},IMPRESENCE:null,version:{pub:core_version},elementParent:null,elementBefore:null,themesURI:"",isNumeric:function(obj){return!isNaN(parseFloat(obj))&&isFinite(obj)},isBoolean:function(v){return typeof v==="boolean"},isDefined:function(v){return typeof v!=="undefined"},isWindow:function(obj){return obj&&obj==obj.window},isFunction:function(obj){return Object.prototype.toString.call(obj)==="[object Function]"},isArray:function(obj){return nTalk.isFunction(Array.isArray)?Array.isArray(obj):Object.prototype.toString.call(obj)==="[object Array]"},isObject:function(obj){return Object.prototype.toString.call(obj)==="[object Object]"&&obj&&!this.isDefined(obj.nodeType)},isEmptyObject:function(obj){for(var name in obj){if(!obj.hasOwnProperty(name))continue;return false}return true},isPlainObject:function(obj){if(typeof obj!=="object"||obj.nodeType||this.isWindow(obj)){return false}try{if(obj.constructor&&!core_hasOwn.call(obj.constructor.prototype,"isPrototypeOf")){return false}}catch(e){return false}return true},getWindow:function(elem){return nTalk.isWindow(elem)?elem:elem.nodeType===9&&elem.defaultView},bind:function(object,func){var args=Array.prototype.slice.call(arguments).slice(2);return function(event){return func.apply(object,[event||window.event].concat(args))}},parseHTML:function(html,context){if(!html||typeof html!=="string"){return null}context=context||document;var parsed=rSingleTag.exec(html);if(parsed){return[context.createElement(parsed[1])]}if(!/<|&#?\w+;/.test(html)){return[context.createTextNode(html)]}else{var tmp=context.createElement("div");tmp.innerHTML=html;return nTalk.merge([],tmp.childNodes)}},merge:function(){var target=arguments[0]||{},args=arguments,i,k,len;if(args.length<=1)return target;for(i=1;i<args.length;i++){if(!args[i]||args[i]===null)continue;if(args[i].length===undefined){for(k in args[i]){if(!args[i].hasOwnProperty(k))continue;target[k]=args[i][k]}}else{for(k=0,len=args[i].length;k<len;k++){if(target.length!==undefined)target.push(args[i][k]);else target[k]=args[i][k]}}}return target},each:function(obj,callback,args){if(!nTalk.isArray(args))args=[];if(nTalk.isArray(obj)||nTalk.isObject(obj)&&obj.talkVersion){for(var i=0;i<obj.length;){if(callback.apply(obj[i],[i,obj[i++]].concat(args))===false){break}}}else if(nTalk.isObject(obj)){for(var name in obj){if(!obj.hasOwnProperty(name))continue;callback.apply(obj[name],[name,obj[name]].concat(args))}}else{callback.apply(obj,[0,obj].concat(args))}return obj},access:function(elems,fn,key,value,chainable){var i=0,length=elems.length;if(nTalk.isPlainObject(key)){chainable=true;for(var k in key){if(!key.hasOwnProperty(k))continue;nTalk.access(elems,fn,k,key[k],true)}}else if(value!==undefined){chainable=true;for(;i<length;i++){fn(elems[i],key,value)}}return chainable?elems:length?fn(elems[0],key):null},strFormat:function(str,length){for(var result="",i=1,maxLength=length||2;i<=maxLength;i++)result+="0";result+=str||"";return result.substr(result.length-maxLength)},getTime:function(type){var time=(new Date).getTime(),random=Math.random()*1e3;random=this.strFormat(Math.floor(random),3);switch(type){case 2:return time.toString()+random;case 1:return time+random;default:return time}},secondsToMinutes:function(seconds){var a="",b=seconds,f=this.strFormat;if(b>=60){a+=f(Math.floor(b/60));b=b%60}else{a+="00"}return a+":"+f(b)},formatDate:function(time,format){var cDate,regs;if(this.isNumeric(time)){cDate=new Date(time)}else if(typeof time=="string"){cDate=new Date;format=time}else{cDate=new Date}format=format||"HH:mm:ss";regs={"M+":cDate.getMonth()+1,"d+":cDate.getDate(),"h+":cDate.getHours()%12===0?12:cDate.getHours()%12,"H+":cDate.getHours(),"m+":cDate.getMinutes(),"s+":cDate.getSeconds(),"q+":Math.floor((cDate.getMonth()+3)/3),"S+":cDate.getMilliseconds()};if(/(y+)/i.test(format)){format=format.replace(RegExp.$1,(cDate.getFullYear()+"").substr(4-RegExp.$1.length))}for(var k in regs){if(regs.hasOwnProperty(k)&&new RegExp("("+k+")").test(format)){if(RegExp.$1=="S"){format=format.replace(RegExp.$1,("00"+regs[k]).substr(3))}else{format=format.replace(RegExp.$1,RegExp.$1.length==1?regs[k]:("00"+regs[k]).substr((""+regs[k]).length))}}}if(time===-1){return""}return format},randomChar:function(len,radix){var tmp="",l=len||8,strR=radix==10?"0123456789":"0123456789ABCDEF";for(var i=0;i<l;i++){tmp+=strR.charAt(Math.round(Math.random()*(strR.length-1)))}return tmp}});nTalk.selector={tagGuid:1,attrMap:{"class":"className","for":"htmlFor"},rex:{R_RULE:/[ +>~]/g,NR_RULE:/[^ +>~]+/g,TRIM_LR:/^ +| +$/g,TRIM_ALL:/ *([ +>~,]) */g,PSEU_PARAM:/\([^()]+\)/g,ATTR_PARAM:/[^\[]+(?=])/g,ATTR:/=|!=|\^=|\$=|\*=|~=|\|=/,CLS:/\./g,PSEU:/[^:]+/g,NUM:/\d+/,NTH:/(-?\d*)n([+-]?\d*)/,RULES:/((?:#.+)*)([a-zA-Z1-6*]*)([^\[:]*)((?:\[.+])*)((?::.+)*)/},query:function(selector,context){if(typeof selector=="undefined"||!selector)return[];var results=[],selectors,contexts,rules,i,j,n,m;switch(typeof context){case"undefined":contexts=[document];break;case"string":selector=context+" "+selector;contexts=[document];break;case"object":if(context.nodeType){contexts=[context]}else{contexts=context}}selectors=this.format(selector);context=contexts;for(i=0,j=selectors.length;i<j;i++){selector=selectors[i];rules=(" "+selector).match(this.rex.R_RULE);selector=selector.match(this.rex.NR_RULE);contexts=context;for(n=0,m=rules.length;n<m;n++){contexts=this.parse(selector[n],contexts,rules[n])}results=results.concat(contexts)}if(j>1){return this.makeDiff(results)}return results},format:function(selector){var pseuParams=[],attrParams=[];this.pseuParams=pseuParams;this.attrParams=attrParams;selector=selector.replace(this.rex.TRIM_LR,"").replace(this.rex.TRIM_ALL,"$1").replace(this.rex.ATTR_PARAM,function(match){return attrParams.push(match)-1});var tmpFunc=function(match){return pseuParams.push(match.substring(1,match.length-1))-1};while(selector.indexOf("(")!==-1){selector=selector.replace(this.rex.PSEU_PARAM,tmpFunc)}return selector.split(",")},parse:function(selector,contexts,rule){var matched,rules,id,cls,attrs,pseudos;rules=this.rex.RULES.exec(selector);if(id=rules[1]){if(id=document.getElementById(id.substring(1))){return[id]}return[]}matched=nTalk.selector.queryRelative[rule](contexts,rules[2]||"*",this);if(cls=rules[3]){matched=this.filterClass(matched,cls.replace(this.rex.CLS,""))}if(attrs=rules[4]){matched=this.filterAttr(matched,this.getAttrRules(attrs.match(this.rex.ATTR_PARAM),this.attrParams))}if(pseudos=rules[5]){matched=this.filterPseudo(matched,this.getPseudoRules(pseudos.match(this.rex.PSEU),this.pseuParams))}return matched},getRules:function(selector){var rules,attrs,pseudos;rules=this.rex.RULES.exec(selector);if(!rules[2]){rules[2]="*"}rules[3]=rules[3].replace(this.rex.CLS,"");if(attrs=rules[4]){rules[4]=this.getAttrRules(attrs.match(this.rex.ATTR_PARAM),this.attrParams)}if(pseudos=rules[5]){rules[5]=this.getPseudoRules(pseudos.match(this.rex.PSEU),this.pseuParams)}return rules},getAttrRules:function(attrs,attrParams){var arr=[],len=attrs.length,rex=this.rex.ATTR,i=0,attr,rule;for(;i<len;i++){attr=attrParams[attrs[i]];rule=attr.match(rex)||" ";attr=attr.split(rex);arr.push(nTalk.selector.queryAttrs[rule]);arr.push(attr)}return arr},getPseudoRules:function(pseudos,pseuParams){var arr=[],i=0,len=pseudos.length,guid=this.tagGuid++,name,param,rules;for(;i<len;i++){name=pseudos[i];if(this.rex.NUM.test(name)){param=pseuParams[RegExp["$&"]];name=RegExp["$`"];switch(name){case"nth-child":if(this.rex.NTH.test(param==="odd"&&"2n+1"||param==="even"&&"2n"||param)){param=RegExp.$1;param=param===""?1:param==="-"?-1:param;param=[guid,true,param,RegExp.$2];if(param[2]===1&&param[3]===0){continue}}else{param=[guid,false,param]}break;case"not":rules=param.split(",");param=[];while(rules.length){param.push(this.getRules(rules.pop()))}break;case"contains":}}arr.push(nTalk.selector.queryPseudos[name]);arr.push(param)}return arr},filterPseudo:function(els,pseudoRules){var len=els.length,i=0,m=pseudoRules.length,matched=[],n,el,pseudo,param;for(;i<len;i++){el=els[i];for(n=0;n<m;n+=2){pseudo=pseudoRules[n];param=pseudoRules[n+1];if(!pseudo||!pseudo(el,param,this)){break}}if(n===m){matched.push(el)}}return matched},filterAttr:function(els,attrRules){var len=els.length,i=0,m=attrRules.length,matched=[],n,el,attr,rule,val,name;for(;i<len;i++){el=els[i];for(n=0;n<m;n+=2){rule=attrRules[n];attr=attrRules[n+1];name=attr[0];if(!(val=name==="href"?el.getAttribute(name):el.getAttribute(name))){if(!(val=el[this.attrMap[name]||name])){break}}if(!rule(val+"",attr[1])){break}}if(n===m){matched.push(el)}}return matched},filterClass:function(els,cls){var i=0,len=els.length,matched=[],clsName,rex,el;for(;i<len;i++){el=els[i];if(typeof el.className=="string"){clsName=el.className;rex=new RegExp(clsName.replace(" ","|"),"g");if(!cls.replace(rex,"")){matched.push(el)}}}return matched},filterEl:function(el,tag,cls,attrRules,pseudoRules){if(tag!=="*"&&el.nodeName.toLowerCase()!==tag){return false}if(cls&&!this.filterClass([el],cls).length){return false}if(attrRules&&!this.filterAttr([el],attrRules).length){return false}return!(pseudoRules&&!this.filterPseudo([el],pseudoRules).length)},makeDiff:function(arr){var gUid=this.tagGuid++,len=arr.length,diff=[],i=0,el,data;for(;i<len;i++){el=arr[i];data=this.getElData(el);if(data.tagGuid!==gUid){diff.push(el);data.tagGuid=gUid}}return diff},getElData:function(el){var data=el.mojoExpando;if(!data){data=el.mojoExpando={mQuery:{tagGuid:0}}}if(!(data=data.mQuery)){data={tagGuid:0}}return data},queryRelative:{" ":function(contexts,tag,joQuery){var guid=joQuery.tagGuid++,len=contexts.length,arr=[],i=0,n,m,nodes,el,pel;for(;i<len;i++){el=contexts[i];if(pel=el.parentNode){if(joQuery.getElData(pel).tagGuid===guid){continue}joQuery.getElData(el).tagGuid=guid}nodes=el.getElementsByTagName(tag)||null;for(n=0,m=nodes.length;n<m;n++){arr.push(nodes[n])}}return arr},">":function(contexts,tag){var arr=[],len=contexts.length,i=0,el;for(;i<len;i++){el=contexts[i].firstChild;while(el){if(el.nodeType===1){if(el.nodeName.toLowerCase()===tag||tag==="*"){arr.push(el)}}el=el.nextSibling}}return arr},"+":function(contexts,tag){var arr=[],len=contexts.length,i=0,el;for(;i<len;i++){el=contexts[i];while(el=el.nextSibling){if(el.nodeType===1){if(el.nodeName.toLowerCase()===tag||tag==="*"){arr.push(el)}break}}}return arr},"~":function(contexts,tag,joQuery){var guid=joQuery.tagGuid++,len=contexts.length,arr=[],i=0,el,pel,data;for(;i<len;i++){el=contexts[i];if(pel=el.parentNode){if((data=joQuery.getElData(pel)).tagGuid===guid){continue}data.tagGuid=guid}while(el=el.nextSibling){if(el.nodeType===1){if(el.nodeName.toLowerCase()===tag||tag==="*"){arr.push(el)}}}}return arr}},queryAttrs:{" ":function(){return true},"=":function(attrVal,inputVal){return attrVal===inputVal},"!=":function(attrVal,inputVal){return attrVal!==inputVal},"^=":function(attrVal,inputVal){return attrVal.indexOf(inputVal)===0},"$=":function(attrVal,inputVal){return attrVal.substring(attrVal.length-inputVal.length)===inputVal},"*=":function(attrVal,inputVal){return attrVal.indexOf(inputVal)!==-1},"~=":function(attrVal,inputVal){return(" "+attrVal+" ").indexOf(" "+inputVal+" ")!==-1},"|=":function(attrVal,inputVal){return attrVal===inputVal||attrVal.substring(0,inputVal.length+1)===inputVal+"-"}},queryPseudos:{eq:function(el,param,joQuery){var pel,index,node,i,data;if((pel=el.parentNode)&&(data=joQuery.getElData(pel)).tagGuid!==param){node=pel.firstChild;i=1;while(node){if(node.nodeType===1){joQuery.getElData(node).nodeIndex=i++}node=node.nextSibling}data.tagGuid=param}index=joQuery.getElData(el).nodeIndex;return index==param},lt:function(el,param,joQuery){var pel,index,node,i,data;if((pel=el.parentNode)&&(data=joQuery.getElData(pel)).tagGuid!==param){node=pel.firstChild;i=1;while(node){if(node.nodeType===1){joQuery.getElData(node).nodeIndex=i++}node=node.nextSibling}data.tagGuid=param}index=joQuery.getElData(el).nodeIndex;return index<param},gt:function(el,param,joQuery){var pel,index,node,i,data;if((pel=el.parentNode)&&(data=joQuery.getElData(pel)).tagGuid!==param){node=pel.firstChild;i=1;while(node){if(node.nodeType===1){joQuery.getElData(node).nodeIndex=i++}node=node.nextSibling}data.tagGuid=param}index=joQuery.getElData(el).nodeIndex;return index>param},"first-child":function(el){while(el=el.previousSibling){if(el.nodeType===1){return false}}return true},"last-child":function(el){while(el=el.nextSibling){if(el.nodeType===1){return false}}return true},"only-child":function(el){var next=el.nextSibling,pre=el.previousSibling;while(next){if(next.nodeType===1){return false}next=next.nextSibling}while(pre){if(pre.nodeType===1){return false}pre=pre.previousSibling}return true},"nth-child":function(el,param,joQuery){var pel,index,node,i,data;if((pel=el.parentNode)&&(data=joQuery.getElData(pel)).tagGuid!==param[0]){node=pel.firstChild;i=1;while(node){if(node.nodeType===1){joQuery.getElData(node).nodeIndex=i++}node=node.nextSibling}data.tagGuid=param[0]}index=joQuery.getElData(el).nodeIndex;if(param[1]){index=index-param[3];param=param[2];return index*param>=0&&index%param===0}return index===param[2]},not:function(el,params,joQuery){var i=0,len=params.length,param;for(;i<len;i++){param=params[i];if(param[1]){if("#"+el.id!==param[1]){continue}return false}if(joQuery.filterEl(el,param[2],param[3],param[4],param[5])){return false}}return true},contains:function(el,text){return(el.textContent||el.innerText||"").indexOf(text)>-1},enabled:function(el){return el.disabled===false},disabled:function(el){return el.disabled===true},checked:function(el){return el.checked===true},empty:function(el){return!el.firstChild}}};nTalk.Class={create:function(){return function(){this.initialize.apply(this,arguments)}}};nTalk.extend({initializeCore:function(){var domain=/([^\.]+(\.com(\.cn)?|\.net(\.cn)?|\.edu(\.cn)?|\.org(\.cn)?|\.gov(\.cn)?|\.cn|\.mobi|\.tel|\.asia|\.me|\.info|\.hk|\.cc|\.biz|\.tv))$/i.exec(document.domain),match=/(.*\/)(.*?\.\w+)?([\?#].*)?$/gi.exec(location.protocol+"//"+document.domain+location.pathname),strParams="";root=nTalk(document);var ntkfscript=nTalk("script[src*=ntkf]");var baseoutscript=nTalk("script[src*=base.out]");var scripts=[];if(ntkfscript&&ntkfscript.length!=0){scripts.push(ntkfscript[0])}if(baseoutscript&&baseoutscript.length!=0){scripts.push(baseoutscript[0])}for(var i=0,l=scripts.length;i<l;i++){var element=scripts[i];if(!element.src)return;var match=/^((https?:).*\/)?(.*?\.js)?(\?.*)?/gi.exec(element.src);if(match&&match[1]&&match[3]&&/^((ntkfstat|ntkf|base\.out).*?)\.js/gi.test(match[3])&&match[4]&&match[4].indexOf("siteid")>-1){nTalk.baseProtocol=match[2]||nTalk.protocol;nTalk.baseURI=match[1]||nTalk.pageURI;nTalk.baseName=match[3];strParams=match[4]?match[4]:"";nTalk.elementParent=element.parentNode;nTalk.elementBefore=element}}if(!nTalk.baseURI){throw"get script url failure"}nTalk.domain=domain&&domain[0]||document.domain;nTalk.pageURI=match&&match[1]?match[1]:"";nTalk.pageName=match&&match[2]?match[2]:"";nTalk.params=nTalk.uriToJSON(location.search.substr(1));nTalk.hash=location.hash?location.href.substr(location.href.indexOf("#")+1):"";nTalk.hashParams=nTalk.uriToJSON(nTalk.hash);nTalk.loadList=loadList;if(nTalk.flash.support&&!nTalk.browser.mobile){nTalk.global.connect=nTalk.CON_CONNECT_FLASH}else{nTalk.global.connect=nTalk.CON_CONNECT_COMET}if(nTalk.browser.msie6){try{document.execCommand("BackgroundImageCache",false,true)}catch(e){}}var arrs=strParams.length?strParams.substr(1).split("&"):["lan=zh_cn",""];for(var tmp,i=0;i<arrs.length;i++){tmp=arrs[i].split("=");nTalk.extParmas[tmp[0]]=tmp[0]=="lan"?tmp[1]||"zh_cn":tmp[1]}nTalk.cache.init()}});nTalk.browser=function(ua){var browser={"360ee":!1,lbbrowser:!1,se:!1,chrome:!1,safari:!1,msie:!1,firefox:!1,oupeng:!1,opera:!1,webkit:!1,iPod:!1,iPad:!1,iPhone:!1,android:!1,gecko:!1,windows:!1,"windows ce":!1,edge:!1,uc:!1,micromessenger:!1,weibo:!1},core=["applewebkit/([^\\s]*)","presto\\/([\\d.]*)","trident([^;]*)","gecko\\/([\\d.]*)","msie ([\\d.]*)"];var ISOldIOS=/OS (\d)_.* like Mac OS X/g.exec(window.navigator.userAgent);var ver=ua.match(/cpu iphone os (.*?) like mac os/)?ua.match(/cpu iphone os (.*?) like mac os/)[1].replace(/_/g,"."):"";var oc=ver?ver.split(".")[0]:false;var oc_1=ver?ver.split(".")[1]:false;var oc_2=ver?ver.split(".")[2]:false;var isUc=/ucbrowser/.test(ua);nTalk.each(browser,function(name){browser[name]=ua.indexOf(name.toLowerCase())>-1});browser.ua=ua;browser.ieversion=0;browser.coreversion=0;browser.mac=!!ua.match(/cpu.+mac\s+os\s+x/g);for(var j=0;j<core.length;j++){if(new RegExp(core[j],"i").test(ua)){if(j==core.length-1){browser.ieversion=RegExp["$1"]||RegExp["$2"]}else{browser.coreversion=RegExp["$1"]}}}browser.ieversion=document.documentMode||browser.ieversion||browser.ieversion;browser.msie=browser.msie||browser.ieversion>0;browser.gecko=browser.gecko&&!browser.webkit&&!browser.msie;browser.msie6=browser.msie&&browser.ieversion==6;browser.msie7=browser.msie&&browser.ieversion==7;browser.msie8=browser.msie&&browser.ieversion==8;browser.msie9=browser.msie&&browser.ieversion==9;browser.msie10=browser.msie&&browser.ieversion==10;browser.msie11=browser.msie&&browser.ieversion==11;browser.edge=browser.edge;browser.uc=browser.uc;browser.oldmsie=browser.ieversion&&browser.ieversion<=9;browser.safari=browser.safari&&!browser.chrome;browser.safari2=browser.safari&&!/adobeair/i.test(ua);browser.Quirks=document.compatMode==="BackCompat";browser.mobile=/mobile|android|linux/i.test(ua);browser.android=/android (\d.*?);/g.exec(ua);browser.oldAndroid=browser.android&&browser.android.pop().substr(0,3)<4.5;browser.oldIOS=ISOldIOS?+ISOldIOS.pop()<8:false;browser.iPhone6=browser.iPhone&&document.body.offsetWidth==375;browser.iPhone6Plus=browser.iPhone&&document.body.offsetWidth==414;browser.iOS=navigator.platform=="Mac68K"||navigator.platform=="MacPPC"||navigator.platform=="Macintosh"||ua.indexOf("mac")>-1;browser.is=function(keyword){return new RegExp(keyword,"ig").test(ua)};browser.oc=oc;browser.oc_1=oc_1;browser.oc_2=oc_2;browser.isUc=isUc;browser.html5=!!window.applicationCache;isStorageSupported=function(){var supported=null;try{supported=window.localStorage}catch(e){return false}if(supported){var mod="test";try{if(localStorage.getItem(mod)!==null){localStorage.removeItem(mod)}localStorage.setItem(mod,mod);if(localStorage.getItem(mod)==mod){localStorage.removeItem(mod);return true}else{return false}}catch(e){return false}}};try{browser.supportMqtt="WebSocket"in window&&window.WebSocket!==null&&"localStorage"in window&&window.localStorage!==null&&"ArrayBuffer"in window&&window.ArrayBuffer!==null&&isStorageSupported()}catch(e){browser.supportMqtt=false}return browser}(navigator.userAgent.toLowerCase());nTalk.extend({ready:function(fn){var self=this,readyState=document.readyState,oldWebkit=nTalk.browser.webkit&&nTalk.browser.version<525,completed=function(){if(readyComplete)return;if(!oldWebkit&&window.removeEventListener){document.removeEventListener("DOMContentLoaded",completed,false);window.removeEventListener("load",completed,false)}nTalk.isReady=readyComplete=true;for(var i=0;i<readyList.length;i++){readyList[i].apply(document)}readyList=[]};if(readyComplete||/loaded|complete/gi.test(readyState)){nTalk.isReady=readyComplete=true;fn.call(self)}else{readyList[readyList.length]=function(){return fn.call(self)}}if(oldWebkit){(function(){/^loaded|complete$/i.test(readyState)?completed():setTimeout(arguments.callee(),50)})()}else if(document.addEventListener){if(readyState=="interactive"){completed()}else{document.addEventListener("DOMContentLoaded",completed,false);window.addEventListener("load",completed,false)}}else{var temp=document.createElement("div");(function(){(function(){try{temp.doScroll("left");document.body.insertBefore(temp,document.body.lastChild).setAttribute("html","temp")}catch(e){}return temp})?completed():setTimeout(arguments.callee(),50)})()}},require:function(content,callback,bind){var queue=[],result=[],attrs,item=null,l,url;if(!content){return}content=typeof content==="string"?[content]:content;callback=callback||emptyFunc;bind=bind||document.head||nTalk("head")[0]||document.documentElement;l=nTalk._getObjectNumber(content);if(queue.length===0&&l===0){callback.apply(item,result)}nTalk.each(content,function(name,src){if(!src)return;var isImage,time=nTalk.getTime(),lchar=src.indexOf("?")==-1?"?":"&",fix=src.replace(/(.*\/)?(.*?)[\?$](.*)?/i,"$2"),modeName=!nTalk.isNumeric(name)?name:"",scriptComplete=function(){queue.splice(nTalk.inArray(src,queue),1);l--;if(queue.length===0&&l===0){callback.apply(item,result)}},scriptCompleteImg=function(){queue.splice(nTalk.inArray(src,queue),1);l--;callback.apply(item,result)},onScriptLoad=function(event){event=nTalk.Event.fixEvent(event);var node=event.currentTarget||event.srcElement;var reg=/loaded|complete/gi;var readyState=node.readyState;if(event.type==="load"||reg.test(readyState)){setTimeout(function(){if(modeName){loadList[fix]=nTalk[modeName];result.push(nTalk[modeName])}else{loadList[fix]=node;result.push(node)}scriptComplete()},nTalk.browser.msie6?500:0)}else if(event.type==="error"){event.error=true;result.push(modeName?false:event);scriptComplete()}};queue.push(src);fix+=src.indexOf("#rnd")>-1?String(time).substring(5,11):src.indexOf("#image")>-1?src.replace(/(.*?)\?(.*?)(#.*?)?$/gi,"-$2"):"";isImage=/\.((gif)|(png)|(jpg)|(bmp)|(jpeg))$/i.test(src)||/#image$/gi.test(src);isRobotImage=/#robotImg/gi.test(src);src=src.replace(/#rnd/i,lchar+"ts="+time).replace(/#image/i,"");url=(!/^(https?:\/\/)/i.test(src)?nTalk.baseURI:"")+src;if(modeName&&nTalk[modeName]){result.push(nTalk[modeName]);scriptComplete()}else if(!modeName&&loadList[fix]){result.push(loadList[fix]);scriptComplete()}else if(isImage){item=nTalk.preloadImage(url,function(elem){elem.error=false;loadList[fix]=elem;result.push(elem);scriptCompleteImg()},function(event){event.error=true;result.push(event);scriptComplete()},isRobotImage?120:6)}else{attrs=/\.css[^\.]*$/gi.test(src)?{tag:"link",type:"text/css",rel:"stylesheet",href:url}:{tag:"script",type:"text/javascript",async:"async",charset:"utf-8",src:url};if(attrs.tag=="script"&&modeName){attrs["data-requiremodule"]=modeName}item=nTalk(attrs).appendTo(bind);if(typeof item.get(0).onreadystatechange=="undefined"){item.bind("load",onScriptLoad).bind("error",onScriptLoad)}else{item.bind("readystatechange",onScriptLoad).bind("error",onScriptLoad)}}})},jsonp:function(url,callback){var args,callName="call_"+nTalk.randomChar(16);url=url+(/\?/gi.test(url)?"&":"?")+"callback="+callName;window[callName]=function(){args=arguments;setTimeout(function(){if(nTalk.isFunction(callback)){callback.apply(self,args)}},0);try{delete window[callName]}catch(e){}};nTalk.require(url,function(script){nTalk(script.error?script.target:this).remove()})},preloadImage:function(src,load,error,count){var self=this;load=load||emptyFunc;error=error||emptyFunc;var timeID,img=new Image;img.src=src;img.setAttribute("loadTime",0);if(img.complete){load.call(nTalk,img);return img}img.onload=function(){clearInterval(timeID);load.call(nTalk,this)};img.onError=function(){clearInterval(timeID);error.call(nTalk,this)};timeID=setInterval(function(){img.setAttribute("loadTime",parseInt(img.getAttribute("loadTime"))+1);if(parseInt(img.getAttribute("loadTime"),10)>=count){clearInterval(timeID);error.call(nTalk,self)}if(img.readyState!="complete"&&!nTalk.browser.msie7)return;clearInterval(timeID);img.onLoad=img.onError=null;load.call(nTalk,img)},500);return img},_getObjectNumber:function(obj){if(!obj){return false}else if(nTalk.isArray(obj)){return obj.length}else{var length=0;for(var k in obj){if(obj.hasOwnProperty(k))length++}return length}}});nTalk.cookie={enable:function(){var result=false,testCookie="testcookie";if(navigator.cookieEnabled){return true}this.set(testCookie,"yes",0);if(this.get(testCookie)=="yes")result=true;this.del(testCookie);return result},set:function(key,value,time,domain){var cDate,exp,_cookie,path;value=value||"";domain=domain?domain:""||nTalk.domain;if(typeof time!="number"){time=0}if(time===0){exp=nTalk.browser.msie||nTalk.browser.mobile?" ":"expires=0; "}else{cDate=new Date;cDate.setTime(cDate.getTime()+time);exp=cDate?"expires="+cDate.toGMTString()+"; ":""}domain="domain="+domain+"; ";_cookie=key+"="+(""+value).replace(/\"|\'/gi,"|")+"; ";path="path=/; ";document.cookie=_cookie+exp+domain+path;return value},get:function(key){var reg,_cookie=document.cookie;if(_cookie.length){reg=new RegExp("(?:^|;)\\s*"+key+"=(.*?)(?:;|$)").exec(_cookie);if(reg&&reg.length){return decodeURIComponent(reg[1].replace(/\|/gi,'"'))}}return null},del:function(key,domain){return this.set(key,"",1,domain)}};nTalk.flash=function(){var axo,counter,hasFlash=false,version=[0,0,0,0],fnRemove=function(selector){nTalk(selector).each(function(i,element){var tElement;if(nTalk.browser.msie||!element.parentNode){for(var k in element)try{eval("element."+k+"=null")}catch(e){}tElement=document.createElement("DIV");try{tElement.appendChild(element);tElement.innerHTML="";if(tElement.parentNode)tElement.parentNode.removeChild(tElement)}catch(e){}}else try{element.parentNode.removeChild(element)}catch(e){nTalk.Log("remove flash node failure",3)}})};if(navigator.plugins&&navigator.mimeTypes.length){var x=navigator.plugins["Shockwave Flash"];if(x&&x.version){hasFlash=true;version=x.version.split(".")}else if(x&&x.description){hasFlash=true;version=x.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+r|\s+b[0-9]+)/,".").split(".");if(version.length==3)version[version.length]=0}}else if(nTalk.browser["windows ce"]){axo=1;counter=3;while(axo){try{counter++;axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+counter);hasFlash=true;version=[counter,0,0]}catch(e){axo=null}}}else{try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(axo!==null){hasFlash=true;version=axo.GetVariable("$version").split(" ")[1].toString().replace(/,/g,".").split(".")}}catch(e){hasFlash=false}}return{remove:fnRemove,GT:gt,support:false,version:version.join(".")};function gt(ver){var cv=version,v=(ver||"0.0.0").split(".").slice(0,3);return cv[0]>v[0]||cv[0]==v[0]&&cv[1]>v[1]||cv[0]==v[0]&&cv[1]==v[1]&&cv[2]>v[2]}}();nTalk.Event=function(){var addEvent,removeEvent,evtHash=[];if(window.addEventListener){addEvent=function(elem,type,handler,useCapture){if(type=="mouseenter")elem.addEventListener("mouseover",mouseEnter(handler),useCapture);else if(type=="mouseleave")elem.addEventListener("mouseout",mouseEnter(handler),useCapture);else elem.addEventListener(type,handler,useCapture)};removeEvent=function(elem,type,handler,useCapture){elem.removeEventListener(type,handler,useCapture)}}else{addEvent=function(elem,type,handler){var key="{FNKEY::obj_"+ieGetUniqueID(elem)+"::evt_"+type+"::fn_"+handler+"}",f=evtHash[key];if(typeof f!="undefined")return;f=function(_evt){handler.call(elem,_evt)};evtHash[key]=f;elem.attachEvent("on"+type,f);window.attachEvent("onunload",function(){try{elem.detachEvent("on"+type,f)}catch(e){}});key=null};removeEvent=function(elem,type,handler){var key="{FNKEY::obj_"+ieGetUniqueID(elem)+"::evt_"+type+"::fn_"+handler+"}",f=evtHash[key];
if(typeof f!="undefined"){elem.detachEvent("on"+type,f);delete evtHash[key]}key=null}}function ieGetUniqueID(elem){return elem===window?"theWindow":elem===document?"theDocument":elem.uniqueID}function mouseEnter(_pFn){return function(_evt){var relTarget=_evt.relatedTarget;if(this==relTarget||isAChildOf(this,relTarget)){return}_pFn.call(this,_evt)}}function isAChildOf(_parent,_child){if(_parent==_child){return false}while(_child&&_child!=_parent){_child=_child.parentNode}return _child==_parent}function fixEvent(event){if(event&&event.target)return event;event=event||window.event;event.pageX=event.clientX+nTalk(window).scrollLeft();event.pageY=event.clientY+nTalk(window).scrollTop();event.target=event.srcElement;event.stopPropagation=stopPropagation;event.preventDefault=preventDefault;switch(event.type){case"mouseout":event.relatedTarget=event.toElement;break;case"mouseover":event.relatedTarget=event.fromElement;break}return event}function stopPropagation(){this.cancelBubble=true}function preventDefault(){this.returnValue=false}function fireEvent(elem,type){if(nTalk.browser.msie)try{elem.fireEvent("on"+type)}catch(e){return false}else{var htmlEvent=document.createEvent("HTMLEvents");htmlEvent.initEvent(type,true,true);try{if(elem)elem.dispatchEvent(htmlEvent)}catch(e){}}return true}return{__evtHash:evtHash,addEvent:addEvent,removeEvent:removeEvent,fixEvent:fixEvent,fireEvent:fireEvent}}();nTalk.JSON=function(){var toJSONString,parseJSON,gap,indent,rep,cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,reg=/[\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function quote(string){reg.lastIndex=0;return reg.test(string)?'"'+string.replace(reg,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,partial,mind=gap,value=holder[key];if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(value.hasOwnProperty(k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}toJSONString=function(value,replacer){if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.toString")}return str("",{"":value})};parseJSON=function(text,reviver){var j;function walk(holder,key){var v,value=holder[key];if(value&&typeof value==="object"){for(var k in value){if(value.hasOwnProperty(k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text).replace(/\r|\n/gi,"");if(text)try{text=nTalk.hexToDec(text)}catch(e){}cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.toJSON")};return{toJSONString:toJSONString,parseJSON:parseJSON}}();nTalk.HASH=nTalk.Class.create();nTalk.HASH.prototype={hashTable:null,hashIndex:null,initialize:function(){this.hashTable={};this.hashIndex=[]},add:function(key,value){if(typeof key===core_strUndefined)return false;if(!this.contains(key)){this.hashTable[key]=typeof value!==core_strUndefined?value:null;this.hashIndex.push(key);return true}else{return false}},remove:function(key){var next=this.next(key),i=this.index(key);delete this.hashTable[key];if(i!==false)this.hashIndex.splice(i,1);return this.hashTable[next]},first:function(){for(var k in this.hashTable){if(this.hashTable.hasOwnProperty(k))return this.hashTable[k]}},last:function(){var lastData=null;for(var k in this.hashTable){if(this.hashTable.hasOwnProperty(k)){lastData=this.hashTable[k]}}return lastData},previous:function(key){var preKey=null;for(var k in this.hashTable){if(!this.hashTable.hasOwnProperty(k))continue;if(k==key)return preKey;preKey=k}return preKey},next:function(key){var firstKey=null,getNext=false;for(var k in this.hashTable){if(!this.hashTable.hasOwnProperty(k))continue;if(!firstKey)firstKey=k;if(k==key){getNext=true;continue}if(getNext)return k}return firstKey},count:function(){var i=0;for(var k in this.hashTable){if(this.hashTable.hasOwnProperty(k))i++}return i},items:function(key,value){if(value){this.hashTable[key]=value;return this.hashTable[key]}else{return this.hashTable[key]}},index:function(key){for(var i=0;i<this.hashIndex.length;i++){if(this.hashIndex[i]==key)return i}return false},contains:function(key){return typeof this.hashTable[key]!="undefined"},clear:function(){for(var k in this.hashTable){if(this.hashTable.hasOwnProperty(k)){delete this.hashTable[k]}}this.hashIndex=[]},each:function(Fn){for(var k in this.hashTable){if(k&&this.hashTable.hasOwnProperty(k)){Fn.call(self,k,this.hashTable[k])}}}};nTalk.POST=nTalk.Class.create();nTalk.POST.prototype={iframeName:"",iframeElement:null,formName:"",formElement:null,hiddenElement:null,target:"",CON_TARGET:["_blank","_self","_parent","_top"],_stopCall:false,onComplete:null,onFailure:null,_loaded:false,initialize:function(url,DATA,callback,target){var data=nTalk.merge({},DATA),randomChar=nTalk.randomChar(16);if(nTalk.isArray(callback)){this.onComplete=callback[0]||emptyFunc;this.onFailure=callback[1]||emptyFunc}else{this.onComplete=callback||emptyFunc;this.onFailure=emptyFunc}this.target=target||"POST_IFRAME_"+randomChar;if(nTalk(".nTalk_post_hiddenElement").length>0){this.hiddenElement=nTalk("#nTalk_post_hiddenElement")}else{this.hiddenElement=nTalk({tag:"div",id:"nTalk_post_hiddenElement",style:"left:-10px;top:-10px;visibility:hidden;display:none;width:1px;height:1px;"}).appendTo(true)}if(nTalk.inArray(this.target,this.CON_TARGET)<0){this.iframeName=this.target;this.iframeElement=this.createIFrame(this.iframeName,"about:blank")}this.formName="POST_FORM_"+randomChar;this.formElement=this.form(url,data);try{this.formElement.submit()}catch(e){}},stopCall:function(){this._stopCall=true},createIFrame:function(iFName,uri){var self=this,iFrameElement,fnLoad=function(event){var element=this,readyState=element.readyState;if(!/^(?:loaded|complete|undefined)$/.test(readyState)||self._loaded)return;nTalk(element).removeEvent("readystatechange",fnLoad);nTalk(element).removeEvent("load",fnLoad);nTalk(element).removeEvent("error",fnError);self._loaded=true;if(!self._stopCall){self.onComplete.call(self,event,iFName)}window.frames[iFName]=window[iFName]=null;setTimeout(function(){nTalk(element).remove();nTalk(self.formElement).remove()},800)},fnError=function(event){var element=this;nTalk(element).removeEvent("readystatechange",fnLoad);nTalk(element).removeEvent("load",fnLoad);nTalk(element).removeEvent("error",fnError);if(!self._stopCall){self.onFailure.call(self,event,iFName)}window.frames[iFName]=window[iFName]=null;setTimeout(function(){nTalk(element).remove();nTalk(self.formElement).remove()},50)};if(window[iFName]){return window[iFName]}if(window.frames[iFName]){return window.frames[iFName]}iFrameElement=nTalk({tag:"IFRAME",name:iFName,id:iFName,src:uri,style:"left:-10px;top:-10px;visibility:hidden;width:1px;height:1px;"}).appendTo(this.hiddenElement);if(!nTalk.browser.safari){iFrameElement.css("position","absolute")}iFrameElement.bind("readystatechange",fnLoad).bind("load",fnLoad).bind("error",fnError);window[iFName]=iFrameElement.get(0);return window[iFName]},form:function(url,data){var formElement;formElement=nTalk({tag:"FORM",name:this.formName,"accept-charset":"utf-8",enctype:"application/x-www-form-urlencoded",method:"POST",style:"display:none;",target:this.target,action:url}).appendTo(this.hiddenElement);if(nTalk.isArray(data)){for(var i=0;i<data.length;i++){for(var name in data[i]){if(!data[i].hasOwnProperty(name))continue;this.input(name+"[]",data[i][name],formElement)}}}else{for(var y in data){if(!data.hasOwnProperty(y))continue;if(nTalk.isArray(data[y])){for(var j=0;j<data[y].length;j++){this.input(y+"[]",data[y][j],formElement)}}else{this.input(y,data[y],formElement)}}}return formElement.get(0)},input:function(name,value,parent){return nTalk({tag:"INPUT",type:"hidden",name:name,value:encodeURIComponent(/number|string/.test(typeof value)?value:nTalk.JSON.toJSONString(value))}).appendTo(parent)}};nTalk.extend({inArray:function(value,array){if(array.length==core_strUndefined){for(var name in array){if(!array.hasOwnProperty(name))continue;if(array[name]==value)return name}}else{for(var i=0,len=array.length;i<len;i++){if(array[i]==value)return i}}return-1},toURI:function(args,clearNull,separator){var t=[],sp=separator===undefined?"&":separator,add=function(k,v){var h=sp=="&"?k+"=":"",type=typeof args[name];switch(type){case"object":return v?h+encodeURIComponent(nTalk.JSON.toJSONString(v)):clearNull?"":h;case"function":case"undefined":return"";case"boolean":case"number":return h+v;default:return v?h+encodeURIComponent(v.replace(/\+/gi,"%2B")):clearNull?"":h}};if(nTalk.isPlainObject(args)){for(var name in args){if(!args.hasOwnProperty(name))continue;var kv=add(name,args[name]);if(kv)t.push(kv)}}else{return""}return t.join(sp).replace(/%20/g,"+")},uriToJSON:function(str){var target={},arr=str.toString().split("&");for(var arg,i=0;i<arr.length;i++){arg=arr[i].split("=");if(arg.length<2)continue;try{target[arg[0]]=decodeURIComponent(arg[1]||"")}catch(e){target[arg[0]]=arg[1]}}return target},whereGetTo:function(to,form,formkeys,tokeys){return nTalk.merge(to,this.whereGet(form,formkeys,tokeys))},whereGet:function(form,formkeys,tokeys,callback){var target={};if(formkeys&&nTalk.isArray(formkeys)){for(var i=0,l=formkeys.length;i<l;i++){if(tokeys&&tokeys[i]&&tokeys[i]!==formkeys[i])target[tokeys[i]]=!nTalk.isDefined(form[formkeys[i]])?"":form[formkeys[i]];else target[formkeys[i]]=!nTalk.isDefined(form[formkeys[i]])?"":form[formkeys[i]]}}else{target=form}if(!nTalk.isFunction(callback))return target;for(var k in target){if(!target.hasOwnProperty(k))continue;callback.call(this,target[k])}},enLength:function(str){str=str||"";try{return str.toString().replace(/[^\x00-\xFF]/g,"**").length}catch(e){nTalk.Log(e,3)}},enCut:function(str,len,ext){var l=nTalk.enLength(str);len=len||0;if(l<len){return""+(str||"")}for(var r=0,i=0;i<str.length;i++){r+=str.charCodeAt(i)>255?2:1;if(r==len||ext&&r==len-2){return str.substring(0,i+1)+(ext?"..":"")}else if(r>len||ext&&r>len-2){return str.substring(0,i)+(ext?"..":"")}}return str||""},camelize:function(word){return word.replace("-ms-","ms-").replace(rCamelCase,function(match,letter){return(letter+"").toUpperCase()})},clearHtml:function(html){html=html||"";return html.replace(clearHtmlExp,"")},protocolFilter:function(data,protocol){protocol=nTalk.flashserver.usehttps==1?"https:":protocol||nTalk.protocol;if(protocol=="file:"){protocol="http:"}if(nTalk.isObject(data)){for(var k in data){if(data.hasOwnProperty(k)){data[k]=this.protocolFilter(data[k],protocol)}}return data}else if(nTalk.isArray(data)){for(var i=0;i<data.length;i++){data[i]=this.protocolFilter(data[i],protocol)}return data}else if(nTalk.isNumeric(data)||nTalk.isBoolean(data)||nTalk.isFunction(data)){return data}else if(typeof data!=="undefined"){return!data?data:data.toString().replace(/^https?:/gi,protocol).replace(/^rtmps?:/gi,protocol=="https:"?"rtmps:":"rtmp:").replace(/^wss?:/gi,protocol=="https:"?"wss:":"ws:")}},decToHex:function(source){var res=[];for(var i=0;i<source.length;i++){if(/[\u4e00-\u9fa5]/i.test(source.charAt(i))){res[i]="\\u"+("00"+source.charCodeAt(i).toString(16)).slice(-4)}else{res[i]=source.charAt(i)}}return res.join("")},hexToDec:function(source){if(!source)return"";var reg=/\\u([0-9a-zA-Z]{2,4})|&#(\d+);/gi;var arrs=source.match(reg),strOutScript=source;if(!arrs){return strOutScript}else{for(var i=0;i<=arrs.length;i++){if(!arrs[i])continue;var strHex,strChar,isError=false;strHex=arrs[i].replace("\\u","");for(var j=0;j<strHex.length;j++){if("0123456789abcdef".indexOf(strHex.charAt(j))==-1){isError=true}}if(!isError){strChar=String.fromCharCode(parseInt(strHex,16));strOutScript=strOutScript.replace(arrs[i],strChar)}}}return strOutScript}});nTalk.extend({Element:function(tag,options){var elem,html,attr="";tag=tag.toLocaleUpperCase();if(nTalk.inArray(tag,["IFRAME","FORM","INPUT","SELECT","TEXTAREA"])>-1){try{if(tag=="FORM"){attr=(options.method?' method="'+options.method+'"':"")+(options.enctype?' enctype="'+options.enctype+'"':"")}html="<"+tag+' name="'+(options.name||nTalk.randomChar(16))+'"'+attr+"></"+tag+">";elem=document.createElement(html);delete options.name}catch(e){elem=document.createElement(tag)}}else{elem=tag==="comment"?document.createComment(options.text||""):document.createElement(tag)}if(options){nTalk.each(options,function(name,value){try{switch(name){case"css":case"style":elem.style.cssText=value;break;case"innerHTML":case"html":elem.innerHTML=value;break;case"className":case"class":elem.className=value;break;case"text":elem.textContent=value;break;default:elem.setAttribute(name,value);break}}catch(e){}})}return elem},insert:function(rootElement,html,where){var range,frag;rootElement=rootElement||document.body;where=where?where.toLowerCase():"afterbegin";if(rootElement.insertAdjacentHTML){switch(where.toLowerCase()){case"beforebegin":rootElement.insertAdjacentHTML("BeforeBegin",html);return rootElement.previousSibling;case"afterbegin":rootElement.insertAdjacentHTML("AfterBegin",html);return rootElement.firstChild;case"afterend":rootElement.insertAdjacentHTML("AfterEnd",html);return rootElement.nextSibling;default:rootElement.insertAdjacentHTML("BeforeEnd",html);return rootElement.lastChild}}range=rootElement.ownerDocument.createRange();switch(where){case"beforebegin":range.setStartBefore(rootElement);frag=range.createContextualFragment(html);rootElement.parentNode.insertBefore(frag,rootElement);return rootElement.previousSibling;case"afterbegin":if(rootElement.firstChild){range.setStartBefore(rootElement.firstChild);frag=range.createContextualFragment(html);rootElement.insertBefore(frag,rootElement.firstChild)}else{rootElement.innerHTML=html}return rootElement.firstChild;case"beforeend":if(rootElement.lastChild){range.setStartAfter(rootElement.lastChild);frag=range.createContextualFragment(html);rootElement.appendChild(frag)}else{rootElement.innerHTML=html}return rootElement.lastChild;case"afterend":range.setStartAfter(rootElement);frag=range.createContextualFragment(html);rootElement.parentNode.insertBefore(frag,rootElement.nextSibling);return rootElement.nextSibling}throw'Illegal insertion point -> "'+where+'"'},flashHtml:function(movieName,src,data,attr){attr=nTalk.extend({width:1,height:1,style:"",wmode:"opaque"},attr);if(nTalk.browser.oldmsie){var ljf=src.indexOf("?")>-1?"&":"?";src+=ljf+"rnd="+Math.floor(Math.random()*1e3)}return nTalk.browser.msie&&nTalk.browser.ieversion<11?['<object id="',movieName,'" name="',movieName,'" width="',attr.width,'" height="',attr.height,'" style="',attr.style,'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="https://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,28">','<param name="wmode" value="',attr.wmode,'" />','<param name="movie" value="',src,'" />','<param name="allowscriptaccess" value="always" />','<param name="flashvars" value="',nTalk.toURI(data,true),'" />',"</object>"].join(""):nTalk.browser.msie&&nTalk.browser.ieversion>=11?['<object id="',movieName,'"  name="',movieName,'" data="',src,'" width="',attr.width,'" height="',attr.height,'" style="',attr.style,'" type="application/x-shockwave-flash">','<param name="wmode" value="',attr.wmode,'"/>','<param name="movie" value="',src,'"/>','<param name="quality" value="high"/>','<param name="allowscriptaccess" value="always"/>','<param name="flashvars" value="',nTalk.toURI(data,true),'"/>',"</object>"].join(""):['<embed id="',movieName,'" name="',movieName,'" src="'+src+'" width="',attr.width,'" height="',attr.height,'" style="',attr.style,'" flashvars="',nTalk.toURI(data,true),'" wmode="',attr.wmode,'" allowscriptaccess="always" pluginspage="https://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash" >',"</embed>"].join("")},_vendorPropName:function(style,name){if(name in style){return name}var cssPrefixes=["Webkit","O","Moz","ms"],capName=name.charAt(0).toUpperCase()+name.slice(1),origName=name,i=cssPrefixes.length;while(i--){name=cssPrefixes[i]+capName;if(name in style){return name}}return origName},css:function(elem,name,value){var opacity,origName,opacityExp=/\s*alpha\(opacity=([^)]*)\)\s*/gi;if(!elem){return false}if(value===undefined){origName=nTalk.camelize(name);if(document.defaultView&&document.defaultView.getComputedStyle){value=document.defaultView.getComputedStyle(elem,null).getPropertyValue(name);return value==="auto"||value===""?0:value}else{name=nTalk.cssProps[origName]||nTalk._vendorPropName(elem.style,origName);value=name==="opacity"?/opacity=([^)]*)/.test(elem.currentStyle.filter)?.01*parseFloat(RegExp.$1)+"":1:elem.style[name]||(elem.currentStyle?elem.currentStyle[name]:null);if(name==="backgroundPosition"&&nTalk.browser.msie&&nTalk.browser.ieversion<=8){value=elem.style[name+"X"]||(elem.currentStyle?elem.currentStyle[name+"X"]:null);value=value+" "+elem.style[name+"Y"]||(elem.currentStyle?elem.currentStyle[name+"Y"]:null)}return value==="auto"?0:value}}else{if(document.documentElement.style.opacity!==undefined){try{elem.style[nTalk.camelize(name)]=value}catch(e0){return false}return true}else{if(!elem.currentStyle||!elem.currentStyle.hasLayout){elem.style.zoom=1}if(name==="opacity"){try{elem.style.filter=value==1?"none":(elem.currentStyle||elem.style).filter.replace(opacityExp,"")+" alpha(opacity="+value*100+")"}catch(e1){}elem.style.zoom=1}else try{elem.style[nTalk.camelize(name)]=value}catch(e0){return false}return true}}},attr:function(el,name,value){if(!el)return;if(typeof value!="undefined"){if(value==="")el.removeAttribute(name);else el.setAttribute(name,value);return value}else{return el.getAttribute?el.getAttribute(name):el[name]||""}},addClass:function(elem,classname){if(!elem)return false;if(this.indexOfClass(elem,classname)){return false}else{var srcClass=elem.className.split(/\s+/).join(" ");elem.className=(srcClass?srcClass+" ":"")+classname;return true}},removeClass:function(elem,classname){if(!elem||!elem.className){return false}else{elem.className=elem.className.replace(new RegExp("(^|\\s+)"+classname+"(\\s+|$)","i")," ");return true}},indexOfClass:function(elem,classname){if(!elem||!elem.className){return false}else{return new RegExp("(^|\\b)"+classname+"(\\s|$)","gi").test(elem.className)}},contains:function(parent,elem){if(elem){while(elem=elem.parentNode){if(elem===parent){return true}}}return false}});nTalk.position=nTalk.Class.create();nTalk.position.prototype={defaultOptions:{left:null,top:null,width:null,height:null,right:null,bottom:null,fixed:true,resize:false},timer:0,repwidth:"",repheight:"",inited:false,direction:"left",initialize:function(element,options){var offset;nTalk.extend(this,this.defaultOptions,options);this.element=element.talkVersion?element:nTalk(element);if(!this.width){this.width=this.element.width()}else if(this.width=="auto"){this.repwidth="auto";this.width=this.element.width()}if(!this.height){this.height=this.element.height()}else if(this.height=="auto"){this.repheight="auto";this.height=this.element.height()}this.offset=nTalk(window).offset();this.quirks=nTalk.browser.msie6||nTalk.browser.Quirks&&nTalk.browser.oldmsie;if(this.left===null){this.direction="right"}if(this.left===null&&this.right===null){offset=this.element.offset();this.left=offset.left;this.top=offset.top}this.right=this.right===null?nTalk(window).width()-this.left-this.width:this.right;this.bottom=this.bottom===null?nTalk(window).height()-this.top-this.height:this.bottom;this.left=this.left===null?nTalk(window).width()-this.right-this.width:this.left;this.top=this.top===null?nTalk(window).height()-this.bottom-this.height:this.top;if(this.fixed){this.fixedPosition({left:this.left,top:this.top,right:this.right,bottom:this.bottom})}else{this.animationPosition()}},fixedPosition:function(options){var self=this,offset,scrollTop;if(this.quirks){offset=nTalk(window).offset();scrollTop=nTalk(window).scrollTop();this.element.css({position:"absolute",width:this.repwidth?this.repwidth:this.width+"px",height:this.repheight?this.repheight:this.height+"px",left:options.left+offset.left+"px",top:options.top+offset.top+"px"});var leftExpression=["expression(eval(Math.max((document.documentElement.scrollLeft || document.body.scrollLeft), (document.documentElement.scrollLeft || document.body.scrollLeft) + "+options.left+")))","expression(eval(Math.max((document.documentElement.scrollLeft || document.body.scrollLeft), (document.documentElement.scrollLeft || document.body.scrollLeft) + (document.documentElement.clientWidth  || document.body.clientWidth ) - this.offsetWidth  - "+options.right+")))"];var topExpression=["expression(eval(Math.max((document.documentElement.scrollTop  || document.body.scrollTop ), (document.documentElement.scrollTop  || document.body.scrollTop ) + "+options.top+")))","expression(eval(Math.max((document.documentElement.scrollTop  || document.body.scrollTop ), (document.documentElement.scrollTop  || document.body.scrollTop ) + (document.documentElement.clientHeight || document.body.clientHeight) - this.offsetHeight - "+options.bottom+")))"];if(nTalk.isFunction(this.element.get(0).style.getExpression)){if(this.direction=="left"){this.element.Expression("left",leftExpression[0]);this.element.Expression("top",topExpression[0])}else{this.element.Expression("left",leftExpression[1]);this.element.Expression("top",topExpression[1])}}else{nTalk(window).scrollTop(scrollTop+1);if(this.direction=="left"){this.element.replaceIEcssText({left:leftExpression[0],top:topExpression[0]})}else{this.element.replaceIEcssText({left:leftExpression[1],top:topExpression[1]})}nTalk(window).scrollTop(scrollTop)}}else{offset={position:"fixed",width:this.repwidth?this.repwidth:this.width+"px",height:this.repheight?this.repheight:this.height+"px"};if(this.direction=="left"){offset.left=options.left+"px";offset.top=options.top+"px"}else{offset.right=options.right+"px";offset.bottom=options.bottom+"px"}this.element.css(offset)}if(this.resize&&!this.inited){nTalk.Event.addEvent(window,"resize",function(event){self.resizeFixed(event)})}this.inited=true},resizeFixed:function(){var style=[];if(this.direction=="left"){style.left=Math.max(0,Math.min(this.left,nTalk(window).width()-this.width));style.top=Math.max(0,Math.min(this.top,nTalk(window).height()-this.height));style.right=nTalk(window).width()-style.left-this.width;style.bottom=nTalk(window).height()-style.top-this.height}else{style.right=Math.min(this.right,nTalk(window).width()-this.width);style.bottom=Math.min(this.bottom,nTalk(window).height()-this.height);style.left=nTalk(window).width()-style.right-this.width;style.top=nTalk(window).height()-style.bottom-this.height;if(style.left<0||style.top<0){style.left=Math.max(0,style.left);style.top=Math.max(0,style.top);style.right=nTalk(window).width()-style.left-this.width;style.bottom=nTalk(window).height()-style.top-this.height}}this.fixedPosition(style)},clearExpression:function(){if(this.quirks){var offset=nTalk(window).offset();this.element.Expression("left","");this.element.Expression("top","");this.element.css({left:this.left+offset.left+"px",top:this.top+offset.top+"px"})}},animationPosition:function(){}};nTalk.extend({myString:function(text){str=new String(text||"");str.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")};str.linkFilter=function(style){return this.toString().replace(/((\w+):\/\/)?([\w-]+\.)?([\w-]+\.)?([\w-]+\.)([a-zA-Z\-_\.]+)([^$\s,\"\u4E00-\u9FA5]*)?/gi,function(a,b,c,d,e,f,g,h){var blankURL=(b||"http://")+(d||"")+(e||"")+(f||"")+(g||"")+(h||"");return'<a href="'+blankURL.replace(/(^\s+)|(\s+$)/gi,"")+'" target="_blank" style="'+(style||"")+'">'+(b||"")+(d||"")+(e||"")+(f||"")+(g||"")+(h||"")+"</a>"})};str.linkFilter1=function(cssText){var yuanshi=this.toString();if(yuanshi.indexOf("rightTag=true")>-1){return yuanshi}var regMail=new RegExp(/[\w!#$%&'*+\/=?^_`{|}~-]+(?:\.[\w!#$%&'*+\/=?^_`{|}~-]+)*@(?:[\w](?:[\w-]*[\w])?\.)+[\w](?:[\w-]*[\w])?/);if(regMail.test(yuanshi)){return yuanshi}return this.toString().replace(/((\w+):\/\/)?([\w-]+\.)?([\w-]+\.)?([\w-]+\.)([a-zA-Z\-_\.]+)([^$\s,\uFF0C\u3002\"\u4E00-\u9FA5]*)?/gi,function(a,b,c,d,e,f,g,h){var blankURL=((b||"http://")+(d||"")+(e||"")+(f||"")+(g||"")+(h||"")).replace(/(^\s+)|(\s+$)/gi,"");var linkClass=""+nTalk.randomChar(16);return['<div style="',nTalk.STYLE_BODY,'"><a href="',blankURL,'" target="_blank" style="',cssText||"",'">',b||"",d||"",e||"",f||"",g||"",h||"",'</a></div><div class="ntalk-link-contains ',linkClass,'" data-source="',blankURL,'" style="',cssText,'"></div>'].join("")})};str.sprintf=function(){var len=arguments.length,r=this;if(len<1||!RegExp)return r.toString();for(var a=0;a<len;a++){r=r.replace(new RegExp("%"+(a+1),"g"),(arguments[a]+"").replace(/%\d/g,"").toString())}return r};return str},cssNumber:{columnCount:true,fillOpacity:true,fontWeight:true,lineHeight:true,opacity:true,zIndex:true,zoom:true},cssProps:{"float":"cssFloat"},unit:function(name,value){if(this.cssNumber[name]){return""}var unit=(value+"").replace(cssValueExp,"");return unit===""?"px":unit},valHooks:{option:{get:function(elem){return elem.value||elem.text}},select:{get:function(elem){var value,i,max,option,index=elem.selectedIndex,values=[],options=elem.options,one=elem.type==="select-one";if(index<0)return null;i=one?index:0;max=one?index+1:options.length;for(;i<max;i++){option=options[i];if(option.selected&&option.getAttribute("disabled")===null&&(!option.parentNode.disabled&&option.parentNode.tagName.toUpperCase()!=="OPTGROUP")){value=nTalk(option).val();if(one)return value;values.push(value)}}if(one&&!values.length&&options.length){return nTalk(options[index]).val()}return values},set:function(elem,value){var values=nTalk.isArray(value)?value:[value];nTalk(elem).find("option").each(function(){this.selected=nTalk.inArray(nTalk(this).val(),values)>=0});if(!values.length){elem.selectedIndex=-1}return values}}},MD5:function(string){function RotateLeft(lValue,iShiftBits){return lValue<<iShiftBits|lValue>>>32-iShiftBits}function AddUnsigned(lX,lY){var lX4,lY4,lX8,lY8,lResult;lX8=lX&2147483648;lY8=lY&2147483648;lX4=lX&1073741824;lY4=lY&1073741824;lResult=(lX&1073741823)+(lY&1073741823);if(lX4&lY4){return lResult^2147483648^lX8^lY8}if(lX4|lY4){if(lResult&1073741824){return lResult^3221225472^lX8^lY8}else{return lResult^1073741824^lX8^lY8}}else{return lResult^lX8^lY8}}function F(x,y,z){return x&y|~x&z}function G(x,y,z){return x&z|y&~z}function H(x,y,z){return x^y^z}function I(x,y,z){return y^(x|~z)}function FF(a,b,c,d,x,s,ac){a=AddUnsigned(a,AddUnsigned(AddUnsigned(F(b,c,d),x),ac));return AddUnsigned(RotateLeft(a,s),b)}function GG(a,b,c,d,x,s,ac){a=AddUnsigned(a,AddUnsigned(AddUnsigned(G(b,c,d),x),ac));return AddUnsigned(RotateLeft(a,s),b)}function HH(a,b,c,d,x,s,ac){a=AddUnsigned(a,AddUnsigned(AddUnsigned(H(b,c,d),x),ac));return AddUnsigned(RotateLeft(a,s),b)}function II(a,b,c,d,x,s,ac){a=AddUnsigned(a,AddUnsigned(AddUnsigned(I(b,c,d),x),ac));return AddUnsigned(RotateLeft(a,s),b)}function ConvertToWordArray(string){var lWordCount;var lMessageLength=string.length;var lNumberOfWords_temp1=lMessageLength+8;var lNumberOfWords_temp2=(lNumberOfWords_temp1-lNumberOfWords_temp1%64)/64;var lNumberOfWords=(lNumberOfWords_temp2+1)*16;var lWordArray=Array(lNumberOfWords-1);var lBytePosition=0;var lByteCount=0;while(lByteCount<lMessageLength){lWordCount=(lByteCount-lByteCount%4)/4;lBytePosition=lByteCount%4*8;lWordArray[lWordCount]=lWordArray[lWordCount]|string.charCodeAt(lByteCount)<<lBytePosition;lByteCount++}lWordCount=(lByteCount-lByteCount%4)/4;lBytePosition=lByteCount%4*8;lWordArray[lWordCount]=lWordArray[lWordCount]|128<<lBytePosition;lWordArray[lNumberOfWords-2]=lMessageLength<<3;lWordArray[lNumberOfWords-1]=lMessageLength>>>29;return lWordArray}function WordToHex(lValue){var WordToHexValue="",WordToHexValue_temp="",lByte,lCount;for(lCount=0;lCount<=3;lCount++){lByte=lValue>>>lCount*8&255;WordToHexValue_temp="0"+lByte.toString(16);WordToHexValue=WordToHexValue+WordToHexValue_temp.substr(WordToHexValue_temp.length-2,2)}return WordToHexValue}function Utf8Encode(string){string=string.replace(/\r\n/g,"\n");var utftext="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c)}else if(c>127&&c<2048){utftext+=String.fromCharCode(c>>6|192);utftext+=String.fromCharCode(c&63|128)}else{utftext+=String.fromCharCode(c>>12|224);utftext+=String.fromCharCode(c>>6&63|128);utftext+=String.fromCharCode(c&63|128)}}return utftext}var x=Array();var k,AA,BB,CC,DD,a,b,c,d;var S11=7,S12=12,S13=17,S14=22;var S21=5,S22=9,S23=14,S24=20;var S31=4,S32=11,S33=16,S34=23;var S41=6,S42=10,S43=15,S44=21;string=Utf8Encode(string);x=ConvertToWordArray(string);a=1732584193;b=4023233417;c=2562383102;d=271733878;for(k=0;k<x.length;k+=16){AA=a;BB=b;CC=c;DD=d;a=FF(a,b,c,d,x[k+0],S11,3614090360);d=FF(d,a,b,c,x[k+1],S12,3905402710);c=FF(c,d,a,b,x[k+2],S13,606105819);b=FF(b,c,d,a,x[k+3],S14,3250441966);a=FF(a,b,c,d,x[k+4],S11,4118548399);d=FF(d,a,b,c,x[k+5],S12,1200080426);c=FF(c,d,a,b,x[k+6],S13,2821735955);b=FF(b,c,d,a,x[k+7],S14,4249261313);a=FF(a,b,c,d,x[k+8],S11,1770035416);d=FF(d,a,b,c,x[k+9],S12,2336552879);c=FF(c,d,a,b,x[k+10],S13,4294925233);b=FF(b,c,d,a,x[k+11],S14,2304563134);a=FF(a,b,c,d,x[k+12],S11,1804603682);d=FF(d,a,b,c,x[k+13],S12,4254626195);c=FF(c,d,a,b,x[k+14],S13,2792965006);b=FF(b,c,d,a,x[k+15],S14,1236535329);a=GG(a,b,c,d,x[k+1],S21,4129170786);d=GG(d,a,b,c,x[k+6],S22,3225465664);c=GG(c,d,a,b,x[k+11],S23,643717713);b=GG(b,c,d,a,x[k+0],S24,3921069994);a=GG(a,b,c,d,x[k+5],S21,3593408605);d=GG(d,a,b,c,x[k+10],S22,38016083);c=GG(c,d,a,b,x[k+15],S23,3634488961);b=GG(b,c,d,a,x[k+4],S24,3889429448);a=GG(a,b,c,d,x[k+9],S21,568446438);d=GG(d,a,b,c,x[k+14],S22,3275163606);c=GG(c,d,a,b,x[k+3],S23,4107603335);b=GG(b,c,d,a,x[k+8],S24,1163531501);a=GG(a,b,c,d,x[k+13],S21,2850285829);d=GG(d,a,b,c,x[k+2],S22,4243563512);c=GG(c,d,a,b,x[k+7],S23,1735328473);b=GG(b,c,d,a,x[k+12],S24,2368359562);a=HH(a,b,c,d,x[k+5],S31,4294588738);d=HH(d,a,b,c,x[k+8],S32,2272392833);c=HH(c,d,a,b,x[k+11],S33,1839030562);b=HH(b,c,d,a,x[k+14],S34,4259657740);a=HH(a,b,c,d,x[k+1],S31,2763975236);d=HH(d,a,b,c,x[k+4],S32,1272893353);c=HH(c,d,a,b,x[k+7],S33,4139469664);b=HH(b,c,d,a,x[k+10],S34,3200236656);a=HH(a,b,c,d,x[k+13],S31,681279174);d=HH(d,a,b,c,x[k+0],S32,3936430074);c=HH(c,d,a,b,x[k+3],S33,3572445317);b=HH(b,c,d,a,x[k+6],S34,76029189);a=HH(a,b,c,d,x[k+9],S31,3654602809);d=HH(d,a,b,c,x[k+12],S32,3873151461);c=HH(c,d,a,b,x[k+15],S33,530742520);b=HH(b,c,d,a,x[k+2],S34,3299628645);a=II(a,b,c,d,x[k+0],S41,4096336452);d=II(d,a,b,c,x[k+7],S42,1126891415);c=II(c,d,a,b,x[k+14],S43,2878612391);b=II(b,c,d,a,x[k+5],S44,4237533241);
a=II(a,b,c,d,x[k+12],S41,1700485571);d=II(d,a,b,c,x[k+3],S42,2399980690);c=II(c,d,a,b,x[k+10],S43,4293915773);b=II(b,c,d,a,x[k+1],S44,2240044497);a=II(a,b,c,d,x[k+8],S41,1873313359);d=II(d,a,b,c,x[k+15],S42,4264355552);c=II(c,d,a,b,x[k+6],S43,2734768916);b=II(b,c,d,a,x[k+13],S44,1309151649);a=II(a,b,c,d,x[k+4],S41,4149444226);d=II(d,a,b,c,x[k+11],S42,3174756917);c=II(c,d,a,b,x[k+2],S43,718787259);b=II(b,c,d,a,x[k+9],S44,3951481745);a=AddUnsigned(a,AA);b=AddUnsigned(b,BB);c=AddUnsigned(c,CC);d=AddUnsigned(d,DD)}var temp=WordToHex(a)+WordToHex(b)+WordToHex(c)+WordToHex(d);return temp.toLowerCase()}});nTalk.each(["radio","checkbox"],function(i,key){nTalk.valHooks[key]={get:function(elem){return elem.getAttribute("value")===null?"on":elem.value}}});nTalk.each(["radio","checkbox"],function(i,key){nTalk.valHooks[key]=nTalk.extend(nTalk.valHooks[key],{set:function(elem,value){elem.checked=nTalk.inArray(nTalk(elem).val(),value)>=0;return elem.checked}})});nTalk.fn.extend({bind:function(event,fn){return nTalk.access(this,function(element,event,fn){nTalk.Event.addEvent(element,event,fn)},event,fn,1)},addEvent:function(event,fn){return this.bind(event,fn)},click:function(fn){return this.bind("click",fn)},hover:function(fnOver,fnOut){return nTalk.access(this,function(element,fnOver,fnOut){nTalk.Event.addEvent(element,"mouseover",fnOver);nTalk.Event.addEvent(element,"mouseout",fnOut);return nTalk(element)},fnOver,fnOut||emptyFunc)},removeEvent:function(event,fn){return nTalk.access(this,function(element,event,fn){if(fn===undefined)element.onclick=null;else nTalk.Event.removeEvent(element,event,fn)},event,fn,1)},fire:function(event){return nTalk.access(this,function(element,event,o){nTalk.Event.fireEvent(element,event)},event,"",1)},insert:function(html,where){return nTalk(nTalk.insert(this[0],html,where))},html:function(html,clearNull){if(html!==undefined)return nTalk.each(this,function(i,element){element.innerHTML=html});else{if(nTalk.isBoolean(clearNull)&&clearNull){return(this.length?this.get(0).innerHTML:"").replace(/(^\s+)|(\s+$)/gi,"")}else{return this.length?this.get(0).innerHTML:""}}},append:function(content){return nTalk.each(this,function(i,element){nTalk.insert(element,content,"beforeend")})},appendTo:function(selector,before){var parent,body=document.body||nTalk("body")[0]||document.documentElement;if(typeof selector=="boolean"){before=selector;selector=null}if(!selector||typeof selector=="string"){parent=nTalk(selector||body)[0]}else{if(selector.talkVersion){parent=selector.length?selector[0]:nTalk(body)[0]}else{parent=selector}}return nTalk.each(this,function(i,element){var tagName=parent.tagName.toLocaleUpperCase();if(before&&before.talkVersion&&before.length){return parent.insertBefore(element,before.get(0))}else if(before&&before.nodeType==1){return parent.insertBefore(element,before)}else if(before===true){return parent.insertBefore(element,parent.firstChild)}else if(readyComplete||tagName!="BODY"){try{return parent.appendChild(element)}catch(e){}}else{return nTalk.insert(parent,element.outerHTML,"beforeend")}})},replace:function(node){nTalk.each(this,function(i,element){if(element.replaceNode){element.replaceNode(node)}else{try{element.parentNode.appendChild(node);element.parentNode.removeChild(element)}catch(e){}}});return nTalk(node)},find:function(selector){var child=this.constructor.selector.query(selector,this);return this.pushStack(child)},parent:function(level){var parent=this.get(0);level=level||1;if(!parent||!parent.parentNode||!this.length){return null}while(level>0&&parent.parentNode&&parent.parentNode.nodeType!==11){parent=parent.parentNode;level--}return parent?nTalk(parent):null},child:function(){return this.find("*")},remove:function(){return nTalk.each(this,function(i,element){var removeComplete=false;for(var methodName in element){if(element.tagName.toUpperCase()=="IFRAME")continue;try{if(typeof element[methodName]==="function"){element[methodName]=null}}catch(e){nTalk.Log("remove("+element.tagName+"):"+e.message,3)}}if(element.parentNode){try{element.parentNode.removeChild(element);removeComplete=true}catch(e){}}if(!removeComplete){var tElement=document.createElement("DIV");try{tElement.appendChild(element);tElement.innerHTML="";if(tElement.parentNode)tElement.parentNode.removeChild(tElement)}catch(e1){}}})},css:function(name,value){return nTalk.access(this,function(elem,name,value){return value!==undefined?nTalk.css(elem,name,value):nTalk.css(elem,name)},name,value,arguments.length>1)},cssText:function(value){return nTalk.access(this,function(elem,name,value){return value!==undefined?elem.style.cssText=value:elem.style.cssText},"",value,arguments.length>1)},attr:function(name,value){return nTalk.access(this,function(elem,name,value){return value!==undefined?nTalk.attr(elem,name,value):nTalk.attr(elem,name)},name,value,arguments.length>1)},display:function(block){return nTalk.each(this,function(i,element){nTalk.css(element,"display",block?"block":"none")})},replaceIEcssText:function(name,value){return nTalk.access(this,function(elem,name,value){value=value||"";var cssText=";"+elem.style.cssText,pattern=new RegExp(";\\s*"+name+":\\s*(.*?);","ig"),content=";"+name+":"+value+";",exisit=pattern.test(cssText);if(exisit){elem.style.cssText=cssText.replace(pattern,content)}else{elem.style.cssText=cssText+content}},name,value,arguments.length>1)},Expression:function(name,value){return nTalk.access(this,function(elem,name,value){if(!("getExpression"in elem.style)){return}if(value===undefined)return elem.style.getExpression(name);else if(value==="")return elem.style.removeExpression(name);else return elem.style.setExpression(name,value)},name,value,arguments.length>1)},curClass:function(){return this.length?this.get(0).className:""},addClass:function(value){return nTalk.each(this,function(i,element){nTalk.addClass(element,value)})},removeClass:function(value){return nTalk.each(this,function(i,element){nTalk.removeClass(element,value)})},indexOfClass:function(class1){return nTalk.indexOfClass(this[0],class1)},replaceClass:function(class1,class2){return nTalk.each(this,function(i,element){nTalk.addClass(element,class1);nTalk.removeClass(element,class2)})},val:function(value){if(!this.length)return"";var hooks,ret,radio,elem=this[0];if(!arguments.length){hooks=nTalk.valHooks[elem.nodeName.toLowerCase()];if(hooks&&"get"in hooks&&(ret=hooks.get(elem,"value"))!==undefined){return ret}hooks=nTalk.valHooks[elem.type];if(hooks&&"get"in hooks){radio=this[0].type=="radio";for(var values=[],i=0;i<this.length;i++){if((ret=hooks.get(this[i],"value"))!==undefined&&this[i].checked){if(radio)return ret;else values.push(ret)}}return radio?"":values}ret=this[0].value;return typeof ret==="string"?ret:ret===null?"":ret}else{return nTalk.each(this,function(i,elem){if(value===null){value=""}hooks=nTalk.valHooks[elem.type]||nTalk.valHooks[elem.nodeName.toLowerCase()];if(!hooks||!("set"in hooks)||hooks.set(this,value,"value")===undefined){elem.value=value}})}},width:function(value){var curElem;if(this.length>0){curElem=this[0]}else{return 0}if(nTalk.isWindow(curElem)){return nTalk.browser.Quirks&&!nTalk.browser.msie?document.documentElement.clientWidth:document.documentElement.clientWidth||document.body.clientWidth||window.innerWidth}else{return value===undefined?curElem.offsetWidth:curElem.offsetWidth=value}},height:function(value){var curElem;if(this.length){curElem=this[0]}else{return 0}if(nTalk.isWindow(curElem)){return nTalk.browser.Quirks&&!nTalk.browser.msie?window.innerHeight:document.documentElement.clientHeight||document.body.clientHeight||window.innerHeight}else{return value===undefined?curElem.offsetHeight:curElem.offsetHeight=value}},scrollHeight:function(value){var curElem;if(this.length){curElem=this[0]}else{return 0}if(nTalk.isWindow(curElem)){return window.innerHeight||document.documentElement.scrollHeight||document.body.scrollHeight}else{try{return value===undefined?curElem.scrollHeight:curElem.scrollHeight=value}catch(e){return 0}}},scrollLeft:function(value){var curElem;if(this.length){curElem=this[0]}else{return 0}if(nTalk.isWindow(curElem)){if(value===undefined){try{var sLeft=document.documentElement.scrollLeft||window.pageXOffset;return Math.max(sLeft,document.body?document.body.scrollLeft:0)||0}catch(e){return 0}}else{document.documentElement.scrollLeft=value;document.body.scrollLeft=value}}else{return value===undefined?curElem.scrollLeft:curElem.scrollLeft=value}},scrollTop:function(value){var curElem;if(this.length){curElem=this[0]}else{return 0}if(nTalk.isWindow(curElem)){if(value===undefined){return document.documentElement.scrollTop||window.pageYOffset||document.body.scrollTop}else{document.documentElement.scrollTop=value;if(document.documentElement.scrollTop!=value){document.body.scrollTop=value}}}else{return value===undefined?curElem.scrollTop:curElem.scrollTop=value}},offset:function(options){if(arguments.length){return options===undefined?this:this.each(function(i,elem){nTalk.offset.setOffset(elem,options,i)})}var docElem,elem=this[0],box={top:0,left:0},doc=elem&&elem.ownerDocument;if(nTalk.isWindow(elem)){return{top:nTalk(elem).scrollTop(),left:nTalk(elem).scrollLeft()}}if(!doc){return box}docElem=doc.documentElement;if(!nTalk.contains(docElem,elem)){return box}if(typeof elem.getBoundingClientRect!==core_strUndefined){box=elem.getBoundingClientRect()}return{top:box.top+nTalk(window).scrollTop()-docElem.clientTop,left:box.left+nTalk(window).scrollLeft()-docElem.clientLeft}},fixed:function(options){return nTalk.each(this,function(i,elem){new nTalk.position(elem,options)})}});nTalk.offset={setOffset:function(elem,options){var curCSSTop,curOffset,curCSSLeft,position=nTalk.css(elem,"position"),curElem=nTalk(elem),props={};if(position==="static"){elem.style.position="relative"}curOffset=curElem.offset();curCSSTop=nTalk.css(elem,"top");curCSSLeft=nTalk.css(elem,"left");if(options.top!==null){props.top=options.top-curOffset.top+(curCSSTop||0)}if(options.left!==null){props.left=options.left-curOffset.left+(curCSSLeft||0)}curElem.css(props)}};nTalk.cache={data:null,init:function(){nTalk.cache.data=nTalk.extend({},nTalk.cache.deserialize(nTalk.cookie.get(nTalk.CON_CACHE_COOKIE)))},get:function(key,Immediate){if(Immediate===true){nTalk.cache.data=nTalk.merge(nTalk.cache.data,nTalk.cache.deserialize(nTalk.cookie.get(nTalk.CON_CACHE_COOKIE)))}return this.formatData(key)},set:function(key,value){this.formatData(key,value);return nTalk.cookie.set(nTalk.CON_CACHE_COOKIE,nTalk.cache.serialize(nTalk.cache.data),0)},serialize:function(data){var self=this,result=[];if(nTalk.isArray(data)){for(var i=0;i<data.length;i++){result.push(this.serialize(data[i]))}return"["+result.join("|")+"]"}else if(nTalk.isObject(data)){nTalk.each(data,function(k,value){result.push(k+":"+self.serialize(value))});return result.length?"{"+result.join(",")+"}":"{}"}else{return data}},deserialize:function(data){if(!data)return{};var json,strJson=/"/.test(data)?data:data.replace(/(\{|\[)/g,'$1"').replace(/(}|])/g,'"$1').replace(/(:|,)/g,'"$1"');try{json=nTalk.JSON.parseJSON(strJson)}catch(e){return null}for(var k in json){if(!json.hasOwnProperty(k))continue;json[k]=nTalk.isNumeric(json[k])?+json[k]:json[k]}return json},formatData:function(key,value){var strDate=key.split("."),copy=nTalk.cache.data,g;while(g=strDate.shift()){if(strDate.length>0){if(!copy[g]){copy[g]={}}copy=copy[g]}else{if(value===undefined)return copy[g]||null;else if(nTalk.isArray(value)){var arrTo=[];if(copy[g])arrTo=arrTo.concat(copy[g]);copy[g]=arrTo.concat(value)}else{copy[g]=value;return nTalk.cache.data}}}}};nTalk.promptwindow=function(){var isFocus=false,isPrompting=false,cacheTime=nTalk.getTime(),timerID=null,promptMsg=null,promptMsg2=null,originTitle=document.title,counter=0,autoStop=true,promptTitle="%1%2 - %3";if(window.addEvent){nTalk(document).bind("focusin",handleFocus);nTalk(document).bind("focusout",handleBlur)}nTalk(window).bind("focus",handleFocus);nTalk(window).bind("blur",handleBlur);function handleFocus(){isFocus=true;var curTime=nTalk.getTime();if(curTime-cacheTime<100){return}cacheTime=nTalk.getTime();if(autoStop){stopPrompt()}if(nTalk.isFunction(nTalk.promptwindow.callbackFocus)){nTalk.promptwindow.callbackFocus()}}function handleBlur(){isFocus=false;if(nTalk.isFunction(nTalk.promptwindow.callbackBlur)){nTalk.promptwindow.callbackBlur()}}function startPrompt(destnick,flashNews,aStop){if(isPrompting||isFocus)return;if(flashNews&&flashNews.length>0){promptMsg=nTalk.myString(promptTitle).sprintf(flashNews,"",originTitle);promptMsg2="";for(var i=0,l=Math.ceil(nTalk.enLength(flashNews)/2);i<l;i++){promptMsg2+=""}promptMsg2=nTalk.myString(promptTitle).sprintf(promptMsg2,destnick,originTitle)}autoStop=aStop||autoStop;timerID=setInterval(changeWindowTitle,800);isPrompting=true;return isPrompting}function changeWindowTitle(){counter++;document.title=counter%2===0?promptMsg2:promptMsg;try{if(top!=self){top.document.title=counter%2===0?promptMsg2:promptMsg}}catch(e){}}function stopPrompt(){if(!isPrompting)return;clearInterval(timerID);timerID=null;counter=0;setTimeout(function(){document.title=originTitle},500);isPrompting=false;if(window.top!=window.self){try{window.top.document.title=originTitle}catch(e){}}}return{callbackFocus:emptyFunc,callbackBlur:emptyFunc,originTitle:originTitle,startPrompt:startPrompt,stopPrompt:stopPrompt}}();var createXHR=function(){try{return new window.XMLHttpRequest}catch(e){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(e1){return false}}};var xmlrequest=function(){var xhr=createXHR();if(!xhr){return xhr}if("withCredentials"in xhr){return xhr}if(window.XDomainRequest===undefined){return xhr}xhr=new XDomainRequest;xhr.readyState=0;xhr.status=100;xhr.onreadystatechange=emptyFunc;xhr.onload=function(){xhr.readyState=4;xhr.status=200;var xmlDoc=new ActiveXObject("Microsoft.XMLDOM");xmlDoc.async="false";xmlDoc.loadXML(xhr.responseText);xhr.responseXML=xmlDoc;xhr.response=xhr.responseText;xhr.onreadystatechange()};xhr.ontimeout=xhr.oerror=function(){xhr.readyState=4;xhr.status=500;xhr.onreadystatechange()};return xhr};var tepmxhr,hasSetRequestHeader,hasOverrideMimeType;try{tepmxhr=xmlrequest();hasSetRequestHeader=tepmxhr.setRequestHeader||false;hasOverrideMimeType=tepmxhr.overrideMimeType||false;tepmxhr=null}catch(e){}nTalk.doAjaxRequest=function(options){var dataType=options.dataType||"text";var success=options.success||emptyFunc;var error=options.error||emptyFunc;var xhr=xmlrequest();if(!xhr){error("no xhr");return null}var callback=function(){var json;if(xhr.readyState===4){var status=xhr.status||0;if(status===200){if(dataType==="json"){try{json=nTalk.JSON.parse(xhr.responseText);success(json,xhr)}catch(e){error(xhr.responseText,xhr,"response to json exception")}return}else{success(xhr.responseText,xhr);return}}else{if(dataType==="json"){try{json=nTalk.JSON.parse(xhr.responseText);error(json,xhr)}catch(e){error(xhr.responseText,xhr,"response to json exception")}return}else{success(xhr.responseText,xhr,"Server exception")}}}if(xhr.readyState===0){success(xhr.responseText,xhr,"Server exception")}};xhr.onreadystatechange=callback;if(options.responseType){if(typeof xhr.responseType!=="undefined"){xhr.responseType=options.responseType}else{error("",xhr,"Browser does not support setting response type");return null}}if(options.mimeType){if(hasOverrideMimeType){xhr.overrideMimeType(options.mimeType)}else{error("",xhr,"Browser does not support setting mimeType");return null}}var headers=options.headers||{};if(!options.crossDomain&&!headers["X-Requested-With"]){headers["X-Requested-With"]="XMLHttpRequest"}for(var key in headers){if(hasSetRequestHeader){xhr.setRequestHeader(key,headers[key])}else{error("",xhr,"Browser does not support setting header");return null}}var type=options.type||"GET";xhr.open(type,options.url);var data=options.data||null;xhr.send(data);return xhr};if(window.nTalk)return;window.nTalk=window.NTKF=nTalk;nTalk.initializeCore();(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){var FilterCSS=require("cssfilter").FilterCSS;var getDefaultCSSWhiteList=require("cssfilter").getDefaultWhiteList;var _=require("./util");function getDefaultWhiteList(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","loop","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],sup:[],strong:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","loop","preload","src","height","width"]}}var defaultCSSFilter=new FilterCSS;function onTag(tag,html,options){}function onIgnoreTag(tag,html,options){}function onTagAttr(tag,name,value){}function onIgnoreTagAttr(tag,name,value){}function escapeHtml(html){return html.replace(REGEXP_LT,"&lt;").replace(REGEXP_GT,"&gt;")}function safeAttrValue(tag,name,value,cssFilter){value=friendlyAttrValue(value);if(name==="href"||name==="src"){value=_.trim(value);if(value==="#")return"#";if(!(value.substr(0,7)==="http://"||value.substr(0,8)==="https://"||value.substr(0,7)==="mailto:"||value[0]==="#"||value[0]==="/")){return""}}else if(name==="background"){REGEXP_DEFAULT_ON_TAG_ATTR_4.lastIndex=0;if(REGEXP_DEFAULT_ON_TAG_ATTR_4.test(value)){return""}}else if(name==="style"){REGEXP_DEFAULT_ON_TAG_ATTR_7.lastIndex=0;if(REGEXP_DEFAULT_ON_TAG_ATTR_7.test(value)){return""}REGEXP_DEFAULT_ON_TAG_ATTR_8.lastIndex=0;if(REGEXP_DEFAULT_ON_TAG_ATTR_8.test(value)){REGEXP_DEFAULT_ON_TAG_ATTR_4.lastIndex=0;if(REGEXP_DEFAULT_ON_TAG_ATTR_4.test(value)){return""}}if(cssFilter!==false){cssFilter=cssFilter||defaultCSSFilter;value=cssFilter.process(value)}}value=escapeAttrValue(value);return value}var REGEXP_LT=/</g;var REGEXP_GT=/>/g;var REGEXP_QUOTE=/"/g;var REGEXP_QUOTE_2=/&quot;/g;var REGEXP_ATTR_VALUE_1=/&#([a-zA-Z0-9]*);?/gim;var REGEXP_ATTR_VALUE_COLON=/&colon;?/gim;var REGEXP_ATTR_VALUE_NEWLINE=/&newline;?/gim;var REGEXP_DEFAULT_ON_TAG_ATTR_3=/\/\*|\*\//gm;var REGEXP_DEFAULT_ON_TAG_ATTR_4=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a)\:/gi;var REGEXP_DEFAULT_ON_TAG_ATTR_5=/^[\s"'`]*(d\s*a\s*t\s*a\s*)\:/gi;var REGEXP_DEFAULT_ON_TAG_ATTR_6=/^[\s"'`]*(d\s*a\s*t\s*a\s*)\:\s*image\//gi;var REGEXP_DEFAULT_ON_TAG_ATTR_7=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi;var REGEXP_DEFAULT_ON_TAG_ATTR_8=/u\s*r\s*l\s*\(.*/gi;function escapeQuote(str){return str.replace(REGEXP_QUOTE,"&quot;")}function unescapeQuote(str){return str.replace(REGEXP_QUOTE_2,'"')}function escapeHtmlEntities(str){return str.replace(REGEXP_ATTR_VALUE_1,function replaceUnicode(str,code){return code[0]==="x"||code[0]==="X"?String.fromCharCode(parseInt(code.substr(1),16)):String.fromCharCode(parseInt(code,10))})}function escapeDangerHtml5Entities(str){return str.replace(REGEXP_ATTR_VALUE_COLON,":").replace(REGEXP_ATTR_VALUE_NEWLINE," ")}function clearNonPrintableCharacter(str){var str2="";for(var i=0,len=str.length;i<len;i++){str2+=str.charCodeAt(i)<32?" ":str.charAt(i)}return _.trim(str2)}function friendlyAttrValue(str){str=unescapeQuote(str);str=escapeHtmlEntities(str);str=escapeDangerHtml5Entities(str);str=clearNonPrintableCharacter(str);return str}function escapeAttrValue(str){str=escapeQuote(str);str=escapeHtml(str);return str}function onIgnoreTagStripAll(){return""}function StripTagBody(tags,next){if(typeof next!=="function"){next=function(){}}var isRemoveAllTag=!Array.isArray(tags);function isRemoveTag(tag){if(isRemoveAllTag)return true;return _.indexOf(tags,tag)!==-1}var removeList=[];var posStart=false;return{onIgnoreTag:function(tag,html,options){if(isRemoveTag(tag)){if(options.isClosing){var ret="[/removed]";var end=options.position+ret.length;removeList.push([posStart!==false?posStart:options.position,end]);posStart=false;return ret}else{if(!posStart){posStart=options.position}return"[removed]"}}else{return next(tag,html,options)}},remove:function(html){var rethtml="";var lastPos=0;_.forEach(removeList,function(pos){rethtml+=html.slice(lastPos,pos[0]);lastPos=pos[1]});rethtml+=html.slice(lastPos);return rethtml}}}function stripCommentTag(html){return html.replace(STRIP_COMMENT_TAG_REGEXP,"")}var STRIP_COMMENT_TAG_REGEXP=/<!--[\s\S]*?-->/g;function stripBlankChar(html){var chars=html.split("");chars=chars.filter(function(char){var c=char.charCodeAt(0);if(c===127)return false;if(c<=31){if(c===10||c===13)return true;return false}return true});return chars.join("")}exports.whiteList=getDefaultWhiteList();exports.getDefaultWhiteList=getDefaultWhiteList;exports.onTag=onTag;exports.onIgnoreTag=onIgnoreTag;exports.onTagAttr=onTagAttr;exports.onIgnoreTagAttr=onIgnoreTagAttr;exports.safeAttrValue=safeAttrValue;exports.escapeHtml=escapeHtml;exports.escapeQuote=escapeQuote;exports.unescapeQuote=unescapeQuote;exports.escapeHtmlEntities=escapeHtmlEntities;exports.escapeDangerHtml5Entities=escapeDangerHtml5Entities;exports.clearNonPrintableCharacter=clearNonPrintableCharacter;exports.friendlyAttrValue=friendlyAttrValue;exports.escapeAttrValue=escapeAttrValue;exports.onIgnoreTagStripAll=onIgnoreTagStripAll;exports.StripTagBody=StripTagBody;exports.stripCommentTag=stripCommentTag;exports.stripBlankChar=stripBlankChar;exports.cssFilter=defaultCSSFilter;exports.getDefaultCSSWhiteList=getDefaultCSSWhiteList},{"./util":4,cssfilter:8}],2:[function(require,module,exports){var DEFAULT=require("./default");var parser=require("./parser");var FilterXSS=require("./xss");function filterXSS(html,options){var xss=new FilterXSS(options);return xss.process(html)}exports=module.exports=filterXSS;exports.FilterXSS=FilterXSS;for(var i in DEFAULT)exports[i]=DEFAULT[i];for(var i in parser)exports[i]=parser[i];if(typeof nTalk!=="undefined"){nTalk.extend({filterXSS:module.exports})}},{"./default":1,"./parser":3,"./xss":5}],3:[function(require,module,exports){var _=require("./util");function getTagName(html){var i=html.indexOf(" ");if(i===-1){var tagName=html.slice(1,-1)}else{var tagName=html.slice(1,i+1)}tagName=_.trim(tagName).toLowerCase();if(tagName.slice(0,1)==="/")tagName=tagName.slice(1);if(tagName.slice(-1)==="/")tagName=tagName.slice(0,-1);return tagName}function isClosing(html){return html.slice(0,2)==="</"}function parseTag(html,onTag,escapeHtml){"user strict";var rethtml="";var lastPos=0;var tagStart=false;var quoteStart=false;var currentPos=0;var len=html.length;var currentHtml="";var currentTagName="";for(currentPos=0;currentPos<len;currentPos++){var c=html.charAt(currentPos);if(tagStart===false){if(c==="<"){tagStart=currentPos;continue}}else{if(quoteStart===false){if(c==="<"){rethtml+=escapeHtml(html.slice(lastPos,currentPos));tagStart=currentPos;lastPos=currentPos;continue}if(c===">"){rethtml+=escapeHtml(html.slice(lastPos,tagStart));currentHtml=html.slice(tagStart,currentPos+1);currentTagName=getTagName(currentHtml);rethtml+=onTag(tagStart,rethtml.length,currentTagName,currentHtml,isClosing(currentHtml));lastPos=currentPos+1;tagStart=false;continue}if((c==='"'||c==="'")&&html.charAt(currentPos-1)==="="){quoteStart=c;continue}}else{if(c===quoteStart){quoteStart=false;continue}}}}if(lastPos<html.length){rethtml+=escapeHtml(html.substr(lastPos))}return rethtml}var REGEXP_ATTR_NAME=/[^a-zA-Z0-9_:\.\-]/gim;function parseAttr(html,onAttr){"user strict";var lastPos=0;var retAttrs=[];var tmpName=false;var len=html.length;function addAttr(name,value){name=_.trim(name);name=name.replace(REGEXP_ATTR_NAME,"").toLowerCase();if(name.length<1)return;var ret=onAttr(name,value||"");if(ret)retAttrs.push(ret)}for(var i=0;i<len;i++){var c=html.charAt(i);var v,j;if(tmpName===false&&c==="="){tmpName=html.slice(lastPos,i);lastPos=i+1;continue}if(tmpName!==false){if(i===lastPos&&(c==='"'||c==="'")&&html.charAt(i-1)==="="){j=html.indexOf(c,i+1);if(j===-1){break}else{v=_.trim(html.slice(lastPos+1,j));addAttr(tmpName,v);tmpName=false;i=j;lastPos=i+1;continue}}}if(c===" "){if(tmpName===false){j=findNextEqual(html,i);if(j===-1){v=_.trim(html.slice(lastPos,i));addAttr(v);tmpName=false;lastPos=i+1;continue}else{i=j-1;continue}}else{j=findBeforeEqual(html,i-1);if(j===-1){v=_.trim(html.slice(lastPos,i));v=stripQuoteWrap(v);addAttr(tmpName,v);tmpName=false;lastPos=i+1;continue}else{continue}}}}if(lastPos<html.length){if(tmpName===false){addAttr(html.slice(lastPos))}else{addAttr(tmpName,stripQuoteWrap(_.trim(html.slice(lastPos))))}}return _.trim(retAttrs.join(" "))}function findNextEqual(str,i){for(;i<str.length;i++){var c=str[i];if(c===" ")continue;if(c==="=")return i;return-1}}function findBeforeEqual(str,i){for(;i>0;i--){var c=str[i];if(c===" ")continue;if(c==="=")return i;return-1}}function isQuoteWrapString(text){if(text[0]==='"'&&text[text.length-1]==='"'||text[0]==="'"&&text[text.length-1]==="'"){return true}else{return false}}function stripQuoteWrap(text){if(isQuoteWrapString(text)){return text.substr(1,text.length-2)}else{return text}}exports.parseTag=parseTag;exports.parseAttr=parseAttr},{"./util":4}],4:[function(require,module,exports){module.exports={indexOf:function(arr,item){var i,j;if(Array.prototype.indexOf){return arr.indexOf(item)}for(i=0,j=arr.length;i<j;i++){if(arr[i]===item){return i}}return-1},forEach:function(arr,fn,scope){var i,j;if(Array.prototype.forEach){return arr.forEach(fn,scope)}for(i=0,j=arr.length;i<j;i++){fn.call(scope,arr[i],i,arr)}},trim:function(str){if(String.prototype.trim){return str.trim()}return str.replace(/(^\s*)|(\s*$)/g,"")}}},{}],5:[function(require,module,exports){var FilterCSS=require("cssfilter").FilterCSS;var DEFAULT=require("./default");var parser=require("./parser");var parseTag=parser.parseTag;var parseAttr=parser.parseAttr;var _=require("./util");function isNull(obj){return obj===undefined||obj===null}function getAttrs(html){var i=html.indexOf(" ");if(i===-1){return{html:"",closing:html[html.length-2]==="/"}}html=_.trim(html.slice(i+1,-1));var isClosing=html[html.length-1]==="/";if(isClosing)html=_.trim(html.slice(0,-1));return{html:html,closing:isClosing}}function shallowCopyObject(obj){var ret={};for(var i in obj){ret[i]=obj[i]}return ret}function FilterXSS(options){options=shallowCopyObject(options||{});if(options.stripIgnoreTag){if(options.onIgnoreTag){console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time')}options.onIgnoreTag=DEFAULT.onIgnoreTagStripAll}options.whiteList=options.whiteList||DEFAULT.whiteList;options.onTag=options.onTag||DEFAULT.onTag;options.onTagAttr=options.onTagAttr||DEFAULT.onTagAttr;options.onIgnoreTag=options.onIgnoreTag||DEFAULT.onIgnoreTag;options.onIgnoreTagAttr=options.onIgnoreTagAttr||DEFAULT.onIgnoreTagAttr;options.safeAttrValue=options.safeAttrValue||DEFAULT.safeAttrValue;options.escapeHtml=options.escapeHtml||DEFAULT.escapeHtml;this.options=options;if(options.css===false){this.cssFilter=false}else{options.css=options.css||{};this.cssFilter=new FilterCSS(options.css)}}FilterXSS.prototype.process=function(html){html=html||"";html=html.toString();if(!html)return"";var me=this;var options=me.options;var whiteList=options.whiteList;var onTag=options.onTag;var onIgnoreTag=options.onIgnoreTag;var onTagAttr=options.onTagAttr;var onIgnoreTagAttr=options.onIgnoreTagAttr;var safeAttrValue=options.safeAttrValue;var escapeHtml=options.escapeHtml;var cssFilter=me.cssFilter;if(options.stripBlankChar){html=DEFAULT.stripBlankChar(html)}if(!options.allowCommentTag){html=DEFAULT.stripCommentTag(html)}var stripIgnoreTagBody=false;if(options.stripIgnoreTagBody){var stripIgnoreTagBody=DEFAULT.StripTagBody(options.stripIgnoreTagBody,onIgnoreTag);onIgnoreTag=stripIgnoreTagBody.onIgnoreTag}var retHtml=parseTag(html,function(sourcePosition,position,tag,html,isClosing){var info={sourcePosition:sourcePosition,position:position,isClosing:isClosing,isWhite:tag in whiteList};var ret=onTag(tag,html,info);if(!isNull(ret))return ret;if(info.isWhite){if(info.isClosing){return"</"+tag+">"}var attrs=getAttrs(html);var whiteAttrList=whiteList[tag];var attrsHtml=parseAttr(attrs.html,function(name,value){var isWhiteAttr=_.indexOf(whiteAttrList,name)!==-1;var ret=onTagAttr(tag,name,value,isWhiteAttr);if(!isNull(ret))return ret;if(isWhiteAttr){value=safeAttrValue(tag,name,value,cssFilter);if(value){return name+'="'+value+'"'}else{return name}}else{var ret=onIgnoreTagAttr(tag,name,value,isWhiteAttr);if(!isNull(ret))return ret;return}});var html="<"+tag;if(attrsHtml)html+=" "+attrsHtml;if(attrs.closing)html+=" /";html+=">";return html}else{var ret=onIgnoreTag(tag,html,info);if(!isNull(ret))return ret;return escapeHtml(html)}},escapeHtml);if(stripIgnoreTagBody){retHtml=stripIgnoreTagBody.remove(retHtml)}return retHtml};module.exports=FilterXSS},{"./default":1,"./parser":3,"./util":4,cssfilter:8}],6:[function(require,module,exports){var DEFAULT=require("./default");var parseStyle=require("./parser");var _=require("./util");function isNull(obj){return obj===undefined||obj===null}function shallowCopyObject(obj){var ret={};for(var i in obj){ret[i]=obj[i]}return ret}function FilterCSS(options){options=shallowCopyObject(options||{});options.whiteList=options.whiteList||DEFAULT.whiteList;options.onAttr=options.onAttr||DEFAULT.onAttr;options.onIgnoreAttr=options.onIgnoreAttr||DEFAULT.onIgnoreAttr;this.options=options}FilterCSS.prototype.process=function(css){css=css||"";css=css.toString();if(!css)return"";var me=this;var options=me.options;var whiteList=options.whiteList;var onAttr=options.onAttr;var onIgnoreAttr=options.onIgnoreAttr;var retCSS=parseStyle(css,function(sourcePosition,position,name,value,source){var check=whiteList[name];var isWhite=false;if(check===true)isWhite=check;else if(typeof check==="function")isWhite=check(value);else if(check instanceof RegExp)isWhite=check.test(value);if(isWhite!==true)isWhite=false;var opts={position:position,sourcePosition:sourcePosition,source:source,isWhite:isWhite};if(isWhite){var ret=onAttr(name,value,opts);if(isNull(ret)){return name+":"+value}else{return ret}}else{var ret=onIgnoreAttr(name,value,opts);if(!isNull(ret)){return ret}}});return retCSS};module.exports=FilterCSS},{"./default":7,"./parser":9,"./util":10}],7:[function(require,module,exports){function getDefaultWhiteList(){var whiteList={};whiteList["align-content"]=false;whiteList["align-items"]=false;whiteList["align-self"]=false;whiteList["alignment-adjust"]=false;whiteList["alignment-baseline"]=false;whiteList["all"]=false;whiteList["anchor-point"]=false;whiteList["animation"]=false;whiteList["animation-delay"]=false;whiteList["animation-direction"]=false;whiteList["animation-duration"]=false;whiteList["animation-fill-mode"]=false;whiteList["animation-iteration-count"]=false;whiteList["animation-name"]=false;whiteList["animation-play-state"]=false;whiteList["animation-timing-function"]=false;whiteList["azimuth"]=false;whiteList["backface-visibility"]=false;whiteList["background"]=true;whiteList["background-attachment"]=true;whiteList["background-clip"]=true;whiteList["background-color"]=true;whiteList["background-image"]=true;whiteList["background-origin"]=true;
whiteList["background-position"]=true;whiteList["background-repeat"]=true;whiteList["background-size"]=true;whiteList["baseline-shift"]=false;whiteList["binding"]=false;whiteList["bleed"]=false;whiteList["bookmark-label"]=false;whiteList["bookmark-level"]=false;whiteList["bookmark-state"]=false;whiteList["border"]=true;whiteList["border-bottom"]=true;whiteList["border-bottom-color"]=true;whiteList["border-bottom-left-radius"]=true;whiteList["border-bottom-right-radius"]=true;whiteList["border-bottom-style"]=true;whiteList["border-bottom-width"]=true;whiteList["border-collapse"]=true;whiteList["border-color"]=true;whiteList["border-image"]=true;whiteList["border-image-outset"]=true;whiteList["border-image-repeat"]=true;whiteList["border-image-slice"]=true;whiteList["border-image-source"]=true;whiteList["border-image-width"]=true;whiteList["border-left"]=true;whiteList["border-left-color"]=true;whiteList["border-left-style"]=true;whiteList["border-left-width"]=true;whiteList["border-radius"]=true;whiteList["border-right"]=true;whiteList["border-right-color"]=true;whiteList["border-right-style"]=true;whiteList["border-right-width"]=true;whiteList["border-spacing"]=true;whiteList["border-style"]=true;whiteList["border-top"]=true;whiteList["border-top-color"]=true;whiteList["border-top-left-radius"]=true;whiteList["border-top-right-radius"]=true;whiteList["border-top-style"]=true;whiteList["border-top-width"]=true;whiteList["border-width"]=true;whiteList["bottom"]=false;whiteList["box-decoration-break"]=true;whiteList["box-shadow"]=true;whiteList["box-sizing"]=true;whiteList["box-snap"]=true;whiteList["box-suppress"]=true;whiteList["break-after"]=true;whiteList["break-before"]=true;whiteList["break-inside"]=true;whiteList["caption-side"]=false;whiteList["chains"]=false;whiteList["clear"]=true;whiteList["clip"]=false;whiteList["clip-path"]=false;whiteList["clip-rule"]=false;whiteList["color"]=true;whiteList["color-interpolation-filters"]=true;whiteList["column-count"]=false;whiteList["column-fill"]=false;whiteList["column-gap"]=false;whiteList["column-rule"]=false;whiteList["column-rule-color"]=false;whiteList["column-rule-style"]=false;whiteList["column-rule-width"]=false;whiteList["column-span"]=false;whiteList["column-width"]=false;whiteList["columns"]=false;whiteList["contain"]=false;whiteList["content"]=false;whiteList["counter-increment"]=false;whiteList["counter-reset"]=false;whiteList["counter-set"]=false;whiteList["crop"]=false;whiteList["cue"]=false;whiteList["cue-after"]=false;whiteList["cue-before"]=false;whiteList["cursor"]=false;whiteList["direction"]=false;whiteList["display"]=true;whiteList["display-inside"]=true;whiteList["display-list"]=true;whiteList["display-outside"]=true;whiteList["dominant-baseline"]=false;whiteList["elevation"]=false;whiteList["empty-cells"]=false;whiteList["filter"]=false;whiteList["flex"]=false;whiteList["flex-basis"]=false;whiteList["flex-direction"]=false;whiteList["flex-flow"]=false;whiteList["flex-grow"]=false;whiteList["flex-shrink"]=false;whiteList["flex-wrap"]=false;whiteList["float"]=false;whiteList["float-offset"]=false;whiteList["flood-color"]=false;whiteList["flood-opacity"]=false;whiteList["flow-from"]=false;whiteList["flow-into"]=false;whiteList["font"]=true;whiteList["font-family"]=true;whiteList["font-feature-settings"]=true;whiteList["font-kerning"]=true;whiteList["font-language-override"]=true;whiteList["font-size"]=true;whiteList["font-size-adjust"]=true;whiteList["font-stretch"]=true;whiteList["font-style"]=true;whiteList["font-synthesis"]=true;whiteList["font-variant"]=true;whiteList["font-variant-alternates"]=true;whiteList["font-variant-caps"]=true;whiteList["font-variant-east-asian"]=true;whiteList["font-variant-ligatures"]=true;whiteList["font-variant-numeric"]=true;whiteList["font-variant-position"]=true;whiteList["font-weight"]=true;whiteList["grid"]=false;whiteList["grid-area"]=false;whiteList["grid-auto-columns"]=false;whiteList["grid-auto-flow"]=false;whiteList["grid-auto-rows"]=false;whiteList["grid-column"]=false;whiteList["grid-column-end"]=false;whiteList["grid-column-start"]=false;whiteList["grid-row"]=false;whiteList["grid-row-end"]=false;whiteList["grid-row-start"]=false;whiteList["grid-template"]=false;whiteList["grid-template-areas"]=false;whiteList["grid-template-columns"]=false;whiteList["grid-template-rows"]=false;whiteList["hanging-punctuation"]=false;whiteList["height"]=true;whiteList["hyphens"]=false;whiteList["icon"]=false;whiteList["image-orientation"]=false;whiteList["image-resolution"]=false;whiteList["ime-mode"]=false;whiteList["initial-letters"]=false;whiteList["inline-box-align"]=false;whiteList["justify-content"]=false;whiteList["justify-items"]=false;whiteList["justify-self"]=false;whiteList["left"]=false;whiteList["letter-spacing"]=true;whiteList["lighting-color"]=true;whiteList["line-box-contain"]=false;whiteList["line-break"]=false;whiteList["line-grid"]=false;whiteList["line-height"]=false;whiteList["line-snap"]=false;whiteList["line-stacking"]=false;whiteList["line-stacking-ruby"]=false;whiteList["line-stacking-shift"]=false;whiteList["line-stacking-strategy"]=false;whiteList["list-style"]=true;whiteList["list-style-image"]=true;whiteList["list-style-position"]=true;whiteList["list-style-type"]=true;whiteList["margin"]=true;whiteList["margin-bottom"]=true;whiteList["margin-left"]=true;whiteList["margin-right"]=true;whiteList["margin-top"]=true;whiteList["marker-offset"]=false;whiteList["marker-side"]=false;whiteList["marks"]=false;whiteList["mask"]=false;whiteList["mask-box"]=false;whiteList["mask-box-outset"]=false;whiteList["mask-box-repeat"]=false;whiteList["mask-box-slice"]=false;whiteList["mask-box-source"]=false;whiteList["mask-box-width"]=false;whiteList["mask-clip"]=false;whiteList["mask-image"]=false;whiteList["mask-origin"]=false;whiteList["mask-position"]=false;whiteList["mask-repeat"]=false;whiteList["mask-size"]=false;whiteList["mask-source-type"]=false;whiteList["mask-type"]=false;whiteList["max-height"]=true;whiteList["max-lines"]=false;whiteList["max-width"]=true;whiteList["min-height"]=true;whiteList["min-width"]=true;whiteList["move-to"]=false;whiteList["nav-down"]=false;whiteList["nav-index"]=false;whiteList["nav-left"]=false;whiteList["nav-right"]=false;whiteList["nav-up"]=false;whiteList["object-fit"]=false;whiteList["object-position"]=false;whiteList["opacity"]=false;whiteList["order"]=false;whiteList["orphans"]=false;whiteList["outline"]=false;whiteList["outline-color"]=false;whiteList["outline-offset"]=false;whiteList["outline-style"]=false;whiteList["outline-width"]=false;whiteList["overflow"]=false;whiteList["overflow-wrap"]=false;whiteList["overflow-x"]=false;whiteList["overflow-y"]=false;whiteList["padding"]=true;whiteList["padding-bottom"]=true;whiteList["padding-left"]=true;whiteList["padding-right"]=true;whiteList["padding-top"]=true;whiteList["page"]=false;whiteList["page-break-after"]=false;whiteList["page-break-before"]=false;whiteList["page-break-inside"]=false;whiteList["page-policy"]=false;whiteList["pause"]=false;whiteList["pause-after"]=false;whiteList["pause-before"]=false;whiteList["perspective"]=false;whiteList["perspective-origin"]=false;whiteList["pitch"]=false;whiteList["pitch-range"]=false;whiteList["play-during"]=false;whiteList["position"]=false;whiteList["presentation-level"]=false;whiteList["quotes"]=false;whiteList["region-fragment"]=false;whiteList["resize"]=false;whiteList["rest"]=false;whiteList["rest-after"]=false;whiteList["rest-before"]=false;whiteList["richness"]=false;whiteList["right"]=false;whiteList["rotation"]=false;whiteList["rotation-point"]=false;whiteList["ruby-align"]=false;whiteList["ruby-merge"]=false;whiteList["ruby-position"]=false;whiteList["shape-image-threshold"]=false;whiteList["shape-outside"]=false;whiteList["shape-margin"]=false;whiteList["size"]=false;whiteList["speak"]=false;whiteList["speak-as"]=false;whiteList["speak-header"]=false;whiteList["speak-numeral"]=false;whiteList["speak-punctuation"]=false;whiteList["speech-rate"]=false;whiteList["stress"]=false;whiteList["string-set"]=false;whiteList["tab-size"]=false;whiteList["table-layout"]=false;whiteList["text-align"]=true;whiteList["text-align-last"]=true;whiteList["text-combine-upright"]=true;whiteList["text-decoration"]=true;whiteList["text-decoration-color"]=true;whiteList["text-decoration-line"]=true;whiteList["text-decoration-skip"]=true;whiteList["text-decoration-style"]=true;whiteList["text-emphasis"]=true;whiteList["text-emphasis-color"]=true;whiteList["text-emphasis-position"]=true;whiteList["text-emphasis-style"]=true;whiteList["text-height"]=true;whiteList["text-indent"]=true;whiteList["text-justify"]=true;whiteList["text-orientation"]=true;whiteList["text-overflow"]=true;whiteList["text-shadow"]=true;whiteList["text-space-collapse"]=true;whiteList["text-transform"]=true;whiteList["text-underline-position"]=true;whiteList["text-wrap"]=true;whiteList["top"]=false;whiteList["transform"]=false;whiteList["transform-origin"]=false;whiteList["transform-style"]=false;whiteList["transition"]=false;whiteList["transition-delay"]=false;whiteList["transition-duration"]=false;whiteList["transition-property"]=false;whiteList["transition-timing-function"]=false;whiteList["unicode-bidi"]=false;whiteList["vertical-align"]=false;whiteList["visibility"]=false;whiteList["voice-balance"]=false;whiteList["voice-duration"]=false;whiteList["voice-family"]=false;whiteList["voice-pitch"]=false;whiteList["voice-range"]=false;whiteList["voice-rate"]=false;whiteList["voice-stress"]=false;whiteList["voice-volume"]=false;whiteList["volume"]=false;whiteList["white-space"]=false;whiteList["widows"]=false;whiteList["width"]=true;whiteList["will-change"]=false;whiteList["word-break"]=true;whiteList["word-spacing"]=true;whiteList["word-wrap"]=true;whiteList["wrap-flow"]=false;whiteList["wrap-through"]=false;whiteList["writing-mode"]=false;whiteList["z-index"]=false;return whiteList}function onAttr(name,value,options){}function onIgnoreAttr(name,value,options){}exports.whiteList=getDefaultWhiteList();exports.getDefaultWhiteList=getDefaultWhiteList;exports.onAttr=onAttr;exports.onIgnoreAttr=onIgnoreAttr},{}],8:[function(require,module,exports){var DEFAULT=require("./default");var FilterCSS=require("./css");function filterCSS(html,options){var xss=new FilterCSS(options);return xss.process(html)}exports=module.exports=filterCSS;exports.FilterCSS=FilterCSS;for(var i in DEFAULT)exports[i]=DEFAULT[i];if(typeof nTalk!=="undefined"){nTalk.extend({FilterCSS:module.exports})}},{"./css":6,"./default":7}],9:[function(require,module,exports){var _=require("./util");function parseStyle(css,onAttr){css=_.trimRight(css);if(css[css.length-1]!==";")css+=";";var cssLength=css.length;var isParenthesisOpen=false;var lastPos=0;var i=0;var retCSS="";function addNewAttr(){if(!isParenthesisOpen){var source=_.trim(css.slice(lastPos,i));var j=source.indexOf(":");if(j!==-1){var name=_.trim(source.slice(0,j));var value=_.trim(source.slice(j+1));if(name){var ret=onAttr(lastPos,retCSS.length,name,value,source);if(ret)retCSS+=ret+"; "}}}lastPos=i+1}for(;i<cssLength;i++){var c=css[i];if(c==="/"&&css[i+1]==="*"){var j=css.indexOf("*/",i+2);if(j===-1)break;i=j+1;lastPos=i+1;isParenthesisOpen=false}else if(c==="("){isParenthesisOpen=true}else if(c===")"){isParenthesisOpen=false}else if(c===";"){if(isParenthesisOpen){}else{addNewAttr()}}else if(c==="\n"){addNewAttr()}}return _.trim(retCSS)}module.exports=parseStyle},{"./util":10}],10:[function(require,module,exports){module.exports={indexOf:function(arr,item){var i,j;if(Array.prototype.indexOf){return arr.indexOf(item)}for(i=0,j=arr.length;i<j;i++){if(arr[i]===item){return i}}return-1},forEach:function(arr,fn,scope){var i,j;if(Array.prototype.forEach){return arr.forEach(fn,scope)}for(i=0,j=arr.length;i<j;i++){fn.call(scope,arr[i],i,arr)}},trim:function(str){if(String.prototype.trim){return str.trim()}return str.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(str){if(String.prototype.trimRight){return str.trimRight()}return str.replace(/(\s*$)/g,"")}}},{}]},{},[2])})(window);
/* @file flashserver
 * @date 2018.08.01 00:56:17
 */
(function($){
	$.flashserver = {
		'trailserver':'http://sh-trail.ntalker.com/trail/trail',
		'presenceserver':'1',
		'presencegoserver':'http://sh-p2.ntalker.com/flashIM/wdkstatus',
		'crmcenter':'http://hcrmct.ntalker.com/',
		'mcenter':'http://sh-p2.ntalker.com/record/mcenters/',
		'coopserver':'',
		'roboturl':'http://xn.faqrobot.org/servlet/XNAQ',
		't2dstatus':'http://sh-p2.ntalker.com/t2d3/t2dstatus',
		'chatview_in':'',
		'chatview_out':'',
		'chatview_wap':'',
		'queryurl':'http://sh-p2.ntalker.com/spider/spider/',
		'tchatmqttserver':'tcp://sh-p2.ntalker.com:6020/tchat3;ws://sh-p2.ntalker.com:6021/tchat3;wss://sh-p2.ntalker.com:6022/tchat3',
		'eduimmqttserver':'',
		'robotserver':'http://sh-p2.ntalker.com/assist',
		'kpiserver':'http://sh-p2.ntalker.com/kpi',
		'xpushim':'',
		'xpushthirdpush':'http://bpsroute.ntalker.com/xpush/thirdpush',
		'isnoim':2,
		'notrail':0,
		'preload':2000,
		'sessioncarry':'1',
		'enable_entrance':'0',
		'enable_invite':'0',
		'close_tchat_flash':'1',
		'close_im_flash':'0',
		'robot':'2',
		'connect_type':'comet',
		'history_version':'1',
		'entranceConfig':{
		},
		'tchatConnectType':'1',
		'layout':'0',
		'reversechat':'0',
		'usehttps':'0',
		'eduautochat':'0',
		'eduautoopentimeout':'3000',
		'eduautoopendomains':'',
		'eduautoopenstrs':'',
		'xpushpolltimeout':'15',
		'usexpush':'0',
		'settingserver':'http://sh-p2.ntalker.com/setting',
		'apiserver':'http://sh-p2.ntalker.com/api/',
		'siteid':'hr_1000'
	};
	$.sourceURI = $.baseURI + "siteid/respack_nt6.96/";
})(nTalk);

/* @file trail.js
 * @date 2018.07.17 15:05:20 
 */
(function($,undefined){if($.trail){return}$.trail={_trailServer:{kf_9988:"http://trailsvc.ntalker.com/trailsvc/count/trail.php?"},islogin:false,called:false,etype:"pv",edata:"",useSdkData:false,getRegionTimer:null,start:function(islogin,isupdate,useSdkData,callback){var self=this,params,data,referrer_is_current=$.referrer&&$.referrer.indexOf($.domain)>-1;if(this.called&&!isupdate){return}$.Log("nTalk.trail.start()",1);this.etype=isupdate?"update":this.etype;this.useSdkData=useSdkData;if(islogin||$.global.trailid===""||!referrer_is_current){this.islogin=1}else{this.islogin=0}params=this.formartData();if(!$.isEmptyObject($.global.ntalkerparam)&&$.global.ntalkerparam){data=$.extend({},{ntalkerparam:$.global.ntalkerparam})}data=$.extend(data,{ref:document.referrer});$.each(params,function(i,QueryParam){self.request(self.formatURI()+$.toURI(QueryParam),data,function(log){$.Log(log,1);if(this.getRegionTimer!=null){callback&&typeof callback==="function"&&callback()}},i)});this.getRegionTimer=setTimeout(function(){callback&&typeof callback==="function"&&callback();clearTimeout(self.getRegionTimer);self.getRegionTimer=null},200);this.called=true},request:function(uri,data,callback,i){if(data){$.Log("nTalk.trail.request():etype:"+this.etype+";POST request URI:"+uri);if($.browser.android&&$.browser.uc){data.uc=1;if(window.XMLHttpRequest&&window.FormData){var formdata=new FormData;for(var key in data){formdata.append(key,data[key])}var xhr=new XMLHttpRequest;xhr.open("POST",uri,true);xhr.send(formdata);return}}new $.POST(uri,data,function(e,name){callback.call(nTalk,"nTalk.trail: iframe["+name+"] post complete.",1)},"POST_IFRAME_"+i)}else{$.Log("nTalk.trail.request():etype:"+this.etype+";POST request URI:"+uri);$.require(uri+"#rnd",function(){callback.call(nTalk,"nTalk.trail: script get complete.",1)})}},formatURI:function(){if(this._trailServer[$.global.siteid]){return $.protocolFilter(this._trailServer[$.global.siteid])}else{return $.protocolFilter($.server.trailserver+"/userinfo.php?")}},formartData:function(){var result=[],orderprice,publicTrailParams={action:"save",url:$.url,siteid:$.global.siteid,uid:$.user.id,uname:$.user.name,device:this.useSdkData?"App":$.browser.mobile?"WAP":"PC",isvip:$.global.isvip,userlevel:$.global.userlevel,cid:$.global.pcid,sid:$.global.trailid,log:this.islogin,pageid:$.base.pageid,etype:this.etype,edata:this.edata,sourceid:$.global.sourceid,sourcename:$.global.sourcename,keyid:$.global.keyid,keyword:$.global.keyword,country:$.global.country,province:$.global.province,city:$.global.city};if($.global.pagetype){if($.url.indexOf("#")==-1){publicTrailParams.url+="#ntalker-pagetype="+$.global.pagetype}else if($.url.indexOf("?")==-1){publicTrailParams.url=$.enCut($.url.replace(/#/i,"?ntalker-pagetype="+$.global.pagetype+"#"),255)}else{publicTrailParams.url=$.enCut($.url.replace(/#/i,"&ntalker-pagetype="+$.global.pagetype+"#"),255)}}if(this.islogin==1){$.cache.set("tid",$.global.trailid);publicTrailParams=$.merge(publicTrailParams,{lan:$.language,scr:screen.width+"*"+screen.height,cookie:$.cookie.enable()?1:0,flash:$.flash.version})}$.Log("nTalk.trail: "+(this.islogin?"LOGIN":"LINK")+" trailid:"+$.global.trailid+", uid:"+$.user.id+", pcid:"+$.global.pcid,this.islogin?1:0);if($.global.orderid.length){$.each($.global.orderid,function(i,orderid){if(i>$.global.orderprice.length-1){orderprice=""}else{orderprice=$.global.orderprice[i]}result.push($.merge({},publicTrailParams,{orderid:orderid,orderprice:orderprice,sellerid:$.global.sellerid[i]||"",ttl:$.global.title}))})}else{result.push($.merge({},publicTrailParams,{sellerid:$.global.sellerid.length?$.global.sellerid[0]:"",ttl:$.global.title}))}return result}}})(nTalk);
/* @file nt2.js
 * @date 2018.07.17 15:05:20 
 */
(function($,undefined){function emptyFunc(){}if($.animate){$.Log("nt2.js loaded");return}$.animate=function(){var style=document.documentElement.style;return style.webkitTransition!==undefined||style.MozTransition!==undefined||style.OTransition!==undefined||style.msTransition!==undefined||style.transition!==undefined}()?function(){var style=document.documentElement.style,prefix_name=style.webkitTransition!==undefined?"Webkit":style.MozTransition!==undefined?"Moz":style.OTransition!==undefined?"O":style.msTransition!==undefined?"ms":"",transition_name=prefix_name+"Transition";return function(elem,options,duration,callback){var css_value=[],css_name=[],unit=[],css_style=[],style=elem.style;duration=duration||300;$.each(options,function(name,item){css_name[name]=$.camelize(name);if($.isObject(item)){item.to=item.to||0;css_value[name]=!$.cssNumber[name]?parseInt(item.to,10):item.to;unit[name]=$.unit(name,item.to);if($.isDefined(item.from)){$.css(elem,css_name[name],parseInt(item.from,10)+unit[name])}}else{css_value[name]=$.cssNumber[name]?parseInt(item,10):item;unit[name]=$.unit(name,item);$.css(elem,css_name[name],css_value[name])}css_style.push(name)});setTimeout(function(){style[transition_name]="all "+duration+"ms";$.each(css_style,function(i,name){style[css_name[name]]=css_value[name]+unit[name]})},15);setTimeout(function(){style[transition_name]="";if(callback){callback.call(elem)}},duration);return elem}}():function(elem,options,duration,callback){var step=0,i=0,j,length=0,p=30,css_to_value=[],css_from_value=[],css_name=[],css_unit=[],css_style=[],property_value,timer;duration=duration||300;$.each(options,function(name,item){css_name.push($.camelize(name));if($.isObject(item)){property_value=item.to;if($.isDefined(item.from)){css_from_value.push(!$.cssNumber[name]?parseInt(item.from,10):item.from)}else{css_from_value.push(!$.cssNumber[name]?parseInt($(elem).css(name),10):$(elem).css(name))}$.css(elem,css_name[i],css_from_value[i]+$.unit(name,property_value))}else{property_value=item;css_from_value.push($(elem).css(name))}css_to_value.push($.cssNumber[name]?property_value:isNaN(parseInt(property_value,10))?"":parseInt(property_value,10));css_unit.push($.unit(name,property_value));i++;length++});for(j=0;j<p;j++){css_style[j]=[];for(i=0;i<length;i++){css_style[j][css_name[i]]=!$.cssNumber[css_name[i]]&&!$.isNumeric(parseInt(css_from_value[i]))?"":css_from_value[i]+(css_to_value[i]-css_from_value[i])/p*j+(css_name[i]==="opacity"?"":css_unit[i])}}var func=function(){for(i=0;i<length;i++){$.css(elem,css_name[i],css_style[step][css_name[i]])}step++};for(;i<p;i++){timer=setTimeout(func,duration/p*i)}setTimeout(function(){for(i=0;i<length;i++){$.css(elem,css_name[i],css_to_value[i]+css_unit[i])}if(callback){callback.call(elem)}},duration);return elem};$.extend({listenerFunctions:[],listenerMessage:function(bindFunc){var self=this;function funcMessage(event){$.each($.listenerFunctions,function(i,f){f.apply($,[event.data])})}$.listenerFunctions.push(bindFunc);if(!window.addEventListener||this.__listenerMessage===true){return}$.Event.addEvent(window,"message",funcMessage);$.removelistenerMessage=function(){$.Event.removeEvent(window,"message",funcMessage);$.listenerFunctions=[];self.__listenerMessage=false};this.__listenerMessage=true},postMessage:function(contentWindow,data,origin){if(!contentWindow.postMessage){return}origin=origin||"*";try{contentWindow.postMessage(data,origin)}catch(e){}}});$.Window=$.Class.create();$.Window.prototype={defaultOptions:{dropHeight:30,width:520,height:410,left:100,top:100,minWidth:520,minHeight:410,resize:false,drag:false,fixed:false,zIndex:1e6,rightNode:true,onChanage:emptyFunc,onClose:emptyFunc,onMinimize:emptyFunc,onMaximize:emptyFunc,onMaxResize:emptyFunc},_tmpMove:null,_tmpStop:null,containter:null,header:null,body:null,chatBody:null,rightElement:null,buttonResize:null,buttonClose:null,buttonMax:null,buttonMin:null,_x:0,_y:0,_isdrag:null,_Style:null,parent:null,initialize:function(options,parentElement){$.extend(this,this.defaultOptions,options);this.parent=parentElement||null;this.quirks=$.browser.msie6||$.browser.Quirks&&$.browser.oldmsie;this.right=$(window).width()-this.left-this.width;this.bottom=$(window).height()-this.top-this.height;$.Log("$.Window:: left:"+this.left+", top:"+this.top);this._create();this._bind()},close:function(event){this.cancelBubble(event);if(this.onClose.toString().indexOf("anonymous")<=-1){this.onClose();if(window.localStorage.carry_dest){window.localStorage.carry_dest=""}}else{this.containter.hide(function(){$(this).remove();if(window.localStorage.carry_dest){window.localStorage.carry_dest=""}})}},change:function(isCallback){if(isCallback)this.onChanage.call(this,{width:this.width,height:this.height});if(this._isdrag){return}this.chatBody.css({height:this.height-this.dropHeight+"px"});if(this.rightNode){this.rightElement.css("height",this.height-this.dropHeight+"px")}},maxresize:function(){this.onMaxResize()},minimize:function(event,hidden){if(hidden!==true){this.cancelBubble(event)}this.containter.css({height:"0px",width:"0px"});if(hidden!==true){this.onMinimize()}},maximize:function(event,hidden){this.containter.css({height:this.height+"px",width:this.width+"px"});if(hidden!==true){this.onMaximize()}},cancelBubble:function(event){this.containter.css("z-index",this.zIndex);$.Event.fixEvent(event).stopPropagation()},changeAttr:function(width,height){if(this.quirks){this.clearExpression()}$.extend(this,{width:width,height:height,left:Math.max(0,$(window).width()-this.right-width),top:Math.max(0,$(window).height()-this.bottom-height)});this.containter.css({width:this.width+"px",height:this.height+"px",left:this.left+"px",top:this.top+"px"});if(this.quirks){this.fixedPosition()}this.change(true)},start:function(event,isDrag){if(!isDrag){this.cancelBubble(event)}this._Style=isDrag?{x:"left",y:"top"}:{x:"width",y:"height"};this.right=$(window).width()-this.left-this.width;this.bottom=$(window).height()-this.top-this.height;if(this.quirks&&!isDrag){this.clearExpression()}event=$.Event.fixEvent(event);this.containter.css(isDrag?{"z-index":++this.zIndex}:{"z-index":++this.zIndex});this._isdrag=isDrag;this._x=isDrag?event.clientX-this.containter.get(0).offsetLeft||0:this.containter.get(0).offsetLeft||0;this._y=isDrag?event.clientY-this.containter.get(0).offsetTop||0:this.containter.get(0).offsetTop||0;if($.browser.msie){this.containter.bind("losecapture",this._tmpStop).get(0).setCapture()}else{$.Event.fixEvent(event).preventDefault();$(window).bind("blur",this._tmpStop)}$(document).bind("mousemove",this._tmpMove);$(document).bind("mouseup",this._tmpStop)},move:function(event){if(window.getSelection)window.getSelection().removeAllRanges();else document.selection.empty();event=$.Event.fixEvent(event);var i_x=event.clientX-this._x,i_y=event.clientY-this._y,offset=$(window).offset();if(this._isdrag){if(this.quirks){this[this._Style.x]=Math.min(Math.max(i_x,offset.left),offset.left+$(window).width()-this.width)-offset.left;this[this._Style.y]=Math.min(Math.max(i_y,offset.top),offset.top+$(window).height()-this.height)-offset.top}else{this[this._Style.x]=Math.min(Math.max(i_x,0),$(window).width()-this.width);this[this._Style.y]=Math.min(Math.max(i_y,0),$(window).height()-this.height)}this.containter.css(this._Style.x,(this.quirks?offset.left:0)+Math.max(0,this[this._Style.x])+"px");this.containter.css(this._Style.y,(this.quirks?offset.top:0)+Math.max(0,this[this._Style.y])+"px")}else{if(this.quirks){this[this._Style.x]=Math.min(Math.max(i_x+(this.quirks?offset.left:0),this.minWidth),$(window).width()-this.left);this[this._Style.y]=Math.min(Math.max(i_y+(this.quirks?offset.top:0),this.minHeight),$(window).height()-this.top)}else{this[this._Style.x]=Math.min(Math.max(i_x,this.minWidth),$(window).width()-this.left);this[this._Style.y]=Math.min(Math.max(i_y,this.minHeight),$(window).height()-this.top)}this.containter.css(this._Style.x,this[this._Style.x]+"px");this.containter.css(this._Style.y,this[this._Style.y]+"px")}this.right=$(window).width()-this.left-this.width;this.bottom=$(window).height()-this.top-this.height;this.change(true)},stop:function(){if(this.quirks){this.fixedPosition()}this.containter.css({"z-index":--this.zIndex});$(document).removeEvent("mousemove",this._tmpMove);$(document).removeEvent("mouseup",this._tmpStop);if($.browser.msie){this.containter.removeEvent("losecapture",this._tmpStop).get(0).releaseCapture()}else{$(window).removeEvent("blur",this._tmpStop)}},fixedPosition:function(){if(this.quirks){var scrollTop=$(window).scrollTop();$(window).scrollTop(scrollTop+1);this.containter.replaceIEcssText({left:"expression(eval(Math.max((document.documentElement.scrollLeft || document.body.scrollLeft), (document.documentElement.scrollLeft || document.body.scrollLeft) + (document.documentElement.clientWidth  || document.body.clientWidth ) - this.offsetWidth  - "+this.right+")))",top:"expression(eval(Math.max((document.documentElement.scrollTop  || document.body.scrollTop ), (document.documentElement.scrollTop  || document.body.scrollTop ) + (document.documentElement.clientHeight || document.body.clientHeight) - this.offsetHeight - "+this.bottom+")))"});$(window).scrollTop(scrollTop);$(window).scrollLeft(1)}else{this.containter.css({left:this.left+"px",top:this.top+"px"})}},clearExpression:function(){var offset=$(window).offset();this.containter.Expression("left","");this.containter.Expression("top","");this.containter.Expression("left","");this.containter.replaceIEcssText({left:offset.left+this.left+"px",top:offset.top+this.top+"px"})},_for_resize:function(){this.left=Math.max(0,$(window).width()-this.right-this.width);this.top=Math.max(0,$(window).height()-this.bottom-this.height);if(!this.quirks){this.containter.css({left:this.left+"px",top:this.top+"px"})}},_create:function(){this.containter=$({className:this.className||"ntalk-window-containter",style:$.STYLE_BODY+"box-sizing:content-box;overflow:hidden;"}).appendTo(this.parent,true).css({position:!this.fixed?"absolute":!this.quirks?"fixed":"absolute",border:"none",width:this.width+"px",height:this.height+"px",zIndex:this.zIndex});this.fixedPosition();this.header=$({className:"ntalk-window-head",style:$.STYLE_BODY+"cursor:move;position:relative;left:0;top:0;"}).appendTo(this.containter).css({width:"100%",height:this.dropHeight+"px"});this.buttonClose=$({className:"ntalk-button-close",style:$.STYLE_BODY+"width:20px;height:20px;cursor:pointer;position:static;float:right;position:relative;margin:2px 3px 0 0;line-height:20px;vertical-align:middle;background:none;"}).appendTo(this.header);this.buttonMax=$({className:"ntalk-button-maxresize",style:$.STYLE_BODY+"width:20px;height:20px;cursor:pointer;position:static;float:right;position:relative;margin:2px 3px 0 0;line-height:20px;vertical-align:middle;background:none;"}).appendTo(this.header);this.buttonMin=$({className:"ntalk-button-min",style:$.STYLE_BODY+"width:20px;height:20px;cursor:pointer;position:static;float:right;position:relative;margin:2px 3px 0 0;line-height:20px;vertical-align:middle;background:none;"}).appendTo(this.header);this.body=$({className:"ntalk-window-body",style:$.STYLE_BODY+"float:left;width:100%;"}).appendTo(this.containter);this.chatBody=$({className:"ntalk-chat-body",style:$.STYLE_BODY+"width:100%;position:relative;left:0;top:0;"}).appendTo(this.body);if(this.rightNode){this.rightElement=$({className:"ntalk-window-right",style:$.STYLE_BODY+"float:left;display:none;width:100%;"}).appendTo(this.containter)}if(this.resize){this.buttonResize=$({className:"window-resize",style:$.STYLE_BODY+"width:10px;height:10px;cursor:nw-resize;position:absolute;right:1px;bottom:1px;font-size:0;background:none;z-index:99;"}).appendTo(this.containter)}$({style:$.STYLE_BODY+"clear:both;"}).appendTo(this.containter);this.change();return this.containter},_bind:function(){var self=this;this.containter.bind("mousedown",function(event){if(!self.drag)return;self.start.call(self,event,true)});this.buttonClose.bind("mousedown",function(event){$.Event.fixEvent(event).stopPropagation();self.close.call(self,event)});this.buttonMax.bind("mousedown",function(event){$.Event.fixEvent(event).stopPropagation();self.maxresize.call(self,event)});this.buttonMin.bind("mousedown",function(event){$.Event.fixEvent(event).stopPropagation();self.minimize.call(self,event)});this.chatBody.bind("mousedown",function(event){self.cancelBubble.call(self,event)});if(this.rightNode)this.rightElement.bind("mousedown",function(event){self.cancelBubble.call(self,event)});if(this.resize)this.buttonResize.bind("mousedown",function(event){self.start.call(self,event,false)});if(this.fixed){$(window).bind("resize",function(){self._for_resize()})}this._tmpStop=function(event){self.stop.call(self,event)};this._tmpMove=function(event){self.move.call(self,event)}}};$.Queue=$.Class.create();$.Queue.prototype={list:null,length:0,initialize:function(){this.list=[];this.length=this.list.length},isEmpty:function(){return this.list.length===0},enQueue:function(item){this.list.push(item);this.length=this.list.length;return this.list[this.length-1]},deQueue:function(){var tmp;if(this.isEmpty()){return null}tmp=this.list.shift();this.length=this.list.length;return tmp},queueFront:function(){return this.isEmpty()?null:this.list[0]}};$.pageManage=$.Class.create();$.pageManage.prototype={identid:"",keyid:"",data:null,interID:null,options:null,debug:false,inter:.8,count:0,chanageCall:true,CON_MANAGE_PAGE_LIST:"IM_EXIST_PAGEARR",pageStore:null,initialize:function(options,siteid){var self=this,arrPageList,cookiePageList,LSReadCount=3;if(this.debug){$.Log("pageManage.initialize():")}this.options=$.extend(this.options,{onChanage:emptyFunc,onInterval:emptyFunc,pageNum:3,timeout:2.5,inter:.8},options);this.keyid=$.CON_MANAGE_COOKIE+(siteid?"_"+siteid.toUpperCase():"");this.identid=this._2shortTime(0,8,13);if($.browser.chrome){this.options.timeout=5}this.options.timeout*=10;this.options.inter*=1e3;this.inter=this.options.inter;this.pageStore=$.store;try{while(LSReadCount--){arrPageList=this.pageStore.get(this.CON_MANAGE_PAGE_LIST)||"";if(arrPageList!=="")break}cookiePageList=this._get().m;arrPageList=arrPageList===""||cookiePageList.length===0?[]:arrPageList.split(",");if(arrPageList.length!=cookiePageList.length&&arrPageList.length<=this.options.pageNum){arrPageList=[];for(var i=0;i<cookiePageList.length;i++){for(var cookiePageId in cookiePageList[i]){arrPageList.push(cookiePageId)}}}arrPageList.push(this.identid);this.pageStore.set(this.CON_MANAGE_PAGE_LIST,arrPageList.join(","))}catch(e){}var before=$.getTime();this.interID=setInterval(function(){setTimeout(function(){now=$.getTime();var elapsedTime=now-before;self._update(elapsedTime);self.options.onInterval(self.options.timeout,self.data.m);before=$.getTime()},0)},this.options.inter);$.Event.addEvent(window,"unload",function(){self._remove();setTimeout(function(){},500)})},getIsLastPage:function(){return this.data.m.length},_get:function(){var data=$.cookie.get(this.keyid)||"{}";return $.extend({m:[]},$.JSON.parseJSON(data))},_save:function(){var data=$.JSON.toJSONString(this.data);$.cookie.set(this.keyid,data,0);return data},_remove:function(){var index=this._getIndex();this.data.m.splice(index,1);this._save();var pageStr=this.pageStore.get(this.CON_MANAGE_PAGE_LIST);if(!pageStr||pageStr===""){return}var pageArr=pageStr.split(",");for(var i=0;i<pageArr.length;i++){if(pageArr[i]==this.identid){pageArr.splice(i,1);break}}pageStr=pageArr.join(",");if(pageStr!==""){this.pageStore.set(this.CON_MANAGE_PAGE_LIST,pageStr)}else{this.pageStore.whereClear(this.CON_MANAGE_PAGE_LIST)}},_update:function(intervalTime){this.data=this._get();this._clear(intervalTime);var self=this,type="update",Index=this._getIndex();this.data.t=$.formatDate();if(!this.data.m[Index]){if(this.data.m.length<this.options.pageNum){type="add";this.data.m[Index]={}}else{return}}this.data.m[Index][this.identid]=this._2shortTime();this._save();if(this.debug){$.Log(this.identid+",pageCount:"+this.data.m.length+","+type+" data:"+$.JSON.toJSONString(this.data.m))}if((type=="add"||this.chanageCall!==true)&&this.count!=this.data.m.length){this.options.onChanage.call(this,this.data.m.length,this.data.m);this.count=this.data.m.length}this.chanageCall=false},_clear:function(intervalTime){var curTime=this._2shortTime();if(!this.data.m.length)return;for(var i=0,diff;i<this.data.m.length;i++){if(!this.data.m[i]){continue}for(var pid in this.data.m[i]){if(typeof this.data.m[i][pid]=="function"){continue}diff=curTime-this.data.m[i][pid];if(Math.abs(diff)>this.options.timeout+intervalTime/100){this.data.m.splice(i,1);this.chanageCall=true;var pageStr=this.pageStore.get(this.CON_MANAGE_PAGE_LIST);if(!pageStr||pageStr===""){return}var pageArr=pageStr.split(",");for(var j=0;j<pageArr.length;j++){if(pageArr[j]==pid){pageArr.splice(j,1);break}}pageStr=pageArr.join(",");if(pageStr!==""){this.pageStore.set(this.CON_MANAGE_PAGE_LIST,pageStr)}else{this.pageStore.whereClear(this.CON_MANAGE_PAGE_LIST)}}}}},_getIndex:function(){if(!this.data||!this.data.m.length){return 0}for(var i=0;i<this.data.m.length;i++){if(!this.data.m[i]){continue}for(var pid in this.data.m[i]){if(!this.data.m[i]||$.isFunction(this.data.m[i][pid])){continue}else if(pid===this.identid){return i}}}return i},_2shortTime:function(id,start,end){var identid=(id?id:$.getTime()).toString();start=start||5;end=end||11;return identid.substring(start,end)}};$.store=function(){var namespace="__cometd__",store={disabled:false},isStorageSupported=function(){var supported=null;try{supported=window.localStorage}catch(e){$.Log("localStorage:"+e.message,3);return false}if(supported){var mod="test";try{if(localStorage.getItem(mod)!==null){localStorage.removeItem(mod)}localStorage.setItem(mod,mod);if(localStorage.getItem(mod)==mod){localStorage.removeItem(mod);return true}else{return false}}catch(e){$.Log("The browser localStorage is unavailable. "+e.message,3);return false}}},isSupportUserData=$.browser.msie,storage;store.toJSONString=function(value){return value===null?"":$.JSON.toJSONString(value)};store.parseJSON=function(value){if(typeof value=="object"){return value||undefined}try{return $.JSON.parseJSON(value)}catch(e){return value||undefined}};if(isStorageSupported()){storage=window.localStorage;store.set=function(key,val){if(!val||val===undefined||val===null){return store.remove(key)}try{if(typeof storage.setItem=="function"){storage.setItem(key,store.toJSONString(val))}else{storage[key]=store.toJSONString(val)}}catch(e){if(e.name.toUpperCase()=="QUOTA_EXCEEDED_ERR"){store.remove(key);try{storage.setItem(key,store.toJSONString(val))}catch(err){$.Log("store.set:"+err.message,3)}}}return val};store.get=function(key){return store.parseJSON(storage.getItem(key))};store.remove=function(key){try{storage.removeItem(key)}catch(e){$.Log("store.remove:"+e.message,3)}};store.clear=function(){try{storage.clear()}catch(e){$.Log("store.clear:"+e.message,3)}};store.getAll=function(){var ret={};for(var i=0;i<storage.length;++i){var key=storage.key(i);ret[key]=store.get(key)}return ret}}else if(isSupportUserData){var forbiddenCharsRegex=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");var storageOwner,storageContainer;var withIEStorage=function(storeFunction){return function(){var result,args=Array.prototype.slice.call(arguments,0);args.unshift(storage);try{storageOwner.appendChild(storage)}catch(e){storageOwner.insertBefore(storage,storageOwner.firstChild)}if(storage.addBehavior){storage.addBehavior("#default#userData")}var i=20;while(i>0){i--;try{storage.load("nTK-LS");break}catch(e){}}result=storeFunction.apply(store,args);storageOwner.removeChild(storage);return result}},ieKeyFix=function(key){return key.replace(forbiddenCharsRegex,"___")};try{storageContainer=new ActiveXObject("htmlfile");storageContainer.open();storageContainer.write('<script type="text/javascript">document.w=window;</script><iframe src="/favicon.ico"></iframe>');storageContainer.close();storageOwner=storageContainer.w.frames[0].document;storage=storageOwner.createElement("div")}catch(e){storage=document.createElement("div");storageOwner=document.body||document.getElementsByTagName("head")[0]||document.documentElement}store.set=withIEStorage(function(storage,key,val){key=ieKeyFix(key);if(!val||val===undefined||val===null){return store.remove(key)}storage.setAttribute(key,store.toJSONString(val));try{storage.save("nTK-LS")}catch(e){}return val});store.get=withIEStorage(function(storage,key){key=ieKeyFix(key);return store.parseJSON(storage.getAttribute(key))});store.remove=withIEStorage(function(storage,key){key=ieKeyFix(key);storage.removeAttribute(key);storage.save("nTK-LS")});store.clear=withIEStorage(function(storage){var attributes;try{attributes=storage.XMLDocument.documentElement.attributes}catch(e){return}storage.load("nTK-LS");for(var i=0,l=attributes.length;i<l;i++){var attr=attributes[i];storage.removeAttribute(attr.name)}storage.save("nTK-LS")});store.getAll=withIEStorage(function(storage){var attributes;try{attributes=storage.XMLDocument.documentElement.attributes}catch(e){return}var ret={};for(var i=0,l=attributes.length;i<l;++i){var attr=attributes[i];var key=ieKeyFix(attr.name);ret[attr.name]=store.parseJSON(storage.getAttribute(key))}return ret})}else{store.set=function(){$.Log("The browser localStorage is unavailable.",3)};store.get=emptyFunc;store.remove=emptyFunc;store.clear=emptyFunc;store.getAll=emptyFunc}try{store.set(namespace,namespace);if(store.get(namespace)!=namespace){store.disabled=true}store.remove(namespace)}catch(e){store.disabled=true}store.whereClear=function(fix){var self=this;var data=this.getAll();$.each(data,function(key){if(key.indexOf(fix)>-1){self.remove(key)}})};store.enabled=!store.disabled;return store}();$.comet=$.Class.create();$.comet.prototype={name:"public.comet",version:"2014.05.17",connType:"login",options:null,fix:"",id:"",count:0,sendIntervalID:null,_ipExpr:/^https?:\/\/\d+\.\d+\.\d+\.\d+(:\d+)?\/(.*?)$/gi,_cacheElement:{},_connectTimeID:{},defaultOption:{muDomain:1,timeout:20,onCallback:emptyFunc,onComplete:emptyFunc,onAbnormal:emptyFunc,onTimeout:emptyFunc},changePort:false,initialize:function(url,options){var self=this;this.uri=url;this.fix=$.randomChar();if(!this.uri){$.Log("comet uri is null",3)}this.callMethod=window;this.callbackName="callback_"+this.fix;this.callMethod[this.callbackName]=function(){self._connectCallback.call(self,self.id,arguments)};this.options=$.extend({},this.defaultOption,options);this.initConnectionPooling()},initMessageQueue:function(){if(!this.messageQueue){this.messageQueue=new $.Queue;this.messageQueue.addMessage=function(obj){for(var i=0;i<this.length;i++){if(this.list[i].msgid==obj.msgid&&this.list[i].index==obj.index){return false}}this.enQueue(obj);return true};this.messageQueue.nextMessage=function(msgid,index){if(this.isEmpty()){return null}else if(!msgid){return this.queueFront()}for(var i=0;i<this.length;i++){if(this.list[i].msgid==msgid&&this.list[i].body.sendpacket==index){return this.list[i+1]}}};this.messageQueue.removeMessage=function(msgid,index){for(var removeIndex,i=0;i<this.length;i++){if(this.list[i].msgid==msgid&&(this.list[i].index==index||index==-1)){removeIndex=i}}this.list.splice(i,1);this.length=this.list.length}}},initConnectionPooling:function(){if(!this.connectionPooling){if(this._ipExpr.test(this.uri)){this.options.muDomain=1}this.connectionPooling=new $.Queue;this.connectionPooling.get=function(){var cpConnect,unlockConnect,earliestConnect;for(var sTimesample,i=0;i<this.list.length;i++){if(this.list[i].lock===false){if(!unlockConnect||unlockConnect.rTimesample>this.list[i].rTimesample){unlockConnect=this.list[i]}}if(!earliestConnect||this.list[i].sTimesample<earliestConnect.sTimesample){earliestConnect=this.list[i]}}cpConnect=unlockConnect||earliestConnect;this.recover(cpConnect.uri,true);return cpConnect};this.connectionPooling.getConnect=function(){var cpConnect=this.get();return{uri:cpConnect.uri,url:cpConnect.uri+(/\?$/gi.test(cpConnect.uri)?"&":"?")}};this.connectionPooling.recover=function(uri,lock,sTimesample,rTimesample){for(var i=0;i<this.list.length;i++){if(this.list[i].uri!=uri)continue;this.list[i].lock=lock;if(lock){this.list[i].sTimesample=sTimesample||$.getTime();this.list[i].rTimesample=0}else{this.list[i].rTimesample=rTimesample||$.getTime()}return true}return false};for(var i=0;i<=this.options.muDomain;i++){var httpFlag=true;var usePort=false;var defaultPort=80;if(this.uri.indexOf("https://")>-1){httpFlag=false;defaultPort=443}var getPortUrl=this.uri.replace(/(https?:)(\/)+/gi,"");if(getPortUrl.indexOf(":")>-1&&getPortUrl.indexOf(":")<getPortUrl.indexOf("/")){usePort=true;defaultPort=parseInt(getPortUrl.substring(getPortUrl.indexOf(":")+1,getPortUrl.indexOf("/")))}if(i===1&&this.changePort){if(!usePort){this.uri=(httpFlag?"http://":"https://")+getPortUrl.replace("/",":"+ ++defaultPort+"/")}else{this.uri=(httpFlag?"http://":"https://")+getPortUrl.replace(":"+defaultPort,":"+ ++defaultPort)}}this.connectionPooling.enQueue({uri:this.uri.toString(),lock:false,sTimesample:0,rTimesample:0})}}},connect:function(json,callName){var objConnect,url,index=this.count++;this.connType="login";this.id=this.fix+"_"+index;json[callName||"callbackname"]=this.callbackName;this.connectOptions=$.extend(json,{ts:$.getTime()});objConnect=this.connectionPooling.getConnect();url=objConnect.url+$.toURI(this.connectOptions);this._cacheElement[this.id]=this._createConnect(url,this.id,index,objConnect)},kalive:function(json,callName){var objConnect,url,index=this.count++;this.connType="kalive";this.id=this.fix+"_"+index;json[callName||"callbackname"]=this.callbackName;this.kaliveOptions=$.extend(this.kaliveOptions,json,{ts:$.getTime()});objConnect=this.connectionPooling.getConnect();url=objConnect.url+$.toURI(this.kaliveOptions);this._cacheElement[this.id]=this._createConnect(url,this.id,index,objConnect)},disconnectServer:function(json,cache){var objConnect=this.connectionPooling.getConnect();this.flashGoServer=objConnect.url+$.toURI(cache===false?json:$.extend(json,{ts:$.getTime()}));return this.flashGoServer},disconnect:function(){$.require(this.flashGoServer,function(script){$(script.error?script.target:script).remove()});window[this.callbackName]=emptyFunc},reconnect:function(){this.connect(this.connectOptions)},send:function(data,callback){var self=this,objConnect=this.connectionPooling.getConnect(),url=this.mdyServerAddr(objConnect.url)+$.toURI(data);$.require(url+"#rnd",function(script){self.connectionPooling.recover(objConnect.uri,false);if(callback){callback.call(self,script.error)}$(script.error?script.target:script).remove()});return true},mdyServerAddr:function(url){return url.replace(/\/flashgo/i,"/httpgo")},post:function(data,callback){var self=this,objConnect=this.connectionPooling.getConnect();new $.POST(this.mdyServerAddr(objConnect.url),data,function(){self.connectionPooling.recover(objConnect.uri,false);if(callback){callback.call(self,true)}})},_createConnect:function(uri,id,index,connect){var self=this,script,eventName,head=document.head||nTalk("head")[0]||document.documentElement;script=$({className:id,tag:"script",type:"text/javascript",async:"async",src:uri,charset:"utf-8"}).appendTo(head);eventName=script.get(0).readyState?"onreadystatechange":"onload";script.get(0)[eventName]=script.get(0).onerror=function(event){var reg=/^(loaded|complete|undefined)$/;var readyState=script.get(0).readyState;event=$.Event.fixEvent(event);if(!reg.test(readyState)){return}self.connectionPooling.recover(connect.uri,false);if(event.type!=="error"){setTimeout(function(){self._connectComplete(event,id);script.remove()},$.browser.msie?800:50)}else{self._connectAbnormal(event,id);script.remove()}};this._connectTimeID[id]=setTimeout(function(){script.first().remove();self._connectTimeout("timeout",id)},+this.options.timeout*1e3+1e4);return script.get(0)},_connectCallback:function(id,args){args=Array.prototype.slice.call(args);$("."+id).remove();if(!this._cacheElement[id]){this.options.onCallback.apply(self,[false,args])}else{this._stopCallComplete(id,"callback");this.options.onCallback.apply(self,[true,args])}},_connectComplete:function(event,id){var args=Array.prototype.slice.call(arguments);if(!this._cacheElement[id]){return}this._stopCallComplete(id,"complete");this.options.onComplete.apply(self,[this.connType].concat(args))},_connectAbnormal:function(event,id){var args=Array.prototype.slice.call(arguments);if(!this._cacheElement[id]){return}this._stopCallComplete(id,"abnormal");this.options.onAbnormal.apply(self,[this.connType].concat(args))},_connectTimeout:function(event,id){var args=Array.prototype.slice.call(arguments);if(!this._cacheElement[id]){return}this._stopCallComplete(id,"timeout");this.options.onTimeout.apply(self,[this.connType].concat(args))},_stopCallComplete:function(id){var script=this._cacheElement[id];if(script){script.onload=script.onreadystatechange=script.onerror=emptyFunc}else{$.Log("stop error id:"+id,3)}delete this._cacheElement[id];clearTimeout(this._connectTimeID[id]);delete this._connectTimeID[id]},_createScriptPCID:function(istemp){return"guest"+[istemp?"TEMP"+$.randomChar(4):$.randomChar(8),$.randomChar(4),$.randomChar(4),$.randomChar(4),$.randomChar(12)].join("-")}};$.mqttws=$.Class.create();$.mqttws.prototype={name:"public.mqttws",version:"2015.04.10",connect:null,subscriptions:[],messages:[],connected:false,recCount:0,waitTime:500,_wsKeepaliveId:null,_options:{url:null,siteid:null,pcid:null,onCallback:null,loginMsg:null,timeout:3,keepAliveInterval:90},initialize:function(options){var self=this;this.options=$.extend({},self._options,options);this.options.pcid=(this.options.siteid+"_"+this.options.pcid.substring(5)).substring(0,23);$.require({mqtt:"mosquitto.js?siteid="+$.extParmas.siteid},function(mqtt){self.connect=new $.Mosquitto;self.connect.onmessage=function(topic,payload,qos,retain){var data=$.JSON.parseJSON(payload);self.options.onCallback.apply(this,[true,[data.method].concat(data.params)])};self.connect.ondisconnect=function(message){if(this._wsKeepaliveId!==null){clearInterval(this._wsKeepaliveId);this._wsKeepaliveId=null}};self.connect.onconnect=function(rcMsg){if(rcMsg===0){self.connect.subscribe("foo",0);self.connect.publish("foo",self.options.loginMsg,0,0)}else{self.reconnect()}};self.connect.onreconnect=function(){self.reconnect()};self.connect.connect(self.options.url,self.options.keepAliveInterval,self.options.pcid)})},reconnect:function(){var self=this;if(++this.recCount<3){this._waitTime=500}else{this._waitTime=+"034567890".charAt(Math.ceil(Math.random()*5))*1e3}setTimeout(function(){self.connect.connect(self.options.url,self.options.keepAliveInterval,self.options.pcid)},this._waitTime)},disconnect:function(){this.connect.closeFlag=true;this.connect.disconnect()},kalive:function(aliveMsg){var self=this;if(!this._wsKeepaliveId){this._wsKeepaliveId=setInterval(function(){self.connect.publish("foo",aliveMsg,0,false)},this.options.keepAliveInterval*1e3)}}};$.extend({htmlToElement:function(strHTML){var tElement,rElements;if($.browser.msie){try{tElement=new ActiveXObject("MSXml.DOMDocument");tElement.loadXML(strHTML);rElements=tElement.childNodes}catch(e){tElement=document.createElement("DIV");tElement.innerHTML=strHTML;rElements=tElement.childNodes}}else{tElement=document.createElement("DIV");tElement.innerHTML=strHTML;rElements=tElement.childNodes}return rElements},elementToObject:function(elems){var result={},attName,elem;if($.isArray(elems)||elems.talkVersion){elem=elems[0]}else{elem=elems}result[elem.tagName.toLowerCase()]=elem.innerHTML||elem.text;if(elem.attributes){for(var i=0;i<elem.attributes.length;i++){attName=elem.attributes[i].name;if(attName)result[attName]=elem.attributes[i].value}}else{result.msg=elem.textContent}return result},jsonToxml:function(json){var self=this,returnXml="",temp;if(typeof json=="object"){$.each(json,function(name,item){if(typeof item=="string"&&name=="text")returnXml=item;else if($.isArray(json))returnXml+=self.jsonToxml(item);else{
returnXml+="<"+name;if(typeof item.attributes=="object"){for(var attrName in item.attributes){if(!item.attributes.hasOwnProperty(attrName))continue;returnXml+=" "+attrName+'="'+item.attributes[attrName]+'"'}delete item.attributes}temp=self.jsonToxml(item);if(item&&temp)returnXml+=">"+temp+"</"+name+">";else returnXml+=">"+"</"+name+">"}})}else{return json}return returnXml},utils:{options:{},handleLinks:function(html,options,linkPatternType){this.options=$.extend({},this.options,options);html=html||"";var linkPattern;if(!linkPatternType){linkPattern=this.linkPatterns}else{linkPattern=this.linkPatternsP4}for(var i=0;i<linkPattern.length;i++){html=html.replace(linkPattern[i][0],linkPattern[i][1])}return html},linkPatternsP4:[[/\[link\s+images=[\'\"]+([^\[\]\'\"]+)[\'\"]+\s*[^\[\]]*\]([^\[\]]+)\[\/link\]/gi,'<img width="324" height="146"  onload="globalChatHandle.scrollHistoryToBottom()" src="$1">'],[/\[link\s+submit=[\'\"]+([^\[\]\'\"]+)[\'\"]+\s*[^\[\]]*\]([^\[\]]+)\[\/link\]/gi,'<a class="specil" onclick="NTKF.chatManage.get().send(this.nextSibling.innerHTML, null, this.innerHTML);return false;" href="#">$2</a><span style="display:none;">$1</span>'],[/\[link\s+submit=([^\s\[\]\'\"]+)\s*[^\[\]]*\]([^\[\]]+)\[\/link\]/gi,'<a class="specil" onclick="NTKF.chatManage.get().send(this.nextSibling.innerHTML, null, this.innerHTML);return false;" href="#">$2</a><span style="display:none;">$1</span>'],[/\[link\](.*?)\[\/link\]/gi,'<a class="specil" onclick="NTKF.chatManage.get().send(this.innerHTML);return false;" >$1</a>'],[/<a class="specil" id="submitLink".*?>.*?<\/a>/gi,function(p){return p.replace(/(http|ftp|https)/gi,"$1_")}],[/\[link\s+url=[\'\"]+([^\[\]\'\"]+)[\'\"]+\s*[^\[\]]*\]([^\[\]]+)\[\/link\]/gi,'<a href="$1" target="_blank">$2</a>'],[/\[link\s+url=[\'\"]+([^\[\]\'\"]+)[\'\"]+\s*[^\[\]]*\]([^\[\]]+)\[\/link\]/gi,'<a href="$1" target="_blank">$2</a>'],[/\[link\s+url=([^\s\[\]\'\"]+)\s*[^\[\]]*\]([^\[\]]+)\[\/link\]/gi,'<a href="$1" target="_blank">$2</a>'],[/\[link\s+p4=[\'\"]+([^\[\]\'\"]+)[\'\"]+\s+title=[\'\"]+([^\[\]\'\"]+)[\'\"]+\s*[^\[\]]*\]([^\[\]]+)\[\/link\]/gi,"<a href=\"#\" onclick=\"$client.Activity.openP4('$1','$2');return false;\" >$3</a>"],[/\[link\s+p4=([^\s\[\]\'\"]+)\s+title=([^\s\[\]\'\"]+)\s*[^\[\]]*\]([^\[\]]+)\[\/link\]/gi,"<a href=\"#\" onclick=\"$client.Activity.openP4('$1','$2');return false;\" >$3</a>"],[/\[link\s+p4=[\'\"]+([^\[\]\'\"]+)[\'\"]+\s*[^\[\]]*\]([^\[\]]+)\[\/link\]/gi,"<a href=\"#\" onclick=\"$client.Activity.openP4('$1','$2');return false;\" >$2</a>"],[/\[link\s+p4=([^\s\[\]\'\"]+)\s*[^\[\]]*\]([^\[\]]+)\[\/link\]/gi,"<a href=\"#\" onclick=\"$client.Activity.openP4('$1','$2');return false;\" >$2</a>"],[/(^|[^"'=])((http|https|ftp):\/\/([\w-]+\.)+[\w-]+([\w-.\/?=;!*%$]*)?([\w-&=;!*%$]*)?)/gi,'$1<a href="$2" target="_new">$2</a>'],[/(http|ftp|https)_/gi,"$1"]],linkPatterns:[[/\[link\s+reconnect=([^\s\[\]'"]+)\s*[^\[\]]*]([^\[\]]+)\[\/\s*link]/gi,'<a style="'+$.STYLE_BODY+'display:inline-block;color:#005ffb;text-decoration:none;" href="javascript:void(0);" onclick="nTalk.chatManage.get(\'$1\').reconnect(this);return false;" >$2</a>'],[/\[link\s+message=([^\s\[\]'"]+)\s*[^\[\]]\s*source=([^\s\[\]'"]+)\s*[^\[\]]*]([^\[\]]+)\[\/\s*link]/gi,'<a style="'+$.STYLE_BODY+"display:inline-block;color:#005ffb;text-decoration:none;font-size:"+($.browser.mobile?14:12)+'px;" href="javascript:void(0);" onclick="nTalk.chatManage.get(\'$1\').switchUI(\'message\', $2);return false;" >$3</a>'],[/\[link\s+cancel=([^\s\[\]'"]+)\s+action=([^\s\[\]'"]+)\s*[^\[\]]*]([^\[\]]+)\[\/\s*link]/gi,'<a style="'+$.STYLE_BODY+'display:inline-block;color:#005ffb;text-decoration:none;" href="javascript:void(0);" onclick="nTalk.chatManage.get(\'$1\').cancelUpload(\'$2\');return false;" >$3</a>'],[/\[link\s+resend=([^\s\[\]'"]+)\s+msgid=([^\s\[\]'"]+)\s*[^\[\]]*]([^\[\]]+)\[\/\s*link]/gi,'<a style="'+$.STYLE_BODY+'display:inline-block;color:#005ffb;text-decoration:none;" href="javascript:void(0);" onclick="nTalk.chatManage.get(\'$1\').resend(\'$2\', this);return false;" >$3</a>'],[/\[link\s*manual=([^\s\[\]'"]+)](.*?)\[\/link]/gi,'<a style="'+$.STYLE_BODY+'display:inline-block;color:#005ffb;text-decoration:none;" href="javascript:void(0);" onclick="nTalk.chatManage.get(\'$1\').switchServerType(true);return false;" >$2</a>'],[/\[link\s*artificial=([^\s\[\]'"]+)](.*?)\[\/link]/gi,'<a style="'+$.STYLE_BODY+'display:inline-block;color:#005ffb;text-decoration:none;" href="javascript:void(0);" onclick="nTalk.chatManage.get(\'$1\').switchServerType(true);return false;" >$2</a>'],[/\[link\s*robot](.*?)\[\/link]/gi,'<a style="'+$.STYLE_BODY+'display:inline-block;color:#005ffb;text-decoration:none;" href="javascript:void(0);" onclick="nTalk.chatManage.get().switchServerType(false, 2);return false;" >$1</a>'],[/\[link\s*robotindex=([^\s\[\]'"]+)\s*\](.*?)\[\/link]/gi,'<a style="'+$.STYLE_BODY+'display:inline-block;color:#005ffb;text-decoration:none;" href="javascript:void(0);" onclick="nTalk.chatManage.get(\'{$settingid}\').send(\'$1\');return false;">$2</a>'],[/\[link\s*rightTag=true\s*url="(.*?)"\s*close=(.*?)\s*title="(.*?)"\s*\](.*?)\[\/link\]/gi,'<span style="'+$.STYLE_BODY+'display:inline-block;color:#005ffb;text-decoration:none;cursor:pointer;" rightTag="true" src="$1" closeBtn="$2" title="$3">$4</span>'],[/\[xnlink](.*?)\[\/xnlink]/gi,'<span class="robotQuestion" style="'+$.STYLE_BODY+'display:inline-block;color:#005ffb;text-decoration:none;cursor:pointer;" href="javascript:void(0);" >$1</span>'],[/\[xnflowlink\s*flowid=\"([0-9]+)\"\s](.*?)\[\/xnflowlink]/gi,'<span class="robotQuestion" data-flowid="$1" style="'+$.STYLE_BODY+'display:inline-block;color:#005ffb;text-decoration:none;cursor:pointer;" href="javascript:void(0);" >$2</span>'],[/\[link\s*href=(.*?)](.*?)\[\/link]/gi,'<a style="'+$.STYLE_BODY+'display:inline-block;color:#005ffb;text-decoration:none;cursor:pointer;" href="$1">$2</a>'],[/\[link\s*(.*?)?](.*?)\[\/link]/gi,'<a style="'+$.STYLE_BODY+'display:inline-block;color:#005ffb;text-decoration:none;cursor:pointer;" href="javascript:void(0);"'+($.browser.iOS?' href="$1" target="_blank"':" onclick=\"window.open('$1')\"")+">$2</a>"],[/\{\$(\w+)}/gi,function(a,n){return $.utils.options[n]||""}]]},toHSL:function(c){if($.isHex(c))return $.rgb2HSL($.hex2RGB(c));if($.isRGB(c))return $.rgb2HSL(c);else return c},isHex:function(c){return typeof c=="string"&&/^#?([0-9a-f]{3}|[0-9a-f]{6})$/gi.test(c)},isRGB:function(c){return $.isObject(c)&&$.isDefined(c.r)&&$.isDefined(c.g)&&$.isDefined(c.b)},isHSL:function(c){return $.isObject(c)&&$.isDefined(c.h)&&$.isDefined(c.s)&&$.isDefined(c.l)},hex2RGB:function(sHex){var c=sHex.toString().replace("#",""),a=c.split(""),oRGB={};if(c.length==3){oRGB={r:parseInt(a[0]+a[0],16),g:parseInt(a[1]+a[1],16),b:parseInt(a[2]+a[2],16)}}else if(c.length==6){oRGB={r:parseInt(a[0]+a[1],16),g:parseInt(a[2]+a[3],16),b:parseInt(a[4]+a[5],16)}}else{oRGB={r:0,g:0,b:0}}return oRGB},rgb2HSL:function(oRGB){var R,G,B,del_R,del_G,del_B,Min,Max,del_Max,oHSL={};R=oRGB.r/255;G=oRGB.g/255;B=oRGB.b/255;Min=Math.min(R,G,B);Max=Math.max(R,G,B);del_Max=Max-Min;oHSL.l=(Max+Min)/2;if(del_Max===0){oHSL.h=0;oHSL.s=0}else{if(oHSL.l<.5)oHSL.s=del_Max/(Max+Min);else oHSL.s=del_Max/(2-Max-Min);del_R=((Max-R)/6+del_Max/2)/del_Max;del_G=((Max-G)/6+del_Max/2)/del_Max;del_B=((Max-B)/6+del_Max/2)/del_Max;if(R==Max)oHSL.h=del_B-del_G;else if(G==Max)oHSL.h=1/3-del_B+del_R;else if(B==Max)oHSL.h=2/3-del_R+del_G;if(oHSL.h<0)oHSL.h+=1;if(oHSL.h>1)oHSL.h-=1}return oHSL}});$.fn.extend({animate:function(options,duration,callback){return $.each(this,function(i,elem){$.animate(elem,options,duration,callback)})},show:function(duration,callback){if($.isFunction(duration)){callback=duration;duration=500}return this.animate({visibility:"visible",opacity:{from:0,to:1}},duration||500,callback)},hide:function(duration,callback){if($.isFunction(duration)){callback=duration;duration=500}return this.animate({opacity:{to:0}},duration||500,callback)},gradient:function(direction,scolor,ecolor){var dp,c;if(!direction){return $.each(this,function(i,element){if($.browser.oldmsie)$(element).css("filter","none");else $(element).css("background-image","none")})}else{return $.each(this,function(i,element){if($.browser.oldmsie){dp=/top|bottom/.test(direction)?0:1;if(/right|bottom/.test(direction)){c=scolor;scolor=ecolor;ecolor=c}}if($.browser.webkit){switch(direction){case"top":dp="0% 100%,0% 0%";break;case"right":dp="0% 0%,100% 0%";break;case"bottom":dp="0% 0%,0% 100%";break;case"left":dp="100% 0%,0% 0%";break}$(element).css("background-image",!direction?"none":"-webkit-gradient(linear,"+dp+",color-stop(1, "+scolor+"),color-stop(0, "+ecolor+"))")}else if($.browser.gecko){$(element).css("background-image",!direction?"none":"-moz-linear-gradient("+direction+", "+scolor+", "+ecolor+")")}else if($.browser.oldmsie){var gradientExp=/progid:DXImageTransform\.Microsoft\.gradient\((.*?)\)\s*/gi;element.style.filter=element.currentStyle.filter.replace(gradientExp,"")+(!direction?"":" progid:DXImageTransform.Microsoft.gradient(GradientType="+dp+",startColorstr='"+scolor+"', endColorstr='"+ecolor+"')")}else if($.browser.msie){$(element).css("background-image",!direction?"none":"-ms-linear-gradient("+direction+", "+scolor+", "+ecolor+")")}else{$(element).css("background-image",!direction?"none":"linear-gradient("+direction+", "+scolor+", "+ecolor+")")}})}}});$.extend({base64:{_strKey:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(input){var self=$.base64;var output="";var chr1,chr2,chr3,enc1,enc2,enc3,enc4;var i=0;input=self._utf8_encode(input||"");while(i<input.length){chr1=input.charCodeAt(i++);chr2=input.charCodeAt(i++);chr3=input.charCodeAt(i++);enc1=chr1>>2;enc2=(chr1&3)<<4|chr2>>4;enc3=(chr2&15)<<2|chr3>>6;enc4=chr3&63;if(isNaN(chr2)){enc3=enc4=64}else if(isNaN(chr3)){enc4=64}output=output+self._strKey.charAt(enc1)+self._strKey.charAt(enc2)+self._strKey.charAt(enc3)+self._strKey.charAt(enc4)}return output},decode:function(input){var self=$.base64;var output="";var chr1,chr2,chr3;var enc1,enc2,enc3,enc4;var i=0;input=(input||"").replace(/[^A-Za-z0-9\+\/=]/g,"");while(i<input.length){enc1=self._strKey.indexOf(input.charAt(i++));enc2=self._strKey.indexOf(input.charAt(i++));enc3=self._strKey.indexOf(input.charAt(i++));enc4=self._strKey.indexOf(input.charAt(i++));chr1=enc1<<2|enc2>>4;chr2=(enc2&15)<<4|enc3>>2;chr3=(enc3&3)<<6|enc4;output=output+String.fromCharCode(chr1);if(enc3!=64){output=output+String.fromCharCode(chr2)}if(enc4!=64){output=output+String.fromCharCode(chr3)}}output=self._utf8_decode(output);return output},_utf8_encode:function(string){string=string.replace(/\r\n/g,"\n");var utftext="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c)}else if(c>127&&c<2048){utftext+=String.fromCharCode(c>>6|192);utftext+=String.fromCharCode(c&63|128)}else{utftext+=String.fromCharCode(c>>12|224);utftext+=String.fromCharCode(c>>6&63|128);utftext+=String.fromCharCode(c&63|128)}}return utftext},_utf8_decode:function(utftext){var string="";var i=0;var c,c2,c3;while(i<utftext.length){c=utftext.charCodeAt(i);if(c<128){string+=String.fromCharCode(c);i++}else if(c>191&&c<224){c2=utftext.charCodeAt(i+1);string+=String.fromCharCode((c&31)<<6|c2&63);i+=2}else{c2=utftext.charCodeAt(i+1);c3=utftext.charCodeAt(i+2);string+=String.fromCharCode((c&15)<<12|(c2&63)<<6|c3&63);i+=3}}return string}},FORM:{createInput:function(cfgRequiredField,appendTdParams,noNullChar){var trHtml=[],formField,option,checked,formTitle,mobile=$.browser.mobile,appendTd=$.extend({id:"",rowspan:0,style:""},appendTdParams),required='<span class="ntkf-text-red" style="'+$.STYLE_BODY+'padding:2px 5px 2px 0;color:#f00;">'+(noNullChar||"")+"</span>";for(var i=0;i<cfgRequiredField.length;i++){formField=$.extend({titlewidth:"80px",inputwidth:"auto",input:{width:"90%",height:"auto"}},cfgRequiredField[i]);if(!mobile){formTitle=formField.title+(formField.title.length==$.enLength(formField.title)?":":"")}else{formTitle=formField.title}if(/zh_cn|zh_tw/.test($.lang.language)&&$.enLength(formField.title)>16||formField.multipart||/radio|checkbox/.test(formField.type)&&formField.options.length>2){formField.multipart=true;trHtml.push(mobile?'<tr style="'+$.STYLE_BODY+'">'+'<td style="'+$.STYLE_BODY+'width:100%;"><div class="nt-mobile-form-title" style="'+$.STYLE_BODY+'width:100%; line-height:14px; font-size:14px; font-weight:bold; text-align:center; color:#333333; margin: 15px 0px 20px 0px">'+formTitle+"</div>":['<tr style="',$.STYLE_BODY,'">','<td style="',$.STYLE_BODY,'vertical-align:top;line-height:28px;color:#333;" colspan="2">','<div style="',$.STYLE_BODY,'margin:5px 10px 5px 10px;color:#5a5a5a;">',formTitle,formField.required===true?required:"","</div>","</td>","</tr>",'<tr style="'+$.STYLE_BODY+'"><td style="',$.STYLE_BODY,'padding:0 5px 0 0;text-align:right;vertical-align:top;line-height:28px;color:#333;"></td>','<td style="'+$.STYLE_BODY+"line-height:28px;width:"+formField.inputwidth+';">'].join(""))}else{trHtml.push('<tr style="'+$.STYLE_BODY+'">'+(mobile?"":'<td style="'+$.STYLE_BODY+"padding:0 5px 0 0;text-align:right;vertical-align:top;line-height:28px;color:#333;width:"+formField.titlewidth+';">'+'<div style="'+$.STYLE_BODY+'margin:4px 0 0 0;text-align:right;color:#5a5a5a;">'+(formField.required===true?required:"")+formTitle+"</div></td>")+'<td style="'+$.STYLE_BODY+"line-height:28px;width:"+(mobile?"100%":formField.inputwidth)+';">')}switch(formField.type){case"select":trHtml.push('<select data-index="'+i+'" name="'+formField.name+'" style="'+$.STYLE_BODY+"border:1px solid #ccc;height:24px;color:#333;margin:0 0 4px;line-height:20px;width:"+(mobile?"99%":formField.input.width)+';">');trHtml.push('<option value="" style="'+$.STYLE_BODY+'color:#ccc;">'+formField.defaultText+"</option>");for(var ii=0;ii<formField.options.length;ii++){option=formField.options[ii];option=typeof option=="string"?{text:option,value:option}:option;trHtml.push('<option value="'+option.value+'" style="'+$.STYLE_BODY+'color:#333;">'+option.text+"</option>")}trHtml.push("</select>");break;case"radio":trHtml.push('<ul style="'+$.STYLE_BODY+'list-style:none;">');for(var j=0,radioId;j<formField.options.length;j++){option=formField.options[j];option=typeof option=="string"?{text:option,value:option}:option;radioId=formField.name+"_"+j;checked=formField.defaultText==option.value?" checked":"";trHtml.push('<li class="form-item" style="'+$.STYLE_BODY+'list-style:none;padding:0 2px 0 0;color:#000;float:left;">'+'<input type="radio" name="'+formField.name+'"id="'+radioId+'" value="'+option.value+'" _custom_text="'+option.text+'" style="'+$.STYLE_BODY+'color:#333;outline:none;-webkit-appearance:radio"'+checked+" />"+'<label for="'+radioId+'" style="'+$.STYLE_BODY+'display:inline;color:#000;">'+option.text+"</label></li>")}trHtml.push('<li style="'+$.STYLE_BODY+'list-style:none;clear:both;width:0;height:0;"></li>');trHtml.push("</ul>");break;case"checkbox":trHtml.push('<ul style="'+$.STYLE_BODY+'list-style:none;">');for(var k=0,checkboxId;k<formField.options.length;k++){option=formField.options[k];option=typeof option=="string"?{text:option,value:option}:option;checkboxId=formField.name+"_"+k;checked=formField.defaultText==option.value?" checked":"";trHtml.push('<li class="form-item" style="'+$.STYLE_BODY+'list-style:none;padding:0 2px 0 0;float:left;">'+'<input type="checkbox" name="'+formField.name+'" id="'+checkboxId+'" value="'+option.value+'" _custom_text="'+option.text+'" style="'+$.STYLE_BODY+'color:#333;"'+checked+" />"+'<label for="'+checkboxId+'" style="'+$.STYLE_BODY+'display:inline;color:#000;">'+option.text+"</label></li>")}trHtml.push('<li style="'+$.STYLE_BODY+'list-style:none;clear:both;width:0;height:0;"></li>');trHtml.push("</ul>");break;case"textarea":trHtml.push('<textarea data-index="'+i+'" name="'+formField.name+'" style="'+$.STYLE_BODY+"border:1px solid #ccc;color:#ccc;width:"+(mobile?"99%":formField.input.width)+";height:"+formField.input.height+';"'+($.browser.html5?' placeholder="'+formField.defaultText+'">':">"+formField.defaultText)+"</textarea>");break;default:trHtml.push('<input data-index="'+i+'" type="text" name="'+formField.name+'"'+($.browser.html5?' placeholder="'+formField.defaultText+'" value=""':' value="'+formField.defaultText+'"')+' maxlength="32" style="'+$.STYLE_BODY+"border:1px solid #ccc;height:24px;width:"+(mobile?"99%":formField.input.width)+';margin:0 0 4px;color:#ccc;"');if(formField.verification=="phone"){trHtml.push(" onblur=\"this.value=this.value.replace(/[^0-9-]+/, '');\" onkeyup=\"var keyCode=(event || window.event).keyCode; if( !/16|17|35|36|37|38|39|40/i.test(keyCode) ){this.value=this.value.replace(/[^0-9-]+/, '');}\"")}trHtml.push(" />");break}if(formField.messageid){trHtml.push('<div style="'+$.STYLE_BODY+'display:none;color:#EF7208;" class="form-info '+formField.messageid+'">');trHtml.push('<div style="'+$.STYLE_BODY+"margin:2px;width:15px;height:15px;float:left;background:transparent url("+$.sourceURI+'/images/chaticon.png) no-repeat -160px -39px;"></div>');trHtml.push('<div style="'+$.STYLE_BODY+'color:#EF7208;float:left;" class="chat-view-info"></div>');trHtml.push('<div style="'+$.STYLE_BODY+'clear:both;width:0;height:0;"></div>');trHtml.push("</div>")}trHtml.push("</td>");if(appendTd.style&&i===0){trHtml.push('<td style="'+$.STYLE_BODY+appendTd.style+'" id="'+appendTd.id+'" rowspan="'+appendTd.rowspan+'"></td></tr>')}}return trHtml.join("")},bindFormEvent:function(cfgRequiredField,parent){var focusfunc=function(){var element=$(this).css({color:"#333","border-color":$.browser.mobile?"#0079fe":"#666"}),index=element.attr("data-index")||0,def=cfgRequiredField[index].defaultText;if(def==element.val())element.val("")};var blurfunc=function(){var element=$(this).css("border-color","#ccc"),index=element.attr("data-index")||0,def=cfgRequiredField[index].defaultText;if(element.val()==="")element.val(def);if(element.val()===""||element.val()==def){element.css("color","#ccc")}};$(parent).find("input[type=text]").bind("focus",focusfunc).bind("blur",blurfunc);$(parent).find("textarea").bind("focus",focusfunc).bind("blur",blurfunc)},verificationForm:function(fields,fnCallback,parentElement,failCallback){var element,selectElem,isNull,returnValue=[],showNews,value,failFlag=false,phone=new RegExp("\\d{6,}","i"),email=new RegExp("^[a-zA-Z0-9\\._-]+@[a-zA-Z0-9_-]+(\\.[a-zA-Z0-9_-]+)+$","i"),self=this,tmpFunc=function(ii,element){if(!element.checked)return;value={value:$(element).val()||"",text:$(element).attr("_custom_text")}},displayFunc=function(){$(this).display()};for(var i=0;i<fields.length;i++){switch(fields[i].type){case"checkbox":value=[];element=$(parentElement).find("input[name="+fields[i].name+"]");selectElem=$(parentElement).find("input[name="+fields[i].name+"][checked]");for(var j=0;j<selectElem.length;j++)value.push({value:selectElem.get(j).value,text:$(selectElem.get(j)).attr("_custom_text")});break;case"radio":value={value:"",text:""};element=$(parentElement).find("input[name="+fields[i].name+"]");$(parentElement).find("input[name="+fields[i].name+"][checked]").each(tmpFunc);break;case"select":element=$(parentElement).find("select[name="+fields[i].name+"]");value=$("option[selected]",element).val()||"";value=fields[i].defaultText&&value==fields[i].defaultText?"":value;break;case"textarea":element=$(parentElement).find("textarea[name="+fields[i].name+"]");if(fields[i].defaultText&&fields[i].defaultText==element.val()){value="";element.val("")}else value=element.val().replace(/(\")|(\')|((^\s*)|(\s*$))/g,"");break;default:element=$(parentElement).find("input[name="+fields[i].name+"]");if(fields[i].defaultText&&fields[i].defaultText==element.val()){value="";element.val("")}else value=element.val().replace(/(^\s*)|(\s*$)/g,"")}if(typeof value=="string"){isNull=value===""||!value.length}else if($.isArray(value)){isNull=value.length===0}else{isNull=value.value===""}showNews=fields[i].messageid&&fields[i].message?true:false;var infodiv=$(parentElement).find("."+fields[i].messageid);var info=$(parentElement).find("."+fields[i].messageid+" .chat-view-info");if(fields[i].required&&isNull){self.showError(showNews,fields[i].message[0],info,infodiv,element,fields[i].type);failFlag=true}else if(fields[i].verification=="phone"&&!isNull&&!phone.test(value)){self.showError(showNews,fields[i].message[1],info,infodiv,element);failFlag=true}else if(fields[i].verification=="email"&&!isNull&&!email.test(value)){self.showError(showNews,fields[i].message[1],info,infodiv,element);failFlag=true}else if(fields[i].min&&!isNull&&$.enLength(value)<fields[i].min){self.showError(showNews,fields[i].message[1],info,infodiv,element);failFlag=true}else if(fields[i].max&&!isNull&&$.enLength(value)>fields[i].max){self.showError(showNews,fields[i].message[2],info,infodiv,element);failFlag=true}else{if(showNews){infodiv.hide(displayFunc)}else if(/radio|checkbox/.test(fields[i].type))element.parent().css("color","#333");else element.css("border-color","#DBD8D1");if(!isNull)returnValue.push({name:fields[i].name,title:fields[i].title,value:value})}}if(failFlag){if(typeof failCallback=="function")failCallback();return}else{$.Log("form submit complete, failCallback is null",3)}if(typeof fnCallback=="function"){fnCallback(returnValue)}else{$.Log("form submit complete, callback is null",3)}},showError:function(showNews,message,info,infodiv,element,type){var self=this;if(showNews&&message){if(!$.browser.mobile){info.html(message);infodiv.display(1).show();element.get(0).focus()}else{if(this.messageErrorToast){this.messageErrorToast.remove();this.messageErrorToast=null;if(this.messageErrorTimeout)clearTimeout(this.messageErrorTimeout)}var width=message.length>10?300:250;this.messageErrorToast=new $.Toast('<div id="#message_error" style="position: relative;width: '+(width-50)+'px; height:30px; line-height: 30px;z-index:100; color: #FFF; top: 30px; left: 25px; text-align:center;font-weight:bold">'+message+"</div>",{width:width,height:90});this.messageErrorTimeout=setTimeout(function(){self.messageErrorToast.remove();self.messageErrorToast=null;element.get(0).focus()},2e3)}}else if(/radio|checkbox/.test(type)){element.parent().css("color","#f00")}else{element.css("border-color","#f00").get(0).focus()}}}});$.Transfer=$.Class.create();$.Transfer.prototype={name:"Transfer",button:null,element:null,form:null,iframe:null,proxy:null,options:null,debug:true,fkey:"",initialize:function(options,button){this.button=button;var tmpName=$.randomChar(16);this.options=$.extend({onError:emptyFunc,onChange:emptyFunc,callback:emptyFunc,name:tmpName,curName:"",compSize:1024*500,params:{},target:"iframe-transfer-"+tmpName},options);if(!this.options.server){$.Log("server is null",3);return}this.proxy=$({tag:"IFRAME",name:"proxy-"+tmpName,src:this.options.server.substring(0,this.options.server.lastIndexOf("/"))+"/proxy.html?t="+$.getTime(),style:$.STYLE_NBODY+"width:0px;height:0px;display:none;"}).appendTo($(this.button)).get(0).contentWindow;var self=this,width=Math.max(20,this.button.width(),parseFloat(this.button.css("width"))),height=Math.max(20,this.button.height(),parseFloat(this.button.css("height"))),style=$.STYLE_BODY+"width:"+width+"px;height:"+height+"px;overflow:hidden;";this.completed=function(event){var reg=/^(?:loaded|complete|undefined)$/;var readyState=this.readyState;if(!reg.test(readyState))return;self.iframe.removeEvent("readystatechange",self.completed).removeEvent("load",self.completed);self.transferComplete(event,self.fkey)};this.form=$({tag:"FORM",action:"",method:"POST",target:this.options.target,enctype:"multipart/form-data",style:style}).appendTo(this.button,true);this.iframe=$({tag:"IFRAME",name:this.options.target,src:"about:blank",style:style+"width:0;height:0;display:none;"}).appendTo(this.button,true);this.element=$({tag:"INPUT",type:"file",name:this.options.name,accept:this.options.accept||"*",style:style,title:this.button.attr("title")||""}).appendTo(this.form,true).css("opacity",0);this.element.click(function(){if(this.value!==""){self.form.get(0).reset()}self.iframe.bind("readystatechange",self.completed).bind("load",self.completed);self.fkey=$.randomChar(16)}).bind("change",function(event){var fileInfo={};if(!this.files){fileInfo.name=this.value.substring(this.value.lastIndexOf("\\")+1);fileInfo.size=""}else{fileInfo.name=this.files[0].name;fileInfo.size=this.files[0].size}if(fileInfo.name){self.options.onChange(fileInfo);self.fileChange(event,this.files||this.value)}})},transferComplete:function(event,fkey){var self=this;if(!fkey){return}if(this.debug){$.Log("$.upload.transferComplete(event, "+fkey+")")}$.jsonp(this.options.server+"?"+$.toURI($.extend({getaction:1,fkey:fkey},this.options.params))+"#rnd",function(data){if(self.debug){$.Log("get transfer file info:"+$.JSON.toJSONString(data),1)}data.name=self.options.curName||self.options.name||"";self.options.callback(data)})},fileChange:function(event,files){var self=this;this.isMobileCompTransf(files,function(mFlag){if(mFlag){if($.browser.oldAndroid){$.require("jpeg_encoder_basic.js?siteid="+self.options.params.siteid,function(encode){self.mobileCompTransf(event,files)})}else if($.browser.oldIOS){$.require("megapix-image.js?siteid="+self.options.params.siteid,function(encode){self.mobileCompTransf(event,files)})}else{self.mobileCompTransf(event,files)}}else{self.commonTransf(event,files)}})},isMobileCompTransf:function(files,callback){if($.browser.mobile&&(window.URL||window.webkitURL)&&document.createElement("canvas")){if(files[0].name.toLowerCase().indexOf("jpg")>-1){callback(true)}else if(window.FileReader&&window.DataView){var self=this;var fileReader=new FileReader;fileReader.onload=function(e){var dataView=new DataView(e.target.result);if(dataView.getUint8(0)==255&&dataView.getUint8(1)==216){callback(true)}else{callback(false)}};fileReader.readAsArrayBuffer(files[0])}else{callback(false)}}else{callback(false)}},commonTransf:function(event,files){var fileAction=this.options.params.action=="uploadfile"?true:false;var proxyMaxSize,proxyExt;try{proxyMaxSize=fileAction?this.proxy.fileOptions.fileMaxSize:this.proxy.fileOptions.imageMaxSize;proxyExt=fileAction?this.proxy.fileOptions.fileExt:this.proxy.fileOptions.imageExt}catch(e){proxyMaxSize=null;proxyExt=null}var accept;if(typeof files==="string"){if(this.debug)$.Log("Name: "+files,2)}else{for(var reg,i=0;i<files.length;i++){var file=files[i],ext;if(file.name.indexOf(".")>-1){ext=file.name.match(/\.[^\.]+$/)[0].replace(".","").toLowerCase()}else{ext=""}if(this.options.maxSize&&file.size>this.options.maxSize||proxyMaxSize&&file.size>proxyMaxSize){this.options.onError({type:9,name:file.name,size:file.size,etype:"SIZE",maxSize:this.options.maxSize||proxyMaxSize});return}if((this.options.accept=="*"||!this.options.accept)&&!proxyExt){continue}else if(this.options.accept&&this.options.accept.indexOf("/*")>-1){reg=new RegExp(this.options.accept.replace(/\//,"\\/"),"gi");if(!reg.test(file.type)){$.Log("accept:"+this.options.accept+", type:"+file.type,2);this.options.onError({type:9,name:file.name,size:file.size,etype:"TYPE"});return}}else if(this.options.accept&&this.options.accept.indexOf(file.type)<=-1){$.Log("accept:"+this.options.accept+", type:"+file.type,2);this.options.onError({type:9,name:file.name,size:file.size,etype:"TYPE"});return}else if(proxyExt&&proxyExt.indexOf(ext)>-1){continue}else if(proxyExt&&proxyExt.indexOf(ext)==-1){this.options.onError({type:9,name:file.name,size:file.size,ext:proxyExt,etype:"TYPE"});return}this.options.curName=file.name;if(this.debug)$.Log("Name: "+this.options.curName)}}if(this.debug){$.Log("$.upload.fileChange()")}this.form.attr("action",this.options.server+"?"+$.toURI($.extend({fkey:this.fkey,rnd:$.getTime()},this.options.params)));if($.browser.mobile){this.options.callback({status:"startUpload",oldfile:files[0].name})}this.form.get(0).submit()},mobileCompTransf:function(event,files){var self=this;this.options.callback({status:"startCompress",oldfile:files[0].name});this.fkey=$.getTime();var Oriention=new $.ImageOrientation(files[0],function(event,orientation){var compImg=new $.CompressImg(files[0],{orientation:orientation},function(event,dataurl){new $.POST(self.options.server+"?action=uploadimage",$.extend({base64:dataurl,fname:$.getTime()+".png",fkey:self.fkey,rnd:$.getTime()},self.options.params),function(e){self.transferComplete(e,self.fkey)});self.options.callback({status:"startUpload",oldfile:files[0].name,compress:true})})})},base64Transf:function(dataurl){var self=this;this.fkey=$.getTime();new $.POST(this.options.server+"?action=uploadimage",$.extend({base64:dataurl,fname:$.getTime()+".png",fkey:this.fkey,rnd:$.getTime()},this.options.params),function(e){self.transferComplete(e,self.fkey)})}};$.CompressImg=$.Class.create();$.CompressImg.prototype={ctx:null,canvas:null,url:null,image:null,blob:null,compBlob:null,dataurl:null,resize:{width:null,height:null},options:{width:null,height:null,quality:.7},initialize:function(file,options,callback){var self=this;this.url=window.URL||window.webkitURL;this.canvas=document.createElement("canvas");this.blob=typeof file==="string"?file:this.url.createObjectURL(file);this.options=$.extend(options,this.options);this.image=new Image;this.image.onerror=function(){$.Log("")};this.image.onload=function(e){self.getCompImage();callback(e,self.dataurl);var timeout=$.browser.oldIOS?1e4:0;setTimeout(function(){for(var p in self){if(!self.hasOwnProperty(p))continue;self[p]=null}},timeout)};this.image.crossOrigin="*";this.image.src=self.blob},drawOldIOSCanvas:function(){var mpImg=new MegaPixImage(this.image);if("5678".indexOf(this.options.orientation)>-1){mpImg.render(this.canvas,{width:this.canvas.height,height:this.canvas.width,orientation:this.options.orientation})}else{mpImg.render(this.canvas,{width:this.canvas.width,height:this.canvas.height,orientation:this.options.orientation})}},drawCanvas:function(){var self=this;switch(self.options.orientation){case 3:this.ctx.rotate(180*Math.PI/180);this.ctx.drawImage(this.image,-this.resize.width,-this.resize.height,this.resize.width,this.resize.height);break;case 6:this.ctx.rotate(90*Math.PI/180);this.ctx.drawImage(this.image,0,-this.resize.width,this.resize.height,this.resize.width);break;case 8:this.ctx.rotate(270*Math.PI/180);this.ctx.drawImage(this.image,-this.resize.height,0,this.resize.height,this.resize.width);break;case 2:this.ctx.translate(resize.width,0);this.ctx.scale(-1,1);this.ctx.drawImage(this.image,0,0,this.resize.width,this.resize.height);break;case 4:this.ctx.translate(resize.width,0);this.ctx.scale(-1,1);this.ctx.rotate(180*Math.PI/180);this.ctx.drawImage(this.image,-this.resize.width,-this.resize.height,this.resize.width,this.resize.height);break;case 5:this.ctx.translate(resize.width,0);this.ctx.scale(-1,1);this.ctx.rotate(90*Math.PI/180);this.ctx.drawImage(this.image,0,-this.resize.width,this.resize.height,this.resize.width);break;case 7:this.ctx.translate(resize.width,0);this.ctx.scale(-1,1);this.ctx.rotate(270*Math.PI/180);this.ctx.drawImage(this.image,-this.resize.height,0,this.resize.height,this.resize.width);break;default:this.ctx.drawImage(this.image,0,0,this.resize.width,this.resize.height)}},getCompImage:function(){var self=this;this.ctx=this.canvas.getContext("2d");this.resize=this._getResize();this.canvas.width=this.resize.width;this.canvas.height=this.resize.height;this.ctx.fillStyle="#fff";this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);if($.browser.oldIOS){this.drawOldIOSCanvas()}else{this.drawCanvas()}if($.browser.oldAndroid){var encoder=new JPEGEncoder,img=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height);this.dataurl=encoder.encode(img,this.options.quality*100)}else{this.dataurl=this.canvas.toDataURL("image/jpeg",this.options.quality)}this.url.revokeObjectURL(self.blob)},_getResize:function(){var self=this,img=this.image,width=this.options.width,height=this.options.height;var ret={width:img.width,height:img.height
};if("5678".indexOf(self.options.orientation)>-1){ret.width=img.height;ret.height=img.width}var scale=ret.width/ret.height;if(width&&height){if(scale>=width/height){if(ret.width>width){ret.width=width;ret.height=Math.ceil(width/scale)}}else{if(ret.height>height){ret.height=height;ret.width=Math.ceil(height*scale)}}}else if(width){if(width<ret.width){ret.width=width;ret.height=Math.ceil(width/scale)}}else if(height){if(height<ret.height){ret.width=Math.ceil(height*scale);ret.height=height}}while(ret.width>=3264||ret.height>=2448){ret.width*=.8;ret.height*=.8}return ret}};$.ImageOrientation=$.Class.create();$.ImageOrientation.prototype={initialize:function(file,callback){if(!window.FileReader||!window.DataView){return 1}var self=this;var fileReader=new FileReader;fileReader.onload=function(e){callback($.Event.fixEvent(e),self._readImageOrientation(e.target.result))};fileReader.readAsArrayBuffer(file)},_readImageOrientation:function(file){var dataView=new DataView(file);if(dataView.getUint8(0)!=255||dataView.getUint8(1)!=216){return 1}var offset=2,length=file.byteLength,marker;while(offset<length){if(dataView.getUint8(offset)!=255){return 1}marker=dataView.getUint8(offset+1);if(marker==225){return this._getOrientationFromExif(dataView,offset+4,dataView.getUint16(offset+2)-2)}else{offset+=2+dataView.getUint16(offset+2)}}},_getOrientationFromExif:function(file,start){if(this._getStringFromDB(file,start,4)!="Exif"){return 1}var bigEnd,tags,tag,exifData,tiffOffset=start+6;if(file.getUint16(tiffOffset)==18761){bigEnd=false}else if(file.getUint16(tiffOffset)==19789){bigEnd=true}else{return 1}if(file.getUint16(tiffOffset+2,!bigEnd)!=42){return 1}var firstIFDOffset=file.getUint32(tiffOffset+4,!bigEnd);if(firstIFDOffset<8){return 1}return this._getOrientationFromTag(file,tiffOffset,tiffOffset+firstIFDOffset,bigEnd)},_getOrientationFromTag:function(file,tiffStart,dirStart,bigEnd){var entries=file.getUint16(dirStart,!bigEnd),tags={},entryOffset,tag,i;for(i=0;i<entries;i++){entryOffset=dirStart+i*12+2;tag=file.getUint16(entryOffset,!bigEnd);if(tag==274){return this._getOrientationValue(file,entryOffset,tiffStart,dirStart,bigEnd)}}return 1},_getOrientationValue:function(file,entryOffset,tiffStart,dirStart,bigEnd){var type=file.getUint16(entryOffset+2,!bigEnd),numValues=file.getUint32(entryOffset+4,!bigEnd),valueOffset=file.getUint32(entryOffset+8,!bigEnd)+tiffStart,offset,vals,val,n;switch(type){case 3:if(numValues==1){return file.getUint16(entryOffset+8,!bigEnd)}else{offset=numValues>2?valueOffset:entryOffset+8;vals=[];for(n=0;n<numValues;n++){vals[n]=file.getUint16(offset+2*n,!bigEnd)}return vals}}},_getStringFromDB:function(buffer,start,length){var outstr="";for(n=start;n<start+length;n++){outstr+=String.fromCharCode(buffer.getUint8(n))}return outstr}};$.DialogChat=new $.Class.create;$.DialogChat.prototype={contains:null,background:null,iframe:null,display:false,selector:"",def:{close:false,parent:window,margin:10,border:0,style:{height:"auto"},resizeFunc:null},options:null,_funcResize:emptyFunc,initialize:function(html,options){var self=this;this.options=$.extend({},this.def,options);this.id=$.randomChar();this.selector=".dialog-container-"+this.id;this._create();this._style(this.options.style);this.display=true;if(!!this.options.close){html+='<div class="dialog-button-close" style="'+$.STYLE_NBODY+'font-size:14px;position:absolute;right:10px;top:10px;width:20px;height:20px;line-height:20px;text-align:center;cursor:pointer;">x</div>'}this.container.html(html);setTimeout(function(){if(self.options.top){self.container.css({top:self.options.top+"px"})}else{self.container.css({top:Math.max(0,($(self.options.parent).height()-Math.max(self.container.height(),200))/2)+"px"})}},5);this._funcResize=function(){self.resize()};if(this.options.parent==window){$(window).addEvent("resize",this._funcResize)}this.container.find(".dialog-button-close").click(function(){self.close()})},close:function(){var self=this;if(this.options.parent==window){$(window).removeEvent("resize",this._funcResize)}$(this.selector).hide(function(){$(".dialog-iframe-"+self.id+",.dialog-background-"+self.id).remove();$(self.selector).remove();self.display=false})},resize:function(width,height){width=width||$(this.options.parent).width();height=height||$(this.options.parent).height();$(".dialog-iframe-"+this.id+",.dialog-background-"+this.id).css({width:width+"px",height:height+"px"});var computeHeight=this.options.style.height==="auto"?"auto":height-this.options.margin*2-this.options.border*2;this.container.css({width:width-this.options.margin*2-this.options.border*2+"px",height:computeHeight=="auto"?"auto":computeHeight+"px","max-width":width+"px","max-height":height-40+"px"});this.container.css("top",Math.max(0,(height-Math.max(computeHeight=="auto"?this.container.height():computeHeight,200))/2)+"px");if(this.options.resizeFunc)this.options.resizeFunc.call()},_create:function(){var body=this.options.parent==window?document.body:this.options.parent;var position=this.options.parent==window?"fixed":"absolute";this.iframe=$({tag:"IFRAME",className:"dialog-iframe-"+this.id,style:$.STYLE_NBODY+"position:"+position+";display:none;left:0;top:0;margin:0;padding:0;border:0;width:100%;z-index:8888;"}).appendTo(body);this.background=$({tag:"div",className:"dialog-background-"+this.id,style:$.STYLE_NBODY+"position:"+position+";left:0;top:0;margin:0;padding:0;border:0;width:100%;background-color:#000;z-index:8888;"}).appendTo(body);var zIndex=$.browser.mobile?9e3:2147483647;this.container=$({tag:"div",className:"dialog-container-"+this.id,style:$.STYLE_BODY+"position:"+position+";left:0;top:0;margin:0;min-height:"+(this.options.minHeight?this.options.minHeight:200)+"px;border-radius:0px;z-index:"+zIndex+";background:#fff;overflow-x:hidden;overflow-y:auto;"}).appendTo(body);this.background.bind("touchstart",function(e){var event=$.Event.fixEvent(e);event.stopPropagation();event.preventDefault()}).bind("touchend",function(e){var event=$.Event.fixEvent(e);event.stopPropagation();event.preventDefault()})},_style:function(style){var width=$(this.options.parent).width();var height=$(this.options.parent).height();$(".dialog-iframe-"+this.id+",.dialog-background-"+this.id).css({width:width+"px",height:$(this.options.parent).height()+"px"});this.background.css({opacity:.6});var marginArray=(this.options.margin+"").split(" ");if(marginArray.length==1){marginArray.push(this.options.margin)}this.container.css(style).css({left:marginArray[0]+"px",top:marginArray[1]+"px",width:width-marginArray[0]*2-this.options.border*2+"px",height:this.options.style.height==="auto"?"auto":height-marginArray[1]*2-this.options.border*2+"px"})}};$.Toast=new $.Class.create;$.Toast.prototype={id:null,container:null,toast:null,options:{},initialize:function(html,options){var self=this;this.id=$.randomChar();this.options=$.extend(this.options,options);this.toastOpacity=$({tag:"div",className:"toast-opacity-"+this.id,style:$.STYLE_BODY+"position:relative;z-index:9000;width:"+this.options.width+"px;height:"+this.options.height+"px;margin-left:"+($(window).width()-this.options.width)/2+"px;margin-top:"+($(window).scrollTop()+($(window).height()-this.options.height-100)/2)+"px;background-color:#000;opacity:0.5;border-radius:5px;font-size:16px;color:white;text-align:center;line-height:"+this.options.height+"px"});this.toast=$({tag:"div",className:"toast-"+this.id,style:$.STYLE_BODY+"position:relative;z-index:10000;width:"+this.options.width+"px;height:"+this.options.height+"px;margin-left:"+($(window).width()-this.options.width)/2+"px;margin-top:"+-this.options.height+"px;background-color:none;border-radius:5px;font-size:16px;color:white;text-align:center;line-height:"+this.options.height+"px"});this.toast.html(html);this._create();this._funcResize=function(){self.resize()};this._funRemove=function(){self.remove()};$(window).addEvent("resize",this._funcResize)},_create:function(){this.toastOpacity.appendTo(document.body);this.toast.appendTo(document.body)},change:function(html){$(".toast-"+this.id).html(html)},resize:function(){var width=$(window).width();var height=$(window).height();var left=(width-this.options.width)/2>0?(width-this.options.width)/2:0;var top=(height-this.options.height-100)/2>0?$(window).scrollTop()+(height-this.options.height-100)/2:$(window).scrollTop();$(".toast-opacity-"+this.id).css({"margin-left":left+"px","margin-top":top+"px","max-width":width+"px","max-height":height+"px"});$(".toast-"+this.id).css({"margin-left":left+"px","margin-top":-this.options.height+"px","max-width":width+"px","max-height":height+"px"})},remove:function(){$(".toast-opacity-"+this.id).remove();$(".toast-"+this.id).remove()}};$.GifTimer=$.Class.create();$.GifTimer.prototype={id:null,inter:null,timeout:null,options:{inTimeFunc:null,outTimeFunc:null,doTime:null,allTime:null},initialize:function(options){var self=this;this.options=$.extend(this.options,options);this.inter=setInterval(function(){self.options.inTimeFunc.call(self)},this.options.doTime);this.timeout=setTimeout(function(){clearInterval(self.inter);self.options.outTimeFunc.call(self)},this.options.allTime)},remove:function(){$.Log("giftimer remove");clearInterval(this.inter);clearTimeout(this.timeout);this.inter=null;this.timeout=null}};$.Music=$.Class.create();$.Music.prototype={msgid:null,url:null,type:null,duration:null,audioFlag:true,musicEl:null,viewCallback:null,eventCallback:null,container:null,debugStr:"[nTalk Music]: ",initialize:function(msgid,url,type,duration,viewCallback,eventCallback,container){this.msgid=msgid;this.url=url;this.type=type;this.duration=duration;this.viewCallback=viewCallback;this.eventCallback=eventCallback;this.container=container;this.audioFlag=this.canPlayAudioMP3();if(this.audioFlag){this.createAudioPlayer()}else{this.createSwfPlayer()}this.viewCallback.call(this,"init");this.eventCallback.call(this,"init")},createAudioPlayer:function(){var self=this;this.musicEl=document.createElement("audio");this.musicEl.src=this.url;this.musicEl.type=this.type;this.musicEl.stop=function(){this.pause();this.currentTime=0};$.Event.addEvent(this.musicEl,"ended",function(){$.Log(self.debugStr+" trigger ended stop mp3");self.viewCallback.call(self,"stop")});this.musicEl.getPaused=function(){return this.paused}},createSwfPlayer:function(){var self=this;var musicId="ntalker_swf_mp3Player_container_"+this.msgid;var id="ntalker_swf_mp3player_"+this.msgid;var swf=$.sourceURI+"fs/music.swf";var html=$.flashHtml(id,swf,"id="+id);this.musicEl=document.createElement("div");this.musicEl.innerHTML+=html;this.musicEl.id=musicId;this.container.append(this.musicEl.outerHTML);var flashEl=$.browser.msie&&$.browser.ieversion<=7?window[id]:document[id];setTimeout(function(){flashEl.emit("load",self.url);flashEl.emit("stop");self.musicEl.play=function(){flashEl.emit("play")};self.musicEl.stop=function(){flashEl.emit("stop")};self.musicEl.getPaused=function(){return flashEl.getPaused()===0}},1e3)},emit:function(){if(this.musicEl.getPaused()){this.play()}else{this.stop()}},play:function(){$.Log(this.debugStr+"play mp3");this.musicEl.play();this.viewCallback.call(this,"play")},stop:function(){$.Log(this.debugStr+"stop mp3");this.musicEl.stop();this.viewCallback.call(this,"stop")},canPlayAudioMP3:function(){try{var a=document.createElement("audio");return!!(a.canPlayType&&a.canPlayType("audio/mpeg;").replace(/no/,""))}catch(e){return false}}};$.paste=$.Class.create();$.paste.prototype={data:null,callback:null,debugStr:"[nTalk pasteDate]: ",initialize:function(pasteEvent,callback){this.data=pasteEvent.clipboardData||window.clipboardData;this.callback=callback},getImgBase64Str:function(){var self=this,data=this.data;if(!data){return null}if(typeof webInfoChanged=="function"){this.callback(data.getData("image/x-vnd.adobe.air.bitmap").toDataURL())}else if($.browser.chrome||$.browser.opera){var item,types,items=data.items;if(items){item=items[0];types=data.types||[];for(var i=0,l=types.length;i<l;i++){if(types[i]==="Files"){item=items[i];break}}if(item&&item.kind==="file"&&item.type.match(/^image\//i)){var blob=item.getAsFile(),reader=new FileReader;reader.onload=function(e){self.callback(e.target.result)};reader.readAsDataURL(blob)}else{this.callback()}}}else{this.callback()}}}})(nTalk);
/* @file base.js
 * @date 2018.07.17 15:05:20 
 */
(function($,undefined){var CON_NOIM=["kf_9933","kf_9923","kf_9954","kf_10111"],CON_N2ID=["kf_9933","kf_9949","kf_9954"],CON_FLASH_DIV="nt-flash-div",CON_NT_ID="ntkf_flash_ntid",CON_STATICTIS=2,CON_FLASHSERVER={trailserver:"",presenceserver:"",presencegoserver:"",crmcenter:"",mcenter:"",coopserver:"",roboturl:"",t2dstatus:"",isnoim:0,notrail:0,preload:2e3,sessioncarry:"1",enable_entrance:"0",enable_invite:"0",close_tchat_flash:"1",close_im_flash:"0",robot:"0",siteid:""},emptyFunc=function(){},rSiteidExp=/[a-z]{2}\_\d+/gi;if(!$.baseURI||$.base){return}$.extend({CON_LOAD_MODE_NID:1,CON_CUSTOMER_ID:0,CON_GROUP_ID:1,CON_VISITOR_ID:2,CON_SHORT_ID:3,mobileOpenInChat:parseInt($.flashserver.reversechat,10)||parseInt($.flashserver.eduautochat,10),isEdu:parseInt($.flashserver.reversechat,10),isAutoEdu:parseInt($.flashserver.eduautochat,10),downtserver:CON_SERVER.flashserver,autoEduShow:false});$.base={_startBase:false,_identityIDReady:false,_connectTimeID:null,chatLoading:false,clearChatCache:false,timeOut:2e3,entityList:{"<":"&lt;",">":"&gt;"},fieldList:["shortid","uid","uname","isvip","userlevel","itemid","itemparam","erpparam","exparams"],CON_LOCAL_FIX:"NOWAIT_",call_trail_status:false,userIdFix:"",_reload_trail:false,identityInfoJson:{},useSdkData:false,_get_page_data:null,config:null,_islogin:true,start:function(){var self=this;if(!$.server){$.Log("Loaded $server mode failed",3);return}$.Log("nTalk.base.start()",1);if(!$.cookie.enable()){$.Log("Does not support cookies!",3)}$.global.pageinchat=true;$.global.statictis=CON_STATICTIS;$.source=$.url;this._identityIDReady=false;if(this._startBase){return}this.pageid=$.getTime();this._startBase=true;this._loadFlashServer();if($.isEmptyObject(CON_RULE)){this.getPageData();this._loadIdentityID(function(uid,pcid){$.Log("PCID:"+pcid,1);self.startOtherMode(uid,pcid)})}else{this.startData(function(){this._loadIdentityID(function(uid,pcid){$.Log("PCID:"+pcid,1);self.startOtherMode(uid,pcid)})})}},chanageUserID:function(){if(typeof NTKF_PARAM=="undefined"){return false}else if(NTKF_PARAM.uid&&this.toLongID(NTKF_PARAM.uid)&&this.toLongID(NTKF_PARAM.uid)!=$.user.id){if($.inArray($.global.siteid,CON_N2ID)>-1&&$.global.siteid+"_ISME9754_"+NTKF_PARAM.uname==$.user.id){return false}return true}else{return false}},overloadedData:function(uData,callback){if($.isFunction(uData)){callback=uData;uData=null}$.Log("nTalk.base.overloadedData()");if($.isEmptyObject(CON_RULE)){this.getPageData(uData);$.user.id=$.global.uid||$.user.id;$.user.name=$.global.uname||"";$.cache.set("uid",$.user.id);if($.isFunction(callback))callback();$.base.startTrail($.base._islogin,true);if($.flashserver.usexpush&&$.xpush){$.xpush.init()}}else{this.startData(function(){$.user.id=$.global.uid||$.user.id;$.user.name=$.global.uname||"";$.cache.set("uid",$.user.id);if($.isFunction(callback))callback();$.base.startTrail($.base._islogin,true);if($.flashserver.usexpush&&$.xpush){$.xpush.init()}},uData)}},startData:function(callback,uData){var self=this;$.Log("nTalk.base.startData()");$.require({data:"data.js"+$.baseExt},function(data){if(!data){$.Log("Loaded $data mode failed",3);return}var pData=$.data.start(CON_RULE);self._get_page_data=$.extend({},pData,uData);self.getPageData(self._get_page_data);callback.call(self)})},_execMode:function(){var self=this;this._startBase=true;this._loadFlashServer()},startTrail:function(isLogin,isUpdate,uid){var self=this;$.require({trail:"trail.js"+$.baseExt},function(trail){if(!trail){$.Log("Loaded $trail mode failed",3);return}var callback=function(){};if(uid){callback=function(){self.trailGetRegion(uid)}}$.trail.start(isLogin,isUpdate,self.useSdkData,callback)})},startXPush:function(){var scriptList={};if($.xpush&&$.xpush.connect){return}scriptList.XPUSH="xpush.js"+$.baseExt;if($.browser.supportMqtt){scriptList.MQTT="mqtt31.js"+$.baseExt}$.require(scriptList,function(){$.xpush.init()})},startIM:function(){var scriptList={};if($.im&&$.im.connect){return}scriptList.IM="im.js"+$.baseExt;if($.browser.supportMqtt&&$.server.eduimmqttserver&&$.server.tchatConnectType==1){scriptList.MQTT="mqtt31.js"+$.baseExt}else if($.flash.support&&$.server.eduimmqttserver&&$.server.tchatConnectType==1){scriptList.MQTT="flashsock.js"+$.baseExt}scriptList.Connection="mqtt.im.js"+$.baseExt;$.require(scriptList,function(){$.im.start()})},startLCrm:function(data,retry,cache){var receiveData=data&&$.isArray(data)?data:[data];$.require({lcrm:"lcrm.js"+$.baseExt},function(lcrm){$.each(receiveData,function(index,data){$.Log("start lcrm mode",1);$.lcrm.start(data,retry,cache)})})},startChat:function(settingid,destid,itemid,itemparam,sellerid,noWaitConnect,single,manual,edu_inviteid,edu_visitid){var scriptList;settingid=settingid||"";destid=destid||"";itemid=itemid||"";itemparam=itemparam||"";sellerid=sellerid||"";edu_inviteid=edu_inviteid||"";edu_visitid=edu_visitid||"";if($.im){$.im.hideTips()}if($.base.chatLoading===true){$.Log("loading......",2);return}$.Log("$.base.startChat("+$.JSON.toJSONString(arguments)+")",1);$.base.showLoading();scriptList={lang:($.extParmas.lan||"zh_cn")+".js"+$.baseExt};if($.browser.supportMqtt&&$.server.tchatmqttserver&&$.server.tchatConnectType==1){scriptList.MQTT="mqtt31.js"+$.baseExt;scriptList.Connection="mqtt.chat.js"+$.baseExt}else if($.flash.support&&$.server.tchatmqttserver&&$.server.tchatConnectType==1){scriptList.MQTT="flashsock.js"+$.baseExt;scriptList.Connection="mqtt.chat.js"+$.baseExt}else{scriptList.TChat="comet.chat.js"+$.baseExt}if($.global.themes){scriptList.chatManage="chat.js"+$.baseExt;scriptList.chatManageView=$.global.themes+"/chat.view.in.js"+$.baseExt;$.themesURI=$.global.themes+"/images/"}else if($.mobileOpenInChat&&$.browser.mobile){scriptList.chatManage="chat.js"+$.baseExt}else{scriptList.chatManage="chat.in.js"+$.baseExt}scriptList.Window="nt2.js"+$.baseExt;if($.server.robot==1){scriptList.Robot="robot.js"+$.baseExt}$.require(scriptList,function(){$.base.hiddenLoading();if(!$.chatManage){$.Log("Load $chatManage mode failed",3);return}else{$.Log("load $chatManage mode complete")}if($.chatManage.open(settingid,destid,itemid,itemparam,sellerid,noWaitConnect,single,manual,edu_inviteid,edu_visitid)){if(!edu_inviteid){$.cache.set("opd",1)}}})},startEntrance:function(){var entranceFile=$.server.entranceConfig[$.global.settingid]||"";$.Log("$.base.startEntrance()");if(!entranceFile||!$.server.entranceConfig||$.isEmptyObject($.server.entranceConfig)){return}$.require({entrance:entranceFile+$.baseExt},function(entrance){if(!entrance){$.Log("Load $.entrance mode failed",3);return}if($.server.enable_entrance!="0"&&$.options.entrance){$.entrance.start("entrance")}if($.server.enable_entrance!="0"&&$.options.invite){$.entrance.start("invite")}})},showLoading:function(){$.base.chatLoading=true;$.base.startTime=$.getTime();if(!this.loadingElement||!this.loadingElement.length){this.loadingElement=$({id:"ntalk-chat-loading",style:$.STYLE_NBODY+"width:100%;height:33px;position:fixed:right:0;bottom:0;z-index:9999;"}).appendTo(true).fixed({right:0,bottom:0}).html('<div style="'+$.STYLE_BODY+"margin:0 auto;width:99px;height:33px;background:url("+$.imageloading+') no-repeat 0 0;"></div>')}else{this.loadingElement.display(1)}return this.loadingElement},hiddenLoading:function(){this.loadingElement.display();$.base.endTime=$.getTime();$.base.chatLoading=false;$.Log("$.base.showLoading-hiddenLoading execute time:"+($.base.endTime-$.base.startTime)+" ms",1)},toLongID:function(id){if(id.length>47){id=id.substr(0,47)}var verify=this.checkID(id);if(verify===$.CON_SHORT_ID){return $.global.siteid+"_ISME9754_"+id}else if(verify==$.CON_VISITOR_ID){return id}else{return""}},toShortID:function(id){var verify=this.checkID(id);if(verify===$.CON_SHORT_ID){return id}else if(verify===$.CON_VISITOR_ID){return id.replace(this.userIdFix,"")}else{return""}},checkID:function(id){id=id?id.toString():"";if(!id||id==="0"){return false}else if(id.indexOf("_ISME9754_T2D")>-1){return $.CON_CUSTOMER_ID}else if(id.indexOf("_ISME9754_GT2D")>-1){return $.CON_GROUP_ID}else if(id.indexOf($.global.siteid+"_ISME9754_")>-1){return $.CON_VISITOR_ID}else{return $.CON_SHORT_ID}},trailGetRegion:function(uid){var url,callBackName,trailGetNews;$.global.trailGetRegion=new Object;$.global.trailGetRegion.success=false;$.global.trailGetRegion.ip="";$.global.trailGetRegion.country="";$.global.trailGetRegion.province="";$.global.trailGetRegion.city="";callBackName="trail_getregion_"+$.randomChar();url=$.protocolFilter($.flashserver.trailserver)+"/userinfo.php?action=getregion&";trailGetNews=$.toURI({siteid:$.global.siteid,userid:uid,callback:callBackName});window[callBackName]=function(result){if(result.success==true){$.global.trailGetRegion.success=true;$.global.trailGetRegion.ip=result.data.ip;$.global.trailGetRegion.country=result.data.country;$.global.trailGetRegion.province=result.data.province;$.global.trailGetRegion.city=result.data.city}};$.require(url+trailGetNews)},startOtherMode:function(uid,pcid){var cacheUID=$.cache.get("uid")||"",options,carry;clearTimeout(this._connectTimeID);this._connectTimeID=null;this._identityIDReady=true;$.Log("cache uid:"+cacheUID+", site uid:"+uid+", return uid:"+uid,1);if(!cacheUID){this._islogin=true}else{this._islogin=cacheUID!=uid}$.global.pcid=pcid;$.user.id=uid;if($.isDefined($.global.uname)){$.user.name=$.global.uname}$.cache.set("uid",uid);$.cookie.set($.CON_PCID_KEY,pcid,1e3*3600*24*365*2);if($.server.notrail===0){this.startTrail(this._islogin,false,uid)}else{$.Log("no load trail");this.trailGetRegion(uid)}if($.server.entranceConfig&&($.server.enable_entrance!="0"||$.server.enable_invite=="1")){if($.server.enable_entrance=="2"&&$.browser.mobile){return}this.startEntrance()}if($.server.usexpush==1){this.startXPush()}else{if(!$.server.isnoim||$.server.isnoim==3||$.server.isnoim==2&&$.cache.get("opd")=="1"){$.Log("nTalk.base.startIM()::"+$.im,1);this.startIM()}else{$.Log("no load im, isnoim:"+$.server.isnoim+", opd:"+$.cache.get("opd"),1)}}if($.browser.mobile==1){var css=[".full-html,.full-body{","width: 100% !important;","height: 100% !important;","margin: 0 !important;","overflow: hidden !important;","}",".full-body *{","display: none !important;","}",".full-iframe {","display: block !important;","}",".full-inpage {","width: 100% !important;","height: 100% !important;","margin: 0 !important;","overflow: hidden !important;","background: rgb(243, 243, 247) !important;","-webkit-tap-highlight-color: rgba(0, 0, 0, 0);","}",".full-inpage > *:not(.ntalk-mobile-inpage-background) {","display: none !important;","}"].join("");$.addMobileStyle(css)}carry=window.localStorage.carry_dest?$.JSON.parseJSON(window.localStorage.carry_dest):"";if($.server.sessioncarry!="0"&&carry&&!$.browser.mobile){$.Log("sessioncarry:"+$.JSON.toJSONString(carry));window.localStorage.carry_dest="";if(carry){for(k in carry){if(k){if(k.indexOf("ISME9754")>-1){return}if($.browser.mobile||!$.global.pageinchat){options={single:-1};$.im_openOutPageChat(k,"",carry[k],options,"")}else{options={autoconnect:true,single:-1};$.im_openInPageChat(k,"",carry[k],options,"")}}}}}else if($.server.preload>0&&!$.global.themes){this.preloadChat()}},preloadChat:function(){var scriptList;$.Log("$.base.preloadChat()",1);setTimeout(function(){if($.base.chatLoading===true){return}scriptList={lang:($.extParmas.lan||"zh_cn")+".js"+$.baseExt};if($.global.themes){scriptList.chatManage="chat.js"+$.baseExt;scriptList.chatManageView=$.global.themes+"/chat.view.in.js"+$.baseExt;$.themesURI=$.global.themes+"/images/"}else if($.mobileOpenInChat&&$.browser.mobile){scriptList.chatManage="chat.js"+$.baseExt}else{scriptList.chatManage="chat.in.js"+$.baseExt}scriptList.Window="nt2.js"+$.baseExt;if($.browser.supportMqtt&&$.server.tchatmqttserver&&$.server.tchatConnectType==1){scriptList.MQTT="mqtt31.js"+$.baseExt;scriptList.Connection="mqtt.chat.js"+$.baseExt}else if($.flash.support&&$.server.tchatConnectType==1){scriptList.MQTT="flashsock.js"+$.baseExt;scriptList.Connection="mqtt.chat.js"+$.baseExt}else{scriptList.TChat="comet.chat.js"+$.baseExt}if($.server.robot==1){scriptList.Robot="robot.js"+$.baseExt}$.require(scriptList,function(lang,chatManage){if(!chatManage){$.Log("preload $chatManage mode failed",3)}else{$.Log("preload $chatManage mode complete")}})},$.server.preload)},getPageData:function(pageData){var data;$.Log("nTalk.base.getPageData()");data=$.extend({},typeof NTKF_PARAM!=="undefined"?NTKF_PARAM:{},pageData);$.whereGetTo($.global,data,["siteid","sellerid","settingid","uid","uname","exparams","themes","callbacks","backURL","usertag","userrank","sourceid","sourcename","keyid","keyword","country","province","city","hmparams","pageTitle","isvip","userlevel","itemid","itemparam","orderid","orderprice","erpparam","ntalkerparam","pagetype","title","lang","iconid"],[null,null,null,"shortid","uname","exparams","themes","callbacks","backURL","usertag","userrank","sourceid","sourcename","keyid","keyword","country","province","city","hmparams","pageTitle"]);$.global.siteid=($.global.siteid+"").replace(/^\s+|\s+$/,"");$.global.settingid=($.global.settingid+"").replace(/^\s+|\s+$/,"");$.global.siteid=$.global.siteid&&rSiteidExp.test($.global.siteid)?$.global.siteid:$.extParmas.siteid||"";if($.global.siteid===""){return false}$.global.pagetype=$.params.source||"";$.global.sellerid=$.isArray($.global.sellerid)?$.global.sellerid:$.global.sellerid.toString().indexOf(",")>-1?$.global.sellerid.split(","):$.global.sellerid?[$.global.sellerid]:[];$.global.orderid=$.isArray($.global.orderid)?$.global.orderid:$.global.orderid.toString().indexOf(",")>-1?$.global.orderid.split(","):$.global.orderid?[$.global.orderid]:[];$.global.orderprice=$.isArray($.global.orderprice)?$.global.orderprice:$.global.orderprice.toString().indexOf(",")>-1?$.global.orderprice.split(","):$.global.orderprice?[$.global.orderprice]:[];if($.inArray($.global.siteid,CON_N2ID)>-1){$.global.shortid=$.global.uname||""}if(!$.global.itemid&&$.global.ntalkerparam){if(!$.isObject($.global.ntalkerparam)){$.Log("ntalkerparam param abnormal",2)}if($.global.ntalkerparam.item){$.global.itemid=$.global.ntalkerparam.item.id}}if(!/number|string/i.test(typeof $.global.shortid)||!/string/i.test(typeof $.global.uname)){$.Log("userid or username type error");$.global.shortid="";$.global.uname=""}$.referrer=$.enCut($.referrer,255);$.global.settingid=$.global.settingid&&/[a-z]{2}\_\d+\_\d+/gi.test($.global.settingid)?$.global.settingid:"";$.global.iconid=$.isNumeric($.global.iconid)?$.global.iconid:0;$.global.title=$.enCut($.title,255);$.global.shortid=!$.global.shortid||$.global.shortid=="0"?"":$.enCut($.global.shortid,64-$.enLength($.global.siteid)-10);$.global.uname=!$.global.shortid||$.global.shortid=="0"||/^(undefined|null|0)$/gi.test($.global.uname)?"":$.global.uname?$.enCut($.global.uname,32):$.enCut($.global.shortid,32);$.global.uid=this.toLongID($.global.shortid);$.global.isvip=$.isNumeric($.global.isvip)?$.global.isvip:$.isNumeric($.global.userlevel)?$.global.userlevel:0;$.global.userlevel=$.isNumeric($.global.userlevel)?$.global.userlevel:0;if($.global.pageTitle){$.global.title=$.global.pageTitle+"_"+$.global.title}if($.inArray($.global.siteid,CON_N2ID)>-1){$.global.shortid=$.global.uname||""}$.global=this.filterJSONChar($.global,"");this.changeDataFormat();$.Log("global: "+$.JSON.toJSONString($.global),1);return $.global},changeDataFormat:function(){var arr=$.global.callbacks,val={};if(!$.isArray(arr)||arr.length===0){$.global.callbacks=val;return}for(var i=0;i<arr.length;i++){if(!$.isArray(arr[i])||arr[i].length<2||!$.isFunction(arr[i][1])){continue}val[arr[i][0]]=arr[i][1]}$.global.callbacks=val},_filterChar:function(str,clear){var res=[],reg,tmp;if(clear)$.each(this.entityList,function(name,value){try{reg=new RegExp(name,"gi");str=str.replace(reg,value)}catch(e){}});for(var i=0,len=str.length;i<len;i++){try{tmp=encodeURIComponent(str.charAt(i));res.push(str.charAt(i))}catch(e){try{tmp=encodeURIComponent(str.charAt(i)+str.charAt(i+1));res.push((!res.length?"":" ")+tmp.replace(/%/gi,"")+(i+2>=len?"":" "));++i}catch(e){res.push(str.charAt(i))}}}return res.join("")},filterJSONChar:function(data,key){var result,self=this;if($.isObject(data)){result={};$.each(data,function(k,item){result[k]=self.filterJSONChar(item,k)})}else if($.isArray(data)){result=[];for(var i=0;i<data.length;i++){result[i]=this.filterJSONChar(data[i],i)}}else if(typeof data=="string"){result=this._filterChar(data,$.inArray(key,this.fieldList)!==-1)}else{result=data}return result},_loadIdentityID:function(callback){var self=this,uid,diff,pcid="";var appPushUserInfo=function(uid,pcid){if(typeof ntalker!=="undefined"&&ntalker.pushUserInfo&&!identityInfoJson.pcid){if(PushUserInfoTimeout){clearTimeout(PushUserInfoTimeout)}var PushUserInfoTimeout=setTimeout(ntalker.pushUserInfo({pcid:pcid,uid:uid,shortid:$.global.shortid,uname:$.global.uname}),200)}};if(typeof ntalker!=="undefined"){try{$.Log("get sdk pcid");this.identityInfoJson=$.JSON.parseJSON(ntalker.getIdentityInfo());if(this.identityInfoJson){pcid=this.identityInfoJson.pcid;$.global.trailid=this.identityInfoJson.tid;$.global.uid=this.identityInfoJson.uid;$.user.id=this.identityInfoJson.uid;$.global.shortid=this.identityInfoJson.shortid;this.useSdkData=true}}catch(e){$.Log("get sdk pcid");if(ntalker.getIdentityID&&typeof ntalker.getIdentityID==="function"){pcid=ntalker.getIdentityID()}}}$.Log("ntalker type : "+typeof ntalker);if(pcid===""){pcid=$.cookie.get($.CON_PCID_KEY)}if(!(this.useSdkData&&$.global.trailid)){$.global.trailid=$.cache.get("tid")}this.userIdFix=$.global.siteid+"_ISME9754_";if($.global.trailid&&!this.useSdkData){diff=Math.round(($.getTime()-+$.global.trailid.toString().substr(0,13))/36e5);if(diff>=4){$.global.trailid=""}}if(!$.global.trailid||$.url.indexOf("livecrmtest")>-1){$.global.trailid=$.getTime(2);$.base.clearChatCache=true;if($.flashData){$.flashData.clearAll()}}if(pcid&&pcid.length>10){if($.global.uid&&$.global.uid.indexOf($.global.siteid)>-1){uid=$.global.uid}else{uid=this.userIdFix+pcid.substr(0,21)}$.Log("load PCID:"+pcid+", uid:"+uid);callback.call(this,uid,pcid);if(!this.useSdkData){appPushUserInfo(uid,pcid)}}else{if($.flash.support&&!$.browser.mobile){this._createNTID({u:$.global.uid,siteid:$.global.siteid,loadnid:$.CON_LOAD_MODE_NID});pcid=this._createScriptPCID(true);$.Log("create flash PCID, tmp pcid:"+pcid);uid=$.global.uid||this.userIdFix+pcid.substr(0,21);$.global.pcid=pcid;$.user.id=uid;this._connectTimeID=setTimeout(function(){$.global.connect=$.CON_CONNECT_COMET;$.Log("timeout:"+self.timeOut+" no create pcid",2);callback.call(self,uid,pcid);appPushUserInfo(uid,pcid)},this.timeOut)}else{if($.cookie.enable()){pcid=this._createScriptPCID(false);$.Log("create script PCID");uid=$.global.uid||this.userIdFix+pcid.substr(0,21);callback.call(this,uid,pcid);appPushUserInfo(uid,pcid)}else{$.require({Fingerprint2:"fingerprint2.js"+$.baseExt},function(Fingerprint2){if(!$.Fingerprint2){$.Log("load Fingerprint2 failure");return}fingerprint2=new $.Fingerprint2;fingerprint2.get(function(id){pcid="guest-Fin"+id;uid=$.global.uid||self.userIdFix+pcid.substr(0,21);callback(uid,pcid);appPushUserInfo(uid,pcid)})})}}}if($.isAutoEdu){$.require({auto:"auto.js"+$.baseExt},function(){})}},_createNTID:function(flashvars){var flashdiv=$("#"+CON_FLASH_DIV),flashhtml=$.flashHtml(CON_NT_ID,$.sourceURI+"fs/NTID.swf?"+$.version.ntid,flashvars);if(!flashdiv.length){flashdiv=$(document.body).insert('<div id="'+CON_FLASH_DIV+'" style="position: absolute; z-index: 9996; top: -200px;"></div>')}flashdiv.insert(flashhtml)},_createScriptPCID:function(isTemp){return"guest"+[isTemp?"TEMP"+$.randomChar(4):$.randomChar(8),$.randomChar(4),$.randomChar(4),$.randomChar(4),$.getTime().toString(16).toUpperCase().substr(-8)+$.randomChar(4)].join("-")},_loadFlashServer:function(){$.Log("start load flashserver.");$.require({flashserver:$.server.flashserver+"/func/getflashserver.php?"+$.toURI({resulttype:1,siteid:$.global.siteid,callbackname:"nTalk._callFlashServer"})+"#rnd"},function(flashserver){flashserver=$.extend({},CON_FLASHSERVER,flashserver);$.server=$.protocolFilter($.extend($.server,flashserver))})},fire:function(eventName,args){if(!$.global.callbacks[eventName]){return true}return $.global.callbacks[eventName].apply(this,args)}};$.extend({_callFlashServer:function(data,resultType){$.flashserver=data;$.server=$.protocolFilter($.extend($.server,$.flashserver));$.Log("$flashserver loading is complete. resultType:"+resultType)},fIM_presenceFlashReady:function(uid,pcid){setTimeout(function(){if(!$.base._identityIDReady){$.Log(">RETURN flash PCID, uid:"+uid+", pcid:"+pcid,1);if(uid&&pcid){$.base.startOtherMode(uid,pcid)}}else{$.Log("$.fIM_presenceFlashReady()");if(!$.Event.fireEvent(document,"focus")){$.Event.fireEvent(document,"click")}if($.im&&$.im.connect){$.im.connect.stopSwitchConnect()}}},0);return true},isJsReady:function(){return true},_createMobileOpenInPageWindow:function(edu_inviteid){var chatElement=$(".ntalk-mobile-inpage-window");if(!chatElement.length){var times=1;chatElementBack=$({tag:"div",className:"ntalk-mobile-inpage-background",style:"background:rgba(0,0,0,0.3);width:100%;height:100%;position:absolute;left:0;top:0px;-webkit-overflow-scrolling: touch;overflow:hidden;z-index:1000000000000000;display:none;-webkit-tap-highlight-color:rgba(0, 0, 0, 0);"}).appendTo(true);chatElement=$({className:"ntalk-mobile-inpage-window","data-status":"visible",style:$.STYLE_BODY+"background:#fff;width:100%;height:100%;position:fixed;left:0;bottom:0px;-webkit-overflow-scrolling: touch;overflow:hidden;z-index:1000000000000000;display:block;"}).appendTo(chatElementBack);chatElement.bind("touchmove",function(event){$.Event.fixEvent(event).stopPropagation()});if($.browser.micromessenger||$.browser.weibo){times=1}chatElement.css({width:"100%",height:100*times+"%"});if(chatElement.attr("data-status")=="hidden"){chatElement.css("top",100*times+"%")}else{chatElement.css("bottom","0px")}$(window).bind("resize",function(){var times=1;if($.browser.micromessenger||$.browser.weibo){times=1}chatElement.css({width:"100%",height:100*times+"%"});if(chatElement.attr("data-status")=="hidden"){chatElement.css("height",100*times+"%")}else{chatElement.css("bottom","0px")}});if(!edu_inviteid){$._showMobileInPageWindow()}chatElementBack.bind("click",function(){$._hideMobileInPageWindow()});chatElement.bind("click",function(){$.Event.fixEvent(event).stopPropagation()});return{created:true,element:chatElement}}else{if(!edu_inviteid){$._showMobileInPageWindow()}return{created:false,element:chatElement}}},_createMobileIframeWindow:function(name){var chatElement=$(".ntalk-mobile-iframe-window"),iframeElement=$("IFRAME[name="+name+"]"),mChatWindow;if(!chatElement.length){chatElement=$({className:"ntalk-mobile-iframe-window","data-status":"visible",style:$.STYLE_BODY+"background:#fff;width:100% !important;height:100% !important;position:fixed;left:0;top:0px;-webkit-overflow-scrolling: touch;overflow-y:scroll"}).appendTo(true);iframeElement=$({tag:"IFRAME",name:name,style:$.STYLE_BODY+"width:100% !important;height:100% !important;display:block !important;",src:"about:blank"}).appendTo(".ntalk-mobile-iframe-window");$(window).bind("resize",function(){$(iframeElement).css({width:"100%",height:$(window).height()+"px"});if(chatElement.attr("data-status")=="hidden"){chatElement.css("top",$(window).height()+"px")}else{chatElement.css("top","0px")}});mChatWindow=iframeElement[0].contentWindow;$.listenerMessage(function(data){$.Log("listenerMessage:"+data);var funcName;try{data=$.JSON.parseJSON(data);funcName=data.funcName}catch(e){funcName=data}switch(funcName){case"showMobileIframeWindow":$._showMobileIframeWindow(chatElement);break;case"hideMobileIframeWindow":$._hideMobileIframeWindow(chatElement,false);break;case"closeMobileIframeWindow":if($.viewPortContent){document.getElementsByTagName("meta")[name="viewport"].setAttribute("content",$.viewPortContent)}$._hideMobileIframeWindow(chatElement,true);break;case"closeMobileIframeWindowCallbacks":if($.viewPortContent){document.getElementsByTagName("meta")[name="viewport"].setAttribute("content",$.viewPortContent)}$.base.fire("WapClose",[]);case"backMobileIframeWindowCallBacks":$.base.fire("WapBack",[])}if(data&&$.isArray(data)&&data.indexOf("destInfo")>-1&&typeof im_destUserInfo=="function"&&data.split(",").length==3){var destId=data.split(",")[1];var destName=data.split(",")[2];im_destUserInfo({id:destId,name:destName})}});return{created:true,element:chatElement}}else{return{created:false,element:chatElement}}$.global.openInPagechat=true},_showMobileIframeWindow:function(chatElement){if(!(nTalk.isObject(chatElement)&&chatElement.talkVersion)){return}$("html").addClass("full-html");$("body").addClass("full-body");chatElement.addClass("full-iframe");chatElement.css("z-index","999999999");if($.browser.mobile){if($("meta[name=viewport]").length==0){$({tag:"meta",id:"nTalk-window-meta",name:"viewport",content:"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"}).appendTo($("head"))}}},_hideMobileIframeWindow:function(chatElement,closeIframeWindow){if(!(nTalk.isObject(chatElement)&&chatElement.talkVersion)){return chatElement}$("html").removeClass("full-html");$("body").removeClass("full-body");chatElement.removeClass("full-iframe");chatElement.css({"z-index":-1,display:"none"});if($.browser.mobile){$("#nTalk-window-meta").remove()}if(closeIframeWindow){chatElement.remove();$.removelistenerMessage()}},addMobileStyle:function(css){var head=document.head||document.getElementsByTagName("head")[0],style=document.createElement("style");style.type="text/css";if(style.styleSheet){style.styleSheet.cssText=css}else{style.appendChild(document.createTextNode(css))}head.appendChild(style)}});$.extend({im_openInPageChat:function(settingId,itemId,destId,options,itemparam){var gSellerid,cSellerid,args,sellerId;if(!$.base._startBase){$.base.start();(function(){args=arguments;if($.base._startBase){$.im_openInPageChat(settingId,itemId,destId,options,itemparam)}else{setTimeout(function(){args.callee()},50)}})();return}if($.base.chanageUserID()){$.base.overloadedData(function(){$.im_openInPageChat(settingId,itemId,destId,options,itemparam)});return}if($.invite){$.invite._close()}$.Log("nTalk.im_openInPageChat()",1);if(!settingId&&destId){settingId=""}else{settingId=settingId||$.global.settingid||""}gSellerid=$.global.settingid?$.global.settingid.split("_").splice(0,2).join("_"):"";cSellerid=settingId?settingId.split("_").splice(0,2).join("_"):"";sellerId=$.global.sellerid&&$.global.sellerid.length?$.global.sellerid[0]:"";options=$.extend({},options);if(options.pageTitle){$.global.title=options.pageTitle+"_"+$.global.title}if(itemId){}else if(!cSellerid||cSellerid!==""&&(cSellerid==sellerId||cSellerid==gSellerid)){itemId=$.global.itemid;itemparam=$.global.itemparam}else{itemId="";itemparam=""}sellerId=cSellerid!=$.global.siteid?cSellerid:"";$.Log("settingId:"+settingId+", itemId:"+itemId+", itemparam:"+itemparam);if(($.browser.mobile||$.global.pageinchat!==true)&&!$.mobileOpenInChat){return this.im_openOutPageChat(settingId,itemId,destId,options,itemparam)}else{if($.server.notrail==2&&!$.base.call_trail_status){$.base.call_trail_status=true;$.base.startTrail()}var single=options&&options.single?options.single:"";var manual=options&&options.manual?1:0;var autoConnect=options&&$.isDefined(options.autoconnect)?options.autoconnect:false;var edu_inviteid=options&&options.edu_inviteid?options.edu_inviteid:"";var edu_visitid=options&&options.edu_visitid?options.edu_visitid:"";if($.browser.mobile&&$.mobileOpenInChat){this._createMobileOpenInPageWindow(edu_inviteid);if($.isAutoEdu&&$.autoEduShow&&$.autoEduShow!="complete"){this._hideMobileInPageWindow()}}$.base.startChat(settingId,destId,itemId,itemparam,sellerId,autoConnect,single,manual,edu_inviteid,edu_visitid)}},im_openOutPageChat:function(settingId,itemId,destId,options,itemparam){var gSellerid,cSellerid,args,sellerId;if(!$.base._startBase){$.base.start();(function(){args=arguments;if($.base._startBase){$.im_openInPageChat(settingId,itemId,destId,options,itemparam)}else{setTimeout(function(){args.callee()},50)}})();return}if($.base.chanageUserID()){$.base.overloadedData(function(){$.im_openInPageChat(settingId,itemId,destId,options,itemparam)});return}$.Log("nTalk.im_openOutPageChat()",1);settingId=settingId||$.global.settingid||"";gSellerid=$.global.settingid?$.global.settingid.split("_").splice(0,2).join("_"):"";cSellerid=settingId?settingId.split("_").splice(0,2).join("_"):"";sellerId=$.global.sellerid&&$.global.sellerid.length?$.global.sellerid[0]:"";options=$.extend({},options);if(itemId){}else if(!cSellerid||cSellerid!==""&&(cSellerid==sellerId||cSellerid==gSellerid)){itemId=$.global.itemid;itemparam=$.global.itemparam}else{itemId="";itemparam=""}sellerId=cSellerid!=$.global.siteid?cSellerid:"";$.Log("settingId:"+settingId+", itemId:"+itemId+", itemparam:"+itemparam);var objectResult,target=$.browser.mobile?"_self":"_blank",single=options&&options.single?options.single:"",manual=options&&options.manual?1:0,query={v:$.version.script,siteid:$.global.siteid,sellerid:sellerId,settingid:settingId,baseuri:$.baseURI,mobile:$.browser.mobile?1:0,lan:$.extParmas.lan||"",ref:$.enCut($.url,255),tit:$.global.title,iframechat:options.iframechat||"0",header:$.isDefined(options.header)?options.header:"1",edu_inviteid:options&&options.edu_inviteid?options.edu_inviteid:"",edu_visitid:options&&options.edu_visitid?options.edu_visitid:"",backURL:$.global.backURL,rnd:$.getTime()},post={uid:$.user.id,uname:$.user.name,pcid:$.global.pcid,vip:$.global.isvip,ulevel:$.global.userlevel,destid:destId||"",single:single?single:!destId?-1:destId.indexOf("GT2D")>-1?0:1,chattype:"",chatvalue:"",itemid:itemId,itemparam:itemparam,erpparam:$.global.erpparam,"ntalker-debug":$.params["ntalker-debug"]||$.cache.get("debug"),exparams:$.global.exparams,userrank:$.global.userrank,usertag:$.global.usertag};if(typeof ntalker!=="undefined"&&ntalker.openChatWindow){sdkQuery=$.extend({},query,post);sdkQuery.uid=$.base.toShortID(sdkQuery.uid);sdkQuery.flashserver=$.server.flashserver;$.Log("call ntalker.openChatWindow()",2);var result=ntalker.openChatWindow($.JSON.toJSONString(sdkQuery));$.Log("call ntalker.openChatWindow()>>"+result,3);if(result===0){return}else{$.Log("call ntalker.openChatWindow()>>"+result,3)}}if($.global.themes){query.themes=$.global.themes}if(options.iframechat){target="ntalk-mobile-chat";if($.browser.mobile&&$.chatViewport){$.chatViewport()}$.require({animate:"nt2.js"+$.baseExt},function(nt2){if(!$.animate){$.Log("Loaded $nt2 mode failed",3);return}objectResult=$._createMobileIframeWindow(target);if(!objectResult||objectResult&&objectResult.created===true){if($.xpush){$.xpush.clearSettingUnReadMsgCount(settingId)}$.objectPost=new $.POST($.server.flashserver+"chat.php?"+$.toURI(query,true,"&"),post,function(){$.Log("open chat window complete",1)},target)}$._showMobileIframeWindow(objectResult.element)});return null}if(!objectResult||objectResult&&objectResult.created===true){if($.xpush){$.xpush.clearSettingUnReadMsgCount(settingId)}$.objectPost=new $.POST($.server.flashserver+"chat.php?"+$.toURI(query,true,"&"),post,function(){$.Log("open chat window complete",1)},target)}return objectResult?objectResult.element:$.objectPost.iframeElement},im_getAppChatWindowURL:function(data,callback){var gSellerid,cSellerid,args,sellerId,destId,settingId,itemId,itemparam,options;if(!$.base._startBase){$.base.start();(function(){args=arguments;if($.base._startBase){$.im_getAppChatWindowURL(data,callback)}else{setTimeout(function(){args.callee()},50)}})();return}if($.base.chanageUserID()){$.base.overloadedData(function(){$.im_getAppChatWindowURL(data,callback)});return}$.Log("nTalk.im_getAppChatWindowURL()",1);if(typeof data=="function"){callback=data;data={}}else{data=$.extend({},data)}destId=data.destid||"";settingId=data.settingId||$.global.settingid||"";gSellerid=$.global.settingid?$.global.settingid.split("_").splice(0,2).join("_"):"";cSellerid=data.settingid?data.settingid.split("_").splice(0,2).join("_"):"";
sellerId=$.global.sellerid&&$.global.sellerid.length?$.global.sellerid[0]:"";options=$.extend({},data.options);if(data.itemid){itemId=data.itemid;itemparam=data.itemparam}else if(!cSellerid||cSellerid!==""&&(cSellerid===sellerId||cSellerid===gSellerid)){itemId=$.global.itemid;itemparam=$.global.itemparam}else{itemId="";itemparam=""}sellerId=cSellerid!=$.global.siteid?cSellerid:"";$.Log("settingId:"+settingId+", itemId:"+itemId+", itemparam:"+itemparam);var single=options&&options.single?options.single:"",manual=options&&options.manual?1:0,query={v:$.version.script,siteid:$.global.siteid,sellerid:sellerId,settingid:settingId,baseuri:$.baseURI,mobile:$.browser.mobile?1:0,lan:$.extParmas.lan||"",header:$.isDefined(options.header)?options.header:"1",uid:$.user.id,uname:$.user.name,pcid:$.global.pcid,vip:$.global.isvip,ulevel:$.global.userlevel,destid:destId||"",single:single?single:!destId?-1:destId.indexOf("GT2D")>-1?0:1,chattype:"",chatvalue:"",itemid:itemId,itemparam:itemparam,erpparam:$.global.erpparam,ref:$.enCut($.url,255),tit:$.global.title,"ntalker-debug":$.params["ntalker-debug"]||$.cache.get("debug")||"",exparams:$.global.exparams};if($.isFunction(callback)){callback.call(self,$.server.flashserver+"recieve.php?"+$.toURI(query,true,"&"))}},im_updatePageInfo:function(uData){$.base.overloadedData(uData)},im_addTrailInfo:function(title,url,uData){$.referrer=$.url;$.title=title||document.title;$.url=url||document.location.href;$.base.overloadedData(uData)},t2d:{openChatWindow:function(destId,sessionId,settingId){$.im_openOutPageChat(settingId,"",destId,null,"")}},enableDebug:function(){if(!$.cache.get("debug")){$.cache.set("debug",2)}if(!$.mDebug){$.require({mDebug:"debug.js"+$.baseExt,Window:"nt2.js"+$.baseExt},function(mDebug){if(!mDebug||mDebug.error){return}$.mDebug.initialize();$.Log=$.mDebug.Log;$.debug=$.mDebug})}return $.cache.get("debug")}});if(!$.isDefined(CON_SERVER)){throw"CON_SERVER is not defined"}$.imageloading=$.sourceURI+"images/loading.gif";$.server=$.extend({},$.protocolFilter(CON_SERVER));$.version=$.extend({},$.version,CON_VERSION);$.baseExt="?siteid="+($.extParmas.siteid||"")+"&v="+$.version.dir+"&t="+$.version.release;if(parseFloat($.params["ntalker-debug"])>0||+$.cache.get("debug")>0){$.require({mDebug:"debug.js"+$.baseExt,Window:"nt2.js"+$.baseExt},function(mDebug){if(!mDebug||mDebug.error){return}$.mDebug.initialize();$.Log=$.mDebug.Log;$.debug=$.mDebug;$.base.start()})}else{$.Log=emptyFunc;$.debug={Log:$.Log};$.base.start()}$._showMobileInPageWindow=function(){$("html").addClass("full-html");$("body").addClass("full-inpage");if($("body").css("padding")){$.rememberBodyPadding=$("body").css("padding");$("body").css({padding:0})}$(".ntalk-mobile-inpage-background").css({"z-index":999999999,display:"block","-webkit-tap-highlight-color":"rgba(0, 0, 0, 0)"});$(".ntalk-mobile-inpage-window").css({display:"block",width:"100%",height:$.isEdu&&($.browser.micromessenger||$.browser.weibo)?"90%":"100%"})},$._hideMobileInPageWindow=function(){if($.rememberBodyPadding){$("body").css({padding:$.rememberBodyPadding})}$("html").removeClass("full-html");$("body").removeClass("full-inpage");$(".ntalk-mobile-inpage-background").css({"z-index":-1,display:"none"});$(".nTalk-window-offLine").css("display","none");if($.isEdu){$.fim_offlineMssage("","","",true)}},$._closeMobileInPageWindow=function(){if($.rememberBodyPadding){$("body").css({padding:$.rememberBodyPadding})}$("html").removeClass("full-html");$("body").removeClass("full-inpage");if($("#ntalk-chat-loading").length>0){$("#ntalk-chat-loading").remove()}$(".ntalk-mobile-inpage-background").remove();$(".nTalk-window-offLine").css("display","none")},$.require($.imageloading);$.extend({getUserInfo:function(){if($.global&&$.global.pcid&&$.user&&$.user.id){return{clientId:$.global.pcid,userId:$.user.id,userName:$.user.name,shortId:$.global.shortid==""?$.user.id.substr($.user.id.indexOf("_ISME9754_")+10):$.global.shortid}}},getTrailSessionId:function(){if($.global&&$.global.trailid){return $.global.trailid}},setBackUrl:function(url){if($.global){$.global.backURL=encodeURIComponent(url)}else{setTimeout(function(){nTalk.setBackUrl(url)},300)}}});$.extend({viewPortContent:null,chatViewport:function(){var chatViewPort=document.getElementsByTagName("meta")[name="viewport"];if(chatViewPort&&chatViewPort.name=="viewport"){this.viewPortContent=chatViewPort.content;var chatviewPort=chatViewPort.content;var suzu=chatviewPort.split(",");for(var k=0;k<suzu.length;k++){if(suzu[k].indexOf("initial-scale")>-1){suzu[k]="initial-scale = 1"}}var shuxing=suzu.join(",");chatViewPort.setAttribute("content",shuxing)}}})})(nTalk);